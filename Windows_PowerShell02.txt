Windows PowerShell
Copyright (C) Microsoft Corporation. All rights reserved.

Install the latest PowerShell for new features and improvements! https://aka.ms/PSWindows

PS G:\My Drive\MyBotFolder\Bybit\pybit_bot> python -m pybit_bot.cli.main start
2025-06-21 11:04:01,754 [INFO] Using repository config directory: G:\My Drive\MyBotFolder\Bybit\pybit_bot\pybit_bot\configs
Using repository config directory: G:\My Drive\MyBotFolder\Bybit\pybit_bot\pybit_bot\configs
2025-06-21 11:04:01,754 [INFO] Using config from: G:\My Drive\MyBotFolder\Bybit\pybit_bot\pybit_bot\configs
Using config from: G:\My Drive\MyBotFolder\Bybit\pybit_bot\pybit_bot\configs
2025-06-21 11:04:01,754 [INFO] Starting bot in current process using config: G:\My Drive\MyBotFolder\Bybit\pybit_bot\pybit_bot\configs
Starting bot in current process using config: G:\My Drive\MyBotFolder\Bybit\pybit_bot\pybit_bot\configs
2025-06-21 11:04:01 [TradingEngine] INFO: Initializing Trading Engine...
2025-06-21 11:04:01,770 [INFO] Initializing Trading Engine...
2025-06-21 11:04:01 [TradingEngine] INFO: Found config files: ['general.json', 'indicators.json', 'strategy.json', 'execution.json']
2025-06-21 11:04:01,770 [INFO] Found config files: ['general.json', 'indicators.json', 'strategy.json', 'execution.json']
Loading configs from: ['general.json', 'indicators.json', 'strategy.json', 'execution.json']
2025-06-21 11:04:01 [TradingEngine] INFO: Loaded config from general.json
2025-06-21 11:04:01,778 [INFO] Loaded config from general.json
Loaded: general.json
2025-06-21 11:04:01 [TradingEngine] INFO: Loaded config from indicators.json
2025-06-21 11:04:01,786 [INFO] Loaded config from indicators.json
Loaded: indicators.json
2025-06-21 11:04:01 [TradingEngine] INFO: Loaded config from strategy.json
2025-06-21 11:04:01,801 [INFO] Loaded config from strategy.json
Loaded: strategy.json
2025-06-21 11:04:01 [TradingEngine] INFO: Loaded config from execution.json
2025-06-21 11:04:01,810 [INFO] Loaded config from execution.json
Loaded: execution.json
Engine initialized with config from: G:\My Drive\MyBotFolder\Bybit\pybit_bot\pybit_bot\configs
2025-06-21 11:04:01 [TradingEngine] INFO: Initializing trading engine components...
2025-06-21 11:04:01,814 [INFO] Initializing trading engine components...
Starting engine initialization...
2025-06-21 11:04:01 [TradingEngine] INFO: Initializing API client...
2025-06-21 11:04:01,814 [INFO] Initializing API client...
Step 1: Initializing API client...
2025-06-21 11:04:01 [TradingEngine] INFO: BybitClient initialized for testnet
2025-06-21 11:04:01,814 [INFO] BybitClient initialized for testnet
2025-06-21 11:04:01 [TradingEngine] INFO: Bybit client initialized (testnet: True)
2025-06-21 11:04:01,816 [INFO] Bybit client initialized (testnet: True)
API client initialized, testnet: True
2025-06-21 11:04:01 [TradingEngine] INFO: Initializing DataManager...
2025-06-21 11:04:01,816 [INFO] Initializing DataManager...
Step 2: Initializing DataManager...
2025-06-21 11:04:01 [TradingEngine] INFO: DataManager initialized
2025-06-21 11:04:01,816 [INFO] DataManager initialized
2025-06-21 11:04:01 [TradingEngine] INFO: Initializing OrderManager...
2025-06-21 11:04:01,816 [INFO] Initializing OrderManager...
Step 3: Initializing OrderManager...
2025-06-21 11:04:02 [TradingEngine] INFO: Cached info for 500 instruments
2025-06-21 11:04:02,584 [INFO] Cached info for 500 instruments
2025-06-21 11:04:02 [TradingEngine] INFO: OrderManager initialized
2025-06-21 11:04:02,584 [INFO] OrderManager initialized
2025-06-21 11:04:02 [TradingEngine] INFO: Initializing StrategyManager...
2025-06-21 11:04:02,584 [INFO] Initializing StrategyManager...
Step 4: Initializing StrategyManager...
2025-06-21 11:04:02 [TradingEngine] INFO: Initializing StrategyManager
2025-06-21 11:04:02,584 [INFO] Initializing StrategyManager
2025-06-21 11:04:02 [TradingEngine] INFO: Loading strategies
2025-06-21 11:04:02,584 [INFO] Loading strategies
2025-06-21 11:04:02 [TradingEngine] INFO: Active strategy: strategy_b
2025-06-21 11:04:02,584 [INFO] Active strategy: strategy_b
2025-06-21 11:04:02 [TradingEngine] INFO: Using default symbol: BTCUSDT
2025-06-21 11:04:02,584 [INFO] Using default symbol: BTCUSDT
2025-06-21 11:04:02 [TradingEngine] INFO: Importing strategy module: pybit_bot.strategies.strategy_b
2025-06-21 11:04:02,584 [INFO] Importing strategy module: pybit_bot.strategies.strategy_b
2025-06-21 11:04:02 [StrategyB] INFO: Strategy B initialized for BTCUSDT with parameters:
2025-06-21 11:04:02,600 [INFO] Strategy B initialized for BTCUSDT with parameters:
2025-06-21 11:04:02 [StrategyB] INFO: - Primary Timeframe: 1m
2025-06-21 11:04:02,600 [INFO] - Primary Timeframe: 1m
2025-06-21 11:04:02 [StrategyB] INFO: - ATR Length: 14
2025-06-21 11:04:02,600 [INFO] - ATR Length: 14
2025-06-21 11:04:02 [StrategyB] INFO: - TP ATR Multiplier: 4.0
2025-06-21 11:04:02,600 [INFO] - TP ATR Multiplier: 4.0
2025-06-21 11:04:02 [StrategyB] INFO: - Trail ATR Multiplier: 2.0
2025-06-21 11:04:02,600 [INFO] - Trail ATR Multiplier: 2.0
2025-06-21 11:04:02 [StrategyB] INFO: - Trail Activation: 0.5
2025-06-21 11:04:02,600 [INFO] - Trail Activation: 0.5
2025-06-21 11:04:02 [StrategyB] INFO: - Trade Rule: LONG on even minutes, SHORT on odd minutes
2025-06-21 11:04:02,600 [INFO] - Trade Rule: LONG on even minutes, SHORT on odd minutes
2025-06-21 11:04:02 [StrategyB] INFO: - Force Alternating Signals: True
2025-06-21 11:04:02,600 [INFO] - Force Alternating Signals: True
2025-06-21 11:04:02 [TradingEngine] INFO: Successfully loaded strategy: strategy_b
2025-06-21 11:04:02,600 [INFO] Successfully loaded strategy: strategy_b
2025-06-21 11:04:02 [TradingEngine] INFO: Initializing TPSLManager...
2025-06-21 11:04:02,600 [INFO] Initializing TPSLManager...
Step 5: Initializing TPSLManager...
2025-06-21 11:04:02 [TradingEngine] INFO: TPSLManager initialized
2025-06-21 11:04:02,600 [INFO] TPSLManager initialized
2025-06-21 11:04:02 [TradingEngine] INFO: Testing API connection...
2025-06-21 11:04:02,600 [INFO] Testing API connection...
Step 6: Testing API connection...
2025-06-21 11:04:02 [TradingEngine] INFO: API connection test successful, server time: 1750467842
2025-06-21 11:04:02,919 [INFO] API connection test successful, server time: 1750467842
2025-06-21 11:04:02 [TradingEngine] INFO: Trading engine initialized successfully
2025-06-21 11:04:02,919 [INFO] Trading engine initialized successfully
Engine initialization complete: SUCCESS
2025-06-21 11:04:02 [TradingEngine] INFO: Starting trading engine...
2025-06-21 11:04:02,935 [INFO] Starting trading engine...
Starting trading engine...
Step 1: Setting engine state...
Step 2: Creating new event loop...
Event loop created successfully
Step 3: Starting market data manager...
Step 4: Creating main thread...
Thread created, starting...
Main loop wrapper started
Event loop set for thread
Starting main loop...
Main thread started successfully
2025-06-21 11:04:02 [TradingEngine] INFO: Main trading loop started
2025-06-21 11:04:02,941 [INFO] Main trading loop started
2025-06-21 11:04:02 [TradingEngine] INFO: Trading engine started
2025-06-21 11:04:02,941 [INFO] Trading engine started
Main trading loop started
Trading engine started successfully
2025-06-21 11:04:02,951 [INFO] Bot started successfully
Bot started successfully
Press Ctrl+C to stop the bot
Waiting 58 seconds until next minute close
2025-06-21 11:04:03 [TradingEngine] INFO: Waiting 58 seconds until next minute close
2025-06-21 11:04:03,064 [INFO] Waiting 58 seconds until next minute close
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Processing symbol: BTCUSDT at minute close
Processing BTCUSDT on 1m timeframe
Fetching data for BTCUSDT 1m
2025-06-21 11:05:01 [TradingEngine] INFO: Fetching kline data for BTCUSDT 1, limit=100
2025-06-21 11:05:01,098 [INFO] Fetching kline data for BTCUSDT 1, limit=100
2025-06-21 11:05:01 [TradingEngine] INFO: Retrieved 100 klines for BTCUSDT
2025-06-21 11:05:01,415 [INFO] Retrieved 100 klines for BTCUSDT
2025-06-21 11:05:01 [TradingEngine] INFO: Klines response type: <class 'list'>, data: [['1750467900000', '87743.6', '87743.6', '87743.6', '87743.6', '0', '0'], ['1750467840000', '87350', '87743.6', '87298.3', '87743.6','0.195', '17033.0226']]
2025-06-21 11:05:01,415 [INFO] Klines response type: <class 'list'>, data: [['1750467900000', '87743.6', '87743.6', '87743.6', '87743.6', '0', '0'], ['1750467840000', '87350', '87743.6', '87298.3', '87743.6', '0.195', '17033.0226']]
Updated data cache for BTCUSDT 1m
New data received for BTCUSDT 1m
Running strategies for BTCUSDT 1m
2025-06-21 11:05:01 [StrategyB] INFO: Processing data for BTCUSDT with timeframes: ['1m']
2025-06-21 11:05:01,431 [INFO] Processing data for BTCUSDT with timeframes: ['1m']
2025-06-21 11:05:01 [StrategyB] INFO: Latest candle for BTCUSDT 1m:
2025-06-21 11:05:01,431 [INFO] Latest candle for BTCUSDT 1m:
2025-06-21 11:05:01 [StrategyB] INFO: - Time: 2025-06-21 09:26:00 (Minute: 26)
2025-06-21 11:05:01,431 [INFO] - Time: 2025-06-21 09:26:00 (Minute: 26)
2025-06-21 11:05:01 [StrategyB] INFO: - Price: 82945.00
2025-06-21 11:05:01,431 [INFO] - Price: 82945.00
2025-06-21 11:05:01 [StrategyB] INFO: - Even minute: True
2025-06-21 11:05:01,431 [INFO] - Even minute: True
2025-06-21 11:05:01 [StrategyB] INFO: Minute 26 is even, generating LONG signal
2025-06-21 11:05:01,431 [INFO] Minute 26 is even, generating LONG signal
2025-06-21 11:05:01 [StrategyB] INFO: Generated 1 signals for BTCUSDT
2025-06-21 11:05:01,446 [INFO] Generated 1 signals for BTCUSDT
2025-06-21 11:05:01 [StrategyB] INFO: Signal: SignalType.BUY at price 82945.0 with SL=81955.2, TP=84924.6
2025-06-21 11:05:01,446 [INFO] Signal: SignalType.BUY at price 82945.0 with SL=81955.2, TP=84924.6
2025-06-21 11:05:01 [TradingEngine] INFO: ======= BTCUSDT 1m CLOSE at 2025-06-20 23:26:00 =======
2025-06-21 11:05:01,446 [INFO] ======= BTCUSDT 1m CLOSE at 2025-06-20 23:26:00 =======
2025-06-21 11:05:01 [TradingEngine] INFO: OHLCV: Open=82765.00, High=83252.80, Low=82765.00, Close=82945.00, Volume=0.03
2025-06-21 11:05:01,446 [INFO] OHLCV: Open=82765.00, High=83252.80, Low=82765.00, Close=82945.00, Volume=0.03
Processed BTCUSDT 1m candle close at 2025-06-20 23:26:00
Received 1 signals for BTCUSDT
2025-06-21 11:05:01 [TradingEngine] INFO: Signal generated for BTCUSDT: SignalType.BUY LONG
2025-06-21 11:05:01,446 [INFO] Signal generated for BTCUSDT: SignalType.BUY LONG
SIGNAL: BTCUSDT SignalType.BUY LONG
Validating trade for BTCUSDT...
TEST MODE: All trades allowed for testing
Executing signal for BTCUSDT...
Executing signal for BTCUSDT...
Current price for BTCUSDT: 87743.6
Using fixed position size: 0.01
Order side: Buy, direction: LONG
Placing Buy market order for BTCUSDT without TP/SL
2025-06-21 11:05:01 [TradingEngine] INFO: Entering LONG position for BTCUSDT, qty=0.01 (without TP/SL)
2025-06-21 11:05:01,746 [INFO] Entering LONG position for BTCUSDT, qty=0.01 (without TP/SL)
2025-06-21 11:05:01 [TradingEngine] ERROR: Failed to place order: Unknown error
2025-06-21 11:05:01,889 [ERROR] Failed to place order: Unknown error
2025-06-21 11:05:01 [TradingEngine] INFO: LONG order result: {'orderId': 'dc2484e6-b1ad-4cf5-a2fc-da85f01392df', 'orderLinkId': ''}
2025-06-21 11:05:01,889 [INFO] LONG order result: {'orderId': 'dc2484e6-b1ad-4cf5-a2fc-da85f01392df', 'orderLinkId': ''}
Order not filled immediately, will set TP/SL after fill confirmation
2025-06-21 11:05:01 [TradingEngine] INFO: Order executed for BTCUSDT Buy: dc2484e6-b1ad-4cf5-a2fc-da85f01392df
2025-06-21 11:05:01,889 [INFO] Order executed for BTCUSDT Buy: dc2484e6-b1ad-4cf5-a2fc-da85f01392df
SUCCESS: Order executed for BTCUSDT Buy: dc2484e6-b1ad-4cf5-a2fc-da85f01392df
Processing BTCUSDT on 5m timeframe
Fetching data for BTCUSDT 5m
2025-06-21 11:05:01 [TradingEngine] INFO: Fetching kline data for BTCUSDT 5, limit=100
2025-06-21 11:05:01,889 [INFO] Fetching kline data for BTCUSDT 5, limit=100
2025-06-21 11:05:02 [TradingEngine] INFO: Retrieved 100 klines for BTCUSDT
2025-06-21 11:05:02,040 [INFO] Retrieved 100 klines for BTCUSDT
2025-06-21 11:05:02 [TradingEngine] INFO: Klines response type: <class 'list'>, data: [['1750467900000', '87743.6', '87743.6', '87743.6', '87743.6', '0', '0'], ['1750467600000', '87298.3', '88000', '87298.3', '87743.6','0.322', '28151.1089']]
2025-06-21 11:05:02,040 [INFO] Klines response type: <class 'list'>, data: [['1750467900000', '87743.6', '87743.6', '87743.6', '87743.6', '0', '0'], ['1750467600000', '87298.3', '88000', '87298.3', '87743.6', '0.322', '28151.1089']]
Updated data cache for BTCUSDT 5m
New data received for BTCUSDT 5m
Running strategies for BTCUSDT 5m
2025-06-21 11:05:02 [StrategyB] INFO: Processing data for BTCUSDT with timeframes: ['5m']
2025-06-21 11:05:02,044 [INFO] Processing data for BTCUSDT with timeframes: ['5m']
2025-06-21 11:05:02 [StrategyB] WARNING: Not enough data for BTCUSDT 1m
2025-06-21 11:05:02,044 [WARNING] Not enough data for BTCUSDT 1m
Processing BTCUSDT on 1h timeframe
Fetching data for BTCUSDT 1h
2025-06-21 11:05:02 [TradingEngine] INFO: Fetching kline data for BTCUSDT 60, limit=100
2025-06-21 11:05:02,048 [INFO] Fetching kline data for BTCUSDT 60, limit=100
2025-06-21 11:05:02 [TradingEngine] INFO: Retrieved 100 klines for BTCUSDT
2025-06-21 11:05:02,177 [INFO] Retrieved 100 klines for BTCUSDT
2025-06-21 11:05:02 [TradingEngine] INFO: Klines response type: <class 'list'>, data: [['1750467600000', '87298.3', '88000', '87298.3', '87743.6', '0.322', '28151.1089'], ['1750464000000', '83707.9', '88096.2', '83707.9', '87298.3', '6.67', '576283.1679']]
2025-06-21 11:05:02,177 [INFO] Klines response type: <class 'list'>, data: [['1750467600000', '87298.3', '88000', '87298.3', '87743.6', '0.322', '28151.1089'], ['1750464000000', '83707.9', '88096.2', '83707.9', '87298.3', '6.67', '576283.1679']]
Updated data cache for BTCUSDT 1h
New data received for BTCUSDT 1h
Running strategies for BTCUSDT 1h
2025-06-21 11:05:02 [StrategyB] INFO: Processing data for BTCUSDT with timeframes: ['1h']
2025-06-21 11:05:02,177 [INFO] Processing data for BTCUSDT with timeframes: ['1h']
2025-06-21 11:05:02 [StrategyB] WARNING: Not enough data for BTCUSDT 1m
2025-06-21 11:05:02,177 [WARNING] Not enough data for BTCUSDT 1m
Checking TP/SL conditions
2025-06-21 11:05:02 [TradingEngine] INFO: Checking 1 pending TP/SL orders
2025-06-21 11:05:02,177 [INFO] Checking 1 pending TP/SL orders
2025-06-21 11:05:02 [TradingEngine] INFO: Getting order info for dc2484e6-b1ad-4cf5-a2fc-da85f01392df on BTCUSDT
2025-06-21 11:05:02,177 [INFO] Getting order info for dc2484e6-b1ad-4cf5-a2fc-da85f01392df on BTCUSDT
Engine status: Running=True, Active positions=0
2025-06-21 11:05:02 [TradingEngine] INFO: Order dc2484e6-b1ad-4cf5-a2fc-da85f01392df filled, setting TP/SL
2025-06-21 11:05:02,443 [INFO] Order dc2484e6-b1ad-4cf5-a2fc-da85f01392df filled, setting TP/SL
2025-06-21 11:05:02 [TradingEngine] INFO: Fetching kline data for BTCUSDT 1, limit=20
2025-06-21 11:05:02,757 [INFO] Fetching kline data for BTCUSDT 1, limit=20
2025-06-21 11:05:02 [TradingEngine] INFO: Retrieved 20 klines for BTCUSDT
2025-06-21 11:05:02,870 [INFO] Retrieved 20 klines for BTCUSDT
2025-06-21 11:05:02 [TradingEngine] INFO: Klines response type: <class 'list'>, data: [['1750467900000', '87743.6', '88024.6', '87743.6', '88024.6', '0.01', '880.123'], ['1750467840000', '87350', '87743.6', '87298.3', '87743.6', '0.195', '17033.0226']]
2025-06-21 11:05:02,870 [INFO] Klines response type: <class 'list'>, data: [['1750467900000', '87743.6', '88024.6', '87743.6', '88024.6', '0.01', '880.123'], ['1750467840000', '87350', '87743.6', '87298.3', '87743.6', '0.195', '17033.0226']]
2025-06-21 11:05:02 [TradingEngine] INFO: Calculated ATR from historical data: 610.6714285714271
2025-06-21 11:05:02,886 [INFO] Calculated ATR from historical data: 610.6714285714271
2025-06-21 11:05:02 [TradingEngine] INFO: Setting TP/SL for filled order dc2484e6-b1ad-4cf5-a2fc-da85f01392df
2025-06-21 11:05:02,886 [INFO] Setting TP/SL for filled order dc2484e6-b1ad-4cf5-a2fc-da85f01392df
2025-06-21 11:05:02 [TradingEngine] INFO: Getting order info for dc2484e6-b1ad-4cf5-a2fc-da85f01392df on BTCUSDT
2025-06-21 11:05:02,886 [INFO] Getting order info for dc2484e6-b1ad-4cf5-a2fc-da85f01392df on BTCUSDT
2025-06-21 11:05:03 [TradingEngine] INFO: Fill info for dc2484e6-b1ad-4cf5-a2fc-da85f01392df: {'filled': True, 'fill_price': 88012.3, 'side': 'Buy', 'position_idx': 0}
2025-06-21 11:05:03,241 [INFO] Fill info for dc2484e6-b1ad-4cf5-a2fc-da85f01392df: {'filled': True, 'fill_price': 88012.3, 'side': 'Buy', 'position_idx': 0}
Engine status: Running=True, Active positions=0
2025-06-21 11:05:03 [TradingEngine] INFO: Final TP/SL for BTCUSDT LONG: TP=90454.99, SL=86790.96, Mark Price=87743.6
2025-06-21 11:05:03,546 [INFO] Final TP/SL for BTCUSDT LONG: TP=90454.99, SL=86790.96, Mark Price=87743.6
Engine status: Running=True, Active positions=0
2025-06-21 11:05:05 [TradingEngine] WARNING: Error setting trading stop (attempt 1/3): No response
2025-06-21 11:05:05,176 [WARNING] Error setting trading stop (attempt 1/3): No response
Engine status: Running=True, Active positions=0
2025-06-21 11:05:06 [TradingEngine] ERROR: Exception setting trading stop (attempt 2/3): not modified (ErrCode: 34040) (ErrTime: 01:05:06).
Request → POST https://api-testnet.bybit.com/v5/position/trading-stop: {"category": "linear", "symbol": "BTCUSDT", "positionIdx": 0, "takeProfit": "90454.99", "stopLoss": "86790.96", "tpTriggerBy": "MarkPrice", "slTriggerBy": "MarkPrice"}.
--- Logging error ---
Traceback (most recent call last):
  File "G:\My Drive\MyBotFolder\Bybit\pybit_bot\pybit_bot\core\order_manager_client.py", line 682, in set_trading_stop
    response = self.client._make_request("POST", "/v5/position/trading-stop", params)
  File "G:\My Drive\MyBotFolder\Bybit\pybit_bot\pybit_bot\core\client.py", line 156, in _make_request
    response = self.http_client.set_trading_stop(**params)
  File "C:\Users\marko\AppData\Local\Programs\Python\Python39\lib\site-packages\pybit\_v5_position.py", line 176, in set_trading_stop
    return self._submit_request(
  File "C:\Users\marko\AppData\Local\Programs\Python\Python39\lib\site-packages\pybit\_http_manager.py", line377, in _submit_request
    raise InvalidRequestError(
pybit.exceptions.InvalidRequestError: not modified (ErrCode: 34040) (ErrTime: 01:05:06).
Request → POST https://api-testnet.bybit.com/v5/position/trading-stop: {"category": "linear", "symbol": "BTCUSDT", "positionIdx": 0, "takeProfit": "90454.99", "stopLoss": "86790.96", "tpTriggerBy": "MarkPrice", "slTriggerBy": "MarkPrice"}.

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\marko\AppData\Local\Programs\Python\Python39\lib\logging\__init__.py", line 1082, in emit
    stream.write(msg + self.terminator)
  File "C:\Users\marko\AppData\Local\Programs\Python\Python39\lib\encodings\cp1252.py", line 19, in encode
    return codecs.charmap_encode(input,self.errors,encoding_table)[0]
UnicodeEncodeError: 'charmap' codec can't encode character '\u2192' in position 138: character maps to <undefined>
Call stack:
  File "C:\Users\marko\AppData\Local\Programs\Python\Python39\lib\threading.py", line 912, in _bootstrap
    self._bootstrap_inner()
  File "C:\Users\marko\AppData\Local\Programs\Python\Python39\lib\threading.py", line 954, in _bootstrap_inner
    self.run()
  File "C:\Users\marko\AppData\Local\Programs\Python\Python39\lib\threading.py", line 892, in run
    self._target(*self._args, **self._kwargs)
  File "G:\My Drive\MyBotFolder\Bybit\pybit_bot\pybit_bot\engine.py", line 341, in _main_loop_wrapper
    self._event_loop.run_until_complete(self._main_loop())
  File "C:\Users\marko\AppData\Local\Programs\Python\Python39\lib\asyncio\base_events.py", line 629, in run_until_complete
    self.run_forever()
  File "C:\Users\marko\AppData\Local\Programs\Python\Python39\lib\asyncio\windows_events.py", line 316, in run_forever
    super().run_forever()
  File "C:\Users\marko\AppData\Local\Programs\Python\Python39\lib\asyncio\base_events.py", line 596, in run_forever
    self._run_once()
  File "C:\Users\marko\AppData\Local\Programs\Python\Python39\lib\asyncio\base_events.py", line 1890, in _run_once
    handle._run()
  File "C:\Users\marko\AppData\Local\Programs\Python\Python39\lib\asyncio\events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
  File "G:\My Drive\MyBotFolder\Bybit\pybit_bot\pybit_bot\engine.py", line 394, in _main_loop
    await self.tpsl_manager.check_positions()
  File "G:\My Drive\MyBotFolder\Bybit\pybit_bot\pybit_bot\managers\tpsl_manager.py", line 77, in check_positions
    await self.check_pending_tpsl_orders()
  File "G:\My Drive\MyBotFolder\Bybit\pybit_bot\pybit_bot\managers\tpsl_manager.py", line 151, in check_pending_tpsl_orders
    await self.order_manager.check_pending_tpsl_orders()
  File "G:\My Drive\MyBotFolder\Bybit\pybit_bot\pybit_bot\managers\order_manager.py", line 794, in check_pending_tpsl_orders
    await self.set_tpsl_for_filled_order(symbol, order_id, atr)
  File "G:\My Drive\MyBotFolder\Bybit\pybit_bot\pybit_bot\managers\order_manager.py", line 894, in set_tpsl_for_filled_order
    result = self.order_client.set_trading_stop(
  File "G:\My Drive\MyBotFolder\Bybit\pybit_bot\pybit_bot\core\order_manager_client.py", line 704, in set_trading_stop
    self.logger.error(f"Exception setting trading stop (attempt {attempt+1}/{max_retries}): {str(e)}")
  File "G:\My Drive\MyBotFolder\Bybit\pybit_bot\pybit_bot\utils\logger.py", line 158, in error
    self._log(logging.ERROR, message, *args, **kwargs)
  File "G:\My Drive\MyBotFolder\Bybit\pybit_bot\pybit_bot\utils\logger.py", line 119, in _log
    self.logger.log(level, formatted_message, **kwargs)
Message: 'Exception setting trading stop (attempt 2/3): not modified (ErrCode: 34040) (ErrTime: 01:05:06).\nRequest → POST https://api-testnet.bybit.com/v5/position/trading-stop: {"category": "linear", "symbol": "BTCUSDT", "positionIdx": 0, "takeProfit": "90454.99", "stopLoss": "86790.96", "tpTriggerBy": "MarkPrice", "slTriggerBy": "MarkPrice"}.'
Arguments: ()
2025-06-21 11:05:06,315 [ERROR] Exception setting trading stop (attempt 2/3): not modified (ErrCode: 34040) (ErrTime: 01:05:06).
Request → POST https://api-testnet.bybit.com/v5/position/trading-stop: {"category": "linear", "symbol": "BTCUSDT", "positionIdx": 0, "takeProfit": "90454.99", "stopLoss": "86790.96", "tpTriggerBy": "MarkPrice", "slTriggerBy": "MarkPrice"}.
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
2025-06-21 11:05:08 [TradingEngine] ERROR: Exception setting trading stop (attempt 3/3): not modified (ErrCode: 34040) (ErrTime: 01:05:08).
Request → POST https://api-testnet.bybit.com/v5/position/trading-stop: {"category": "linear", "symbol": "BTCUSDT", "positionIdx": 0, "takeProfit": "90454.99", "stopLoss": "86790.96", "tpTriggerBy": "MarkPrice", "slTriggerBy": "MarkPrice"}.
--- Logging error ---
Traceback (most recent call last):
  File "G:\My Drive\MyBotFolder\Bybit\pybit_bot\pybit_bot\core\order_manager_client.py", line 682, in set_trading_stop
    response = self.client._make_request("POST", "/v5/position/trading-stop", params)
  File "G:\My Drive\MyBotFolder\Bybit\pybit_bot\pybit_bot\core\client.py", line 156, in _make_request
    response = self.http_client.set_trading_stop(**params)
  File "C:\Users\marko\AppData\Local\Programs\Python\Python39\lib\site-packages\pybit\_v5_position.py", line 176, in set_trading_stop
    return self._submit_request(
  File "C:\Users\marko\AppData\Local\Programs\Python\Python39\lib\site-packages\pybit\_http_manager.py", line377, in _submit_request
    raise InvalidRequestError(
pybit.exceptions.InvalidRequestError: not modified (ErrCode: 34040) (ErrTime: 01:05:08).
Request → POST https://api-testnet.bybit.com/v5/position/trading-stop: {"category": "linear", "symbol": "BTCUSDT", "positionIdx": 0, "takeProfit": "90454.99", "stopLoss": "86790.96", "tpTriggerBy": "MarkPrice", "slTriggerBy": "MarkPrice"}.

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\marko\AppData\Local\Programs\Python\Python39\lib\logging\__init__.py", line 1082, in emit
    stream.write(msg + self.terminator)
  File "C:\Users\marko\AppData\Local\Programs\Python\Python39\lib\encodings\cp1252.py", line 19, in encode
    return codecs.charmap_encode(input,self.errors,encoding_table)[0]
UnicodeEncodeError: 'charmap' codec can't encode character '\u2192' in position 138: character maps to <undefined>
Call stack:
  File "C:\Users\marko\AppData\Local\Programs\Python\Python39\lib\threading.py", line 912, in _bootstrap
    self._bootstrap_inner()
  File "C:\Users\marko\AppData\Local\Programs\Python\Python39\lib\threading.py", line 954, in _bootstrap_inner
    self.run()
  File "C:\Users\marko\AppData\Local\Programs\Python\Python39\lib\threading.py", line 892, in run
    self._target(*self._args, **self._kwargs)
  File "G:\My Drive\MyBotFolder\Bybit\pybit_bot\pybit_bot\engine.py", line 341, in _main_loop_wrapper
    self._event_loop.run_until_complete(self._main_loop())
  File "C:\Users\marko\AppData\Local\Programs\Python\Python39\lib\asyncio\base_events.py", line 629, in run_until_complete
    self.run_forever()
  File "C:\Users\marko\AppData\Local\Programs\Python\Python39\lib\asyncio\windows_events.py", line 316, in run_forever
    super().run_forever()
  File "C:\Users\marko\AppData\Local\Programs\Python\Python39\lib\asyncio\base_events.py", line 596, in run_forever
    self._run_once()
  File "C:\Users\marko\AppData\Local\Programs\Python\Python39\lib\asyncio\base_events.py", line 1890, in _run_once
    handle._run()
  File "C:\Users\marko\AppData\Local\Programs\Python\Python39\lib\asyncio\events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
  File "G:\My Drive\MyBotFolder\Bybit\pybit_bot\pybit_bot\engine.py", line 394, in _main_loop
    await self.tpsl_manager.check_positions()
  File "G:\My Drive\MyBotFolder\Bybit\pybit_bot\pybit_bot\managers\tpsl_manager.py", line 77, in check_positions
    await self.check_pending_tpsl_orders()
  File "G:\My Drive\MyBotFolder\Bybit\pybit_bot\pybit_bot\managers\tpsl_manager.py", line 151, in check_pending_tpsl_orders
    await self.order_manager.check_pending_tpsl_orders()
  File "G:\My Drive\MyBotFolder\Bybit\pybit_bot\pybit_bot\managers\order_manager.py", line 794, in check_pending_tpsl_orders
    await self.set_tpsl_for_filled_order(symbol, order_id, atr)
  File "G:\My Drive\MyBotFolder\Bybit\pybit_bot\pybit_bot\managers\order_manager.py", line 894, in set_tpsl_for_filled_order
    result = self.order_client.set_trading_stop(
  File "G:\My Drive\MyBotFolder\Bybit\pybit_bot\pybit_bot\core\order_manager_client.py", line 704, in set_trading_stop
    self.logger.error(f"Exception setting trading stop (attempt {attempt+1}/{max_retries}): {str(e)}")
  File "G:\My Drive\MyBotFolder\Bybit\pybit_bot\pybit_bot\utils\logger.py", line 158, in error
    self._log(logging.ERROR, message, *args, **kwargs)
  File "G:\My Drive\MyBotFolder\Bybit\pybit_bot\pybit_bot\utils\logger.py", line 119, in _log
    self.logger.log(level, formatted_message, **kwargs)
Message: 'Exception setting trading stop (attempt 3/3): not modified (ErrCode: 34040) (ErrTime: 01:05:08).\nRequest → POST https://api-testnet.bybit.com/v5/position/trading-stop: {"category": "linear", "symbol": "BTCUSDT", "positionIdx": 0, "takeProfit": "90454.99", "stopLoss": "86790.96", "tpTriggerBy": "MarkPrice", "slTriggerBy": "MarkPrice"}.'
Arguments: ()
2025-06-21 11:05:08,979 [ERROR] Exception setting trading stop (attempt 3/3): not modified (ErrCode: 34040) (ErrTime: 01:05:08).
Request → POST https://api-testnet.bybit.com/v5/position/trading-stop: {"category": "linear", "symbol": "BTCUSDT", "positionIdx": 0, "takeProfit": "90454.99", "stopLoss": "86790.96", "tpTriggerBy": "MarkPrice", "slTriggerBy": "MarkPrice"}.
2025-06-21 11:05:08 [TradingEngine] ERROR: Failed to set trading stop after 3 attempts
2025-06-21 11:05:08,994 [ERROR] Failed to set trading stop after 3 attempts
Updating position cache
Updating position cache...
Updated position for BTCUSDT: {'symbol': 'BTCUSDT', 'leverage': '1', 'autoAddMargin': 0, 'avgPrice': '88013.66666667', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '90454.9', 'positionValue': '792.123', 'isReduceOnly': False, 'tpslMode': 'Full', 'riskId': 1, 'trailingStop': '0', 'unrealisedPnl': '0.0984', 'markPrice': '88024.6', 'adlRankIndicator': 2, 'cumRealisedPnl': '-734.97391855', 'positionMM': '3.960615', 'createdTime': '1746973619032', 'positionIdx': 0, 'positionIM': '792.123', 'seq': 9481247681, 'updatedTime': '1750467905128', 'side': 'Buy', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '-0.43566765', 'size': '0.009', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '86790.9', 'tradeMode': 0, 'sessionAvgPrice': ''}
Engine status: Running=True, Active positions=0
2025-06-21 11:05:09 [TradingEngine] INFO: Getting order info for dc2484e6-b1ad-4cf5-a2fc-da85f01392df on BTCUSDT
2025-06-21 11:05:09,121 [INFO] Getting order info for dc2484e6-b1ad-4cf5-a2fc-da85f01392df on BTCUSDT
2025-06-21 11:05:09 [TradingEngine] INFO: Fill info for dc2484e6-b1ad-4cf5-a2fc-da85f01392df: {'filled': True, 'fill_price': 88012.3, 'side': 'Buy', 'position_idx': 0}
2025-06-21 11:05:09,454 [INFO] Fill info for dc2484e6-b1ad-4cf5-a2fc-da85f01392df: {'filled': True, 'fill_price': 88012.3, 'side': 'Buy', 'position_idx': 0}
Pending order dc2484e6-b1ad-4cf5-a2fc-da85f01392df filled at 88012.3, setting TP/SL
Setting TP/SL for filled order dc2484e6-b1ad-4cf5-a2fc-da85f01392df at price 88012.3
ATR not found in data cache, calculating approximation
Calculated average range as ATR approximation: 350.65714285714057
Using ATR value: 350.65714285714057 for TP/SL calculation
Calculated TP/SL for BTCUSDT LONG: TP=89414.93, SL=87310.99
2025-06-21 11:05:09 [TradingEngine] INFO: Setting TP/SL for BTCUSDT position: TP=89414.93, SL=87310.99
2025-06-21 11:05:09,789 [INFO] Setting TP/SL for BTCUSDT position: TP=89414.93, SL=87310.99
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
2025-06-21 11:05:11 [TradingEngine] WARNING: Error setting trading stop (attempt 1/3): No response
2025-06-21 11:05:11,587 [WARNING] Error setting trading stop (attempt 1/3): No response
Engine status: Running=True, Active positions=0
2025-06-21 11:05:12 [TradingEngine] ERROR: Exception setting trading stop (attempt 2/3): not modified (ErrCode: 34040) (ErrTime: 01:05:12).
Request → POST https://api-testnet.bybit.com/v5/position/trading-stop: {"category": "linear", "symbol": "BTCUSDT", "positionIdx": 0, "takeProfit": "89414.93", "stopLoss": "87310.99", "tpTriggerBy": "MarkPrice", "slTriggerBy": "MarkPrice"}.
--- Logging error ---
Traceback (most recent call last):
  File "G:\My Drive\MyBotFolder\Bybit\pybit_bot\pybit_bot\core\order_manager_client.py", line 682, in set_trading_stop
    response = self.client._make_request("POST", "/v5/position/trading-stop", params)
  File "G:\My Drive\MyBotFolder\Bybit\pybit_bot\pybit_bot\core\client.py", line 156, in _make_request
    response = self.http_client.set_trading_stop(**params)
  File "C:\Users\marko\AppData\Local\Programs\Python\Python39\lib\site-packages\pybit\_v5_position.py", line 176, in set_trading_stop
    return self._submit_request(
  File "C:\Users\marko\AppData\Local\Programs\Python\Python39\lib\site-packages\pybit\_http_manager.py", line377, in _submit_request
    raise InvalidRequestError(
pybit.exceptions.InvalidRequestError: not modified (ErrCode: 34040) (ErrTime: 01:05:12).
Request → POST https://api-testnet.bybit.com/v5/position/trading-stop: {"category": "linear", "symbol": "BTCUSDT", "positionIdx": 0, "takeProfit": "89414.93", "stopLoss": "87310.99", "tpTriggerBy": "MarkPrice", "slTriggerBy": "MarkPrice"}.

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\marko\AppData\Local\Programs\Python\Python39\lib\logging\__init__.py", line 1082, in emit
    stream.write(msg + self.terminator)
  File "C:\Users\marko\AppData\Local\Programs\Python\Python39\lib\encodings\cp1252.py", line 19, in encode
    return codecs.charmap_encode(input,self.errors,encoding_table)[0]
UnicodeEncodeError: 'charmap' codec can't encode character '\u2192' in position 138: character maps to <undefined>
Call stack:
  File "C:\Users\marko\AppData\Local\Programs\Python\Python39\lib\threading.py", line 912, in _bootstrap
    self._bootstrap_inner()
  File "C:\Users\marko\AppData\Local\Programs\Python\Python39\lib\threading.py", line 954, in _bootstrap_inner
    self.run()
  File "C:\Users\marko\AppData\Local\Programs\Python\Python39\lib\threading.py", line 892, in run
    self._target(*self._args, **self._kwargs)
  File "G:\My Drive\MyBotFolder\Bybit\pybit_bot\pybit_bot\engine.py", line 341, in _main_loop_wrapper
    self._event_loop.run_until_complete(self._main_loop())
  File "C:\Users\marko\AppData\Local\Programs\Python\Python39\lib\asyncio\base_events.py", line 629, in run_until_complete
    self.run_forever()
  File "C:\Users\marko\AppData\Local\Programs\Python\Python39\lib\asyncio\windows_events.py", line 316, in run_forever
    super().run_forever()
  File "C:\Users\marko\AppData\Local\Programs\Python\Python39\lib\asyncio\base_events.py", line 596, in run_forever
    self._run_once()
  File "C:\Users\marko\AppData\Local\Programs\Python\Python39\lib\asyncio\base_events.py", line 1890, in _run_once
    handle._run()
  File "C:\Users\marko\AppData\Local\Programs\Python\Python39\lib\asyncio\events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
  File "G:\My Drive\MyBotFolder\Bybit\pybit_bot\pybit_bot\engine.py", line 368, in _main_loop
    await self.check_pending_tpsl_orders()
  File "G:\My Drive\MyBotFolder\Bybit\pybit_bot\pybit_bot\engine.py", line 434, in check_pending_tpsl_orders
    await self._set_tpsl_for_filled_order(
  File "G:\My Drive\MyBotFolder\Bybit\pybit_bot\pybit_bot\engine.py", line 537, in _set_tpsl_for_filled_order
    tpsl_result = await self.order_manager.set_position_tpsl(
  File "G:\My Drive\MyBotFolder\Bybit\pybit_bot\pybit_bot\managers\order_manager.py", line 305, in set_position_tpsl
    result = self.order_client.set_trading_stop(
  File "G:\My Drive\MyBotFolder\Bybit\pybit_bot\pybit_bot\core\order_manager_client.py", line 704, in set_trading_stop
    self.logger.error(f"Exception setting trading stop (attempt {attempt+1}/{max_retries}): {str(e)}")
  File "G:\My Drive\MyBotFolder\Bybit\pybit_bot\pybit_bot\utils\logger.py", line 158, in error
    self._log(logging.ERROR, message, *args, **kwargs)
  File "G:\My Drive\MyBotFolder\Bybit\pybit_bot\pybit_bot\utils\logger.py", line 119, in _log
    self.logger.log(level, formatted_message, **kwargs)
Message: 'Exception setting trading stop (attempt 2/3): not modified (ErrCode: 34040) (ErrTime: 01:05:12).\nRequest → POST https://api-testnet.bybit.com/v5/position/trading-stop: {"category": "linear", "symbol": "BTCUSDT", "positionIdx": 0, "takeProfit": "89414.93", "stopLoss": "87310.99", "tpTriggerBy": "MarkPrice", "slTriggerBy": "MarkPrice"}.'
Arguments: ()
2025-06-21 11:05:12,727 [ERROR] Exception setting trading stop (attempt 2/3): not modified (ErrCode: 34040) (ErrTime: 01:05:12).
Request → POST https://api-testnet.bybit.com/v5/position/trading-stop: {"category": "linear", "symbol": "BTCUSDT", "positionIdx": 0, "takeProfit": "89414.93", "stopLoss": "87310.99", "tpTriggerBy": "MarkPrice", "slTriggerBy": "MarkPrice"}.
Engine status: Running=True, Active positions=0
2025-06-21 11:05:14 [TradingEngine] ERROR: Exception setting trading stop (attempt 3/3): not modified (ErrCode: 34040) (ErrTime: 01:05:14).
Request → POST https://api-testnet.bybit.com/v5/position/trading-stop: {"category": "linear", "symbol": "BTCUSDT", "positionIdx": 0, "takeProfit": "89414.93", "stopLoss": "87310.99", "tpTriggerBy": "MarkPrice", "slTriggerBy": "MarkPrice"}.
--- Logging error ---
Traceback (most recent call last):
  File "G:\My Drive\MyBotFolder\Bybit\pybit_bot\pybit_bot\core\order_manager_client.py", line 682, in set_trading_stop
    response = self.client._make_request("POST", "/v5/position/trading-stop", params)
  File "G:\My Drive\MyBotFolder\Bybit\pybit_bot\pybit_bot\core\client.py", line 156, in _make_request
    response = self.http_client.set_trading_stop(**params)
  File "C:\Users\marko\AppData\Local\Programs\Python\Python39\lib\site-packages\pybit\_v5_position.py", line 176, in set_trading_stop
    return self._submit_request(
  File "C:\Users\marko\AppData\Local\Programs\Python\Python39\lib\site-packages\pybit\_http_manager.py", line377, in _submit_request
    raise InvalidRequestError(
pybit.exceptions.InvalidRequestError: not modified (ErrCode: 34040) (ErrTime: 01:05:14).
Request → POST https://api-testnet.bybit.com/v5/position/trading-stop: {"category": "linear", "symbol": "BTCUSDT", "positionIdx": 0, "takeProfit": "89414.93", "stopLoss": "87310.99", "tpTriggerBy": "MarkPrice", "slTriggerBy": "MarkPrice"}.

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\marko\AppData\Local\Programs\Python\Python39\lib\logging\__init__.py", line 1082, in emit
    stream.write(msg + self.terminator)
  File "C:\Users\marko\AppData\Local\Programs\Python\Python39\lib\encodings\cp1252.py", line 19, in encode
    return codecs.charmap_encode(input,self.errors,encoding_table)[0]
UnicodeEncodeError: 'charmap' codec can't encode character '\u2192' in position 138: character maps to <undefined>
Call stack:
  File "C:\Users\marko\AppData\Local\Programs\Python\Python39\lib\threading.py", line 912, in _bootstrap
    self._bootstrap_inner()
  File "C:\Users\marko\AppData\Local\Programs\Python\Python39\lib\threading.py", line 954, in _bootstrap_inner
    self.run()
  File "C:\Users\marko\AppData\Local\Programs\Python\Python39\lib\threading.py", line 892, in run
    self._target(*self._args, **self._kwargs)
  File "G:\My Drive\MyBotFolder\Bybit\pybit_bot\pybit_bot\engine.py", line 341, in _main_loop_wrapper
    self._event_loop.run_until_complete(self._main_loop())
  File "C:\Users\marko\AppData\Local\Programs\Python\Python39\lib\asyncio\base_events.py", line 629, in run_until_complete
    self.run_forever()
  File "C:\Users\marko\AppData\Local\Programs\Python\Python39\lib\asyncio\windows_events.py", line 316, in run_forever
    super().run_forever()
  File "C:\Users\marko\AppData\Local\Programs\Python\Python39\lib\asyncio\base_events.py", line 596, in run_forever
    self._run_once()
  File "C:\Users\marko\AppData\Local\Programs\Python\Python39\lib\asyncio\base_events.py", line 1890, in _run_once
    handle._run()
  File "C:\Users\marko\AppData\Local\Programs\Python\Python39\lib\asyncio\events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
  File "G:\My Drive\MyBotFolder\Bybit\pybit_bot\pybit_bot\engine.py", line 368, in _main_loop
    await self.check_pending_tpsl_orders()
  File "G:\My Drive\MyBotFolder\Bybit\pybit_bot\pybit_bot\engine.py", line 434, in check_pending_tpsl_orders
    await self._set_tpsl_for_filled_order(
  File "G:\My Drive\MyBotFolder\Bybit\pybit_bot\pybit_bot\engine.py", line 537, in _set_tpsl_for_filled_order
    tpsl_result = await self.order_manager.set_position_tpsl(
  File "G:\My Drive\MyBotFolder\Bybit\pybit_bot\pybit_bot\managers\order_manager.py", line 305, in set_position_tpsl
    result = self.order_client.set_trading_stop(
  File "G:\My Drive\MyBotFolder\Bybit\pybit_bot\pybit_bot\core\order_manager_client.py", line 704, in set_trading_stop
    self.logger.error(f"Exception setting trading stop (attempt {attempt+1}/{max_retries}): {str(e)}")
  File "G:\My Drive\MyBotFolder\Bybit\pybit_bot\pybit_bot\utils\logger.py", line 158, in error
    self._log(logging.ERROR, message, *args, **kwargs)
  File "G:\My Drive\MyBotFolder\Bybit\pybit_bot\pybit_bot\utils\logger.py", line 119, in _log
    self.logger.log(level, formatted_message, **kwargs)
Message: 'Exception setting trading stop (attempt 3/3): not modified (ErrCode: 34040) (ErrTime: 01:05:14).\nRequest → POST https://api-testnet.bybit.com/v5/position/trading-stop: {"category": "linear", "symbol": "BTCUSDT", "positionIdx": 0, "takeProfit": "89414.93", "stopLoss": "87310.99", "tpTriggerBy": "MarkPrice", "slTriggerBy": "MarkPrice"}.'
Arguments: ()
2025-06-21 11:05:14,870 [ERROR] Exception setting trading stop (attempt 3/3): not modified (ErrCode: 34040) (ErrTime: 01:05:14).
Request → POST https://api-testnet.bybit.com/v5/position/trading-stop: {"category": "linear", "symbol": "BTCUSDT", "positionIdx": 0, "takeProfit": "89414.93", "stopLoss": "87310.99", "tpTriggerBy": "MarkPrice", "slTriggerBy": "MarkPrice"}.
2025-06-21 11:05:14 [TradingEngine] ERROR: Failed to set trading stop after 3 attempts
2025-06-21 11:05:14,885 [ERROR] Failed to set trading stop after 3 attempts
2025-06-21 11:05:14 [TradingEngine] INFO: Set TP/SL result: {'error': 'Failed after 3 attempts'}
2025-06-21 11:05:14,885 [INFO] Set TP/SL result: {'error': 'Failed after 3 attempts'}
2025-06-21 11:05:14 [TradingEngine] ERROR: Error setting TP/SL: Failed after 3 attempts
2025-06-21 11:05:14,885 [ERROR] Error setting TP/SL: Failed after 3 attempts
ERROR setting TP/SL: Failed after 3 attempts
Waiting 46 seconds until next minute close
2025-06-21 11:05:15 [TradingEngine] INFO: Waiting 46 seconds until next minute close
2025-06-21 11:05:15,196 [INFO] Waiting 46 seconds until next minute close
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Processing symbol: BTCUSDT at minute close
Processing BTCUSDT on 1m timeframe
Fetching data for BTCUSDT 1m
2025-06-21 11:06:01 [TradingEngine] INFO: Fetching kline data for BTCUSDT 1, limit=100
2025-06-21 11:06:01,208 [INFO] Fetching kline data for BTCUSDT 1, limit=100
2025-06-21 11:06:01 [TradingEngine] INFO: Retrieved 100 klines for BTCUSDT
2025-06-21 11:06:01,333 [INFO] Retrieved 100 klines for BTCUSDT
2025-06-21 11:06:01 [TradingEngine] INFO: Klines response type: <class 'list'>, data: [['1750467960000', '87298.3', '87298.3', '87298.3', '87298.3', '0', '0'], ['1750467900000', '87743.6', '88024.6', '87298.3', '87298.3', '0.056', '4906.4859']]
2025-06-21 11:06:01,333 [INFO] Klines response type: <class 'list'>, data: [['1750467960000', '87298.3', '87298.3', '87298.3', '87298.3', '0', '0'], ['1750467900000', '87743.6', '88024.6', '87298.3', '87298.3', '0.056','4906.4859']]
Updated data cache for BTCUSDT 1m
New data received for BTCUSDT 1m
Running strategies for BTCUSDT 1m
2025-06-21 11:06:01 [StrategyB] INFO: Processing data for BTCUSDT with timeframes: ['1m']
2025-06-21 11:06:01,333 [INFO] Processing data for BTCUSDT with timeframes: ['1m']
2025-06-21 11:06:01 [StrategyB] INFO: Latest candle for BTCUSDT 1m:
2025-06-21 11:06:01,333 [INFO] Latest candle for BTCUSDT 1m:
2025-06-21 11:06:01 [StrategyB] INFO: - Time: 2025-06-21 09:27:00 (Minute: 27)
2025-06-21 11:06:01,333 [INFO] - Time: 2025-06-21 09:27:00 (Minute: 27)
2025-06-21 11:06:01 [StrategyB] INFO: - Price: 82964.90
2025-06-21 11:06:01,333 [INFO] - Price: 82964.90
2025-06-21 11:06:01 [StrategyB] INFO: - Even minute: False
2025-06-21 11:06:01,333 [INFO] - Even minute: False
2025-06-21 11:06:01 [StrategyB] INFO: FORCING SELL signal (alternating from previous BUY)
2025-06-21 11:06:01,333 [INFO] FORCING SELL signal (alternating from previous BUY)
2025-06-21 11:06:01 [StrategyB] INFO: Minute 27 is odd, generating SHORT signal
2025-06-21 11:06:01,333 [INFO] Minute 27 is odd, generating SHORT signal
2025-06-21 11:06:01 [StrategyB] INFO: Generated 1 signals for BTCUSDT
2025-06-21 11:06:01,333 [INFO] Generated 1 signals for BTCUSDT
2025-06-21 11:06:01 [StrategyB] INFO: Signal: SignalType.SELL at price 82964.9 with SL=83943.49, TP=81007.73
2025-06-21 11:06:01,333 [INFO] Signal: SignalType.SELL at price 82964.9 with SL=83943.49, TP=81007.73
2025-06-21 11:06:01 [TradingEngine] INFO: ======= BTCUSDT 1m CLOSE at 2025-06-20 23:27:00 =======
2025-06-21 11:06:01,333 [INFO] ======= BTCUSDT 1m CLOSE at 2025-06-20 23:27:00 =======
2025-06-21 11:06:01 [TradingEngine] INFO: OHLCV: Open=82945.00, High=82964.90, Low=82945.00, Close=82964.90, Volume=0.00
2025-06-21 11:06:01,333 [INFO] OHLCV: Open=82945.00, High=82964.90, Low=82945.00, Close=82964.90, Volume=0.00
Processed BTCUSDT 1m candle close at 2025-06-20 23:27:00
Received 1 signals for BTCUSDT
2025-06-21 11:06:01 [TradingEngine] INFO: Signal generated for BTCUSDT: SignalType.SELL SHORT
2025-06-21 11:06:01,349 [INFO] Signal generated for BTCUSDT: SignalType.SELL SHORT
SIGNAL: BTCUSDT SignalType.SELL SHORT
Validating trade for BTCUSDT...
TEST MODE: All trades allowed for testing
Executing signal for BTCUSDT...
Executing signal for BTCUSDT...
Engine status: Running=True, Active positions=0
Current price for BTCUSDT: 87298.3
Using fixed position size: 0.01
Order side: Sell, direction: SHORT
Placing Sell market order for BTCUSDT without TP/SL
2025-06-21 11:06:01 [TradingEngine] INFO: Entering SHORT position for BTCUSDT, qty=0.01 (without TP/SL)
2025-06-21 11:06:01,714 [INFO] Entering SHORT position for BTCUSDT, qty=0.01 (without TP/SL)
2025-06-21 11:06:02 [TradingEngine] ERROR: Failed to place order: Unknown error
2025-06-21 11:06:02,017 [ERROR] Failed to place order: Unknown error
2025-06-21 11:06:02 [TradingEngine] INFO: SHORT order result: {'orderId': 'fbcc4897-6533-441e-9e80-4974c63320b8', 'orderLinkId': ''}
2025-06-21 11:06:02,017 [INFO] SHORT order result: {'orderId': 'fbcc4897-6533-441e-9e80-4974c63320b8', 'orderLinkId': ''}
Order not filled immediately, will set TP/SL after fill confirmation
2025-06-21 11:06:02 [TradingEngine] INFO: Order executed for BTCUSDT Sell: fbcc4897-6533-441e-9e80-4974c63320b8
2025-06-21 11:06:02,017 [INFO] Order executed for BTCUSDT Sell: fbcc4897-6533-441e-9e80-4974c63320b8
SUCCESS: Order executed for BTCUSDT Sell: fbcc4897-6533-441e-9e80-4974c63320b8
Processing BTCUSDT on 5m timeframe
Fetching data for BTCUSDT 5m
2025-06-21 11:06:02 [TradingEngine] INFO: Fetching kline data for BTCUSDT 5, limit=100
2025-06-21 11:06:02,017 [INFO] Fetching kline data for BTCUSDT 5, limit=100
2025-06-21 11:06:02 [TradingEngine] INFO: Retrieved 100 klines for BTCUSDT
2025-06-21 11:06:02,223 [INFO] Retrieved 100 klines for BTCUSDT
2025-06-21 11:06:02 [TradingEngine] INFO: Klines response type: <class 'list'>, data: [['1750467900000', '87743.6', '88024.6', '87298.3', '87298.3', '0.056', '4906.4859'], ['1750467600000', '87298.3', '88000', '87298.3', '87743.6', '0.322', '28151.1089']]
2025-06-21 11:06:02,223 [INFO] Klines response type: <class 'list'>, data: [['1750467900000', '87743.6', '88024.6', '87298.3', '87298.3', '0.056', '4906.4859'], ['1750467600000', '87298.3', '88000', '87298.3', '87743.6', '0.322', '28151.1089']]
No new data for BTCUSDT 5m
No new data for BTCUSDT 5m
Processing BTCUSDT on 1h timeframe
Fetching data for BTCUSDT 1h
2025-06-21 11:06:02 [TradingEngine] INFO: Fetching kline data for BTCUSDT 60, limit=100
2025-06-21 11:06:02,223 [INFO] Fetching kline data for BTCUSDT 60, limit=100
Engine status: Running=True, Active positions=0
2025-06-21 11:06:02 [TradingEngine] INFO: Retrieved 100 klines for BTCUSDT
2025-06-21 11:06:02,556 [INFO] Retrieved 100 klines for BTCUSDT
2025-06-21 11:06:02 [TradingEngine] INFO: Klines response type: <class 'list'>, data: [['1750467600000', '87298.3', '88024.6', '87298.3', '87402', '0.388', '33932.1404'], ['1750464000000', '83707.9', '88096.2', '83707.9', '87298.3', '6.67', '576283.1679']]
2025-06-21 11:06:02,558 [INFO] Klines response type: <class 'list'>, data: [['1750467600000', '87298.3', '88024.6', '87298.3', '87402', '0.388', '33932.1404'], ['1750464000000', '83707.9', '88096.2', '83707.9', '87298.3', '6.67', '576283.1679']]
No new data for BTCUSDT 1h
No new data for BTCUSDT 1h
Checking TP/SL conditions
2025-06-21 11:06:02 [TradingEngine] INFO: Checking 1 pending TP/SL orders
2025-06-21 11:06:02,561 [INFO] Checking 1 pending TP/SL orders
2025-06-21 11:06:02 [TradingEngine] INFO: Getting order info for fbcc4897-6533-441e-9e80-4974c63320b8 on BTCUSDT
2025-06-21 11:06:02,561 [INFO] Getting order info for fbcc4897-6533-441e-9e80-4974c63320b8 on BTCUSDT
2025-06-21 11:06:02 [TradingEngine] INFO: Order fbcc4897-6533-441e-9e80-4974c63320b8 filled, setting TP/SL
2025-06-21 11:06:02,941 [INFO] Order fbcc4897-6533-441e-9e80-4974c63320b8 filled, setting TP/SL
2025-06-21 11:06:03 [TradingEngine] INFO: Fetching kline data for BTCUSDT 1, limit=20
2025-06-21 11:06:03,060 [INFO] Fetching kline data for BTCUSDT 1, limit=20
2025-06-21 11:06:03 [TradingEngine] INFO: Retrieved 20 klines for BTCUSDT
2025-06-21 11:06:03,365 [INFO] Retrieved 20 klines for BTCUSDT
2025-06-21 11:06:03 [TradingEngine] INFO: Klines response type: <class 'list'>, data: [['1750467960000', '87298.3', '87489.6', '87298.3', '87402', '0.01', '874.5456'], ['1750467900000', '87743.6', '88024.6', '87298.3', '87298.3', '0.056', '4906.4859']]
2025-06-21 11:06:03,365 [INFO] Klines response type: <class 'list'>, data: [['1750467960000', '87298.3', '87489.6', '87298.3', '87402', '0.01', '874.5456'], ['1750467900000', '87743.6', '88024.6', '87298.3', '87298.3', '0.056', '4906.4859']]
2025-06-21 11:06:03 [TradingEngine] INFO: Calculated ATR from historical data: 657.114285714284
2025-06-21 11:06:03,381 [INFO] Calculated ATR from historical data: 657.114285714284
2025-06-21 11:06:03 [TradingEngine] INFO: Setting TP/SL for filled order fbcc4897-6533-441e-9e80-4974c63320b8
2025-06-21 11:06:03,381 [INFO] Setting TP/SL for filled order fbcc4897-6533-441e-9e80-4974c63320b8
2025-06-21 11:06:03 [TradingEngine] INFO: Getting order info for fbcc4897-6533-441e-9e80-4974c63320b8 on BTCUSDT
2025-06-21 11:06:03,381 [INFO] Getting order info for fbcc4897-6533-441e-9e80-4974c63320b8 on BTCUSDT
2025-06-21 11:06:03 [TradingEngine] INFO: Fill info for fbcc4897-6533-441e-9e80-4974c63320b8: {'filled': True, 'fill_price': 87454.56, 'side': 'Sell', 'position_idx': 0}
2025-06-21 11:06:03,508 [INFO] Fill info for fbcc4897-6533-441e-9e80-4974c63320b8: {'filled': True, 'fill_price': 87454.56, 'side': 'Sell', 'position_idx': 0}
2025-06-21 11:06:03 [TradingEngine] INFO: Final TP/SL for BTCUSDT SHORT: TP=84826.10, SL=88768.79, Mark Price=87566.76
2025-06-21 11:06:03,619 [INFO] Final TP/SL for BTCUSDT SHORT: TP=84826.10, SL=88768.79, Mark Price=87566.76
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
2025-06-21 11:06:05 [TradingEngine] WARNING: Error setting trading stop (attempt 1/3): No response
2025-06-21 11:06:05,276 [WARNING] Error setting trading stop (attempt 1/3): No response
Engine status: Running=True, Active positions=0
2025-06-21 11:06:06 [TradingEngine] ERROR: Exception setting trading stop (attempt 2/3): not modified (ErrCode: 34040) (ErrTime: 01:06:06).
Request → POST https://api-testnet.bybit.com/v5/position/trading-stop: {"category": "linear", "symbol": "BTCUSDT", "positionIdx": 0, "takeProfit": "84826.10", "stopLoss": "88768.79", "tpTriggerBy": "MarkPrice", "slTriggerBy": "MarkPrice"}.
--- Logging error ---
Traceback (most recent call last):
  File "G:\My Drive\MyBotFolder\Bybit\pybit_bot\pybit_bot\core\order_manager_client.py", line 682, in set_trading_stop
    response = self.client._make_request("POST", "/v5/position/trading-stop", params)
  File "G:\My Drive\MyBotFolder\Bybit\pybit_bot\pybit_bot\core\client.py", line 156, in _make_request
    response = self.http_client.set_trading_stop(**params)
  File "C:\Users\marko\AppData\Local\Programs\Python\Python39\lib\site-packages\pybit\_v5_position.py", line 176, in set_trading_stop
    return self._submit_request(
  File "C:\Users\marko\AppData\Local\Programs\Python\Python39\lib\site-packages\pybit\_http_manager.py", line377, in _submit_request
    raise InvalidRequestError(
pybit.exceptions.InvalidRequestError: not modified (ErrCode: 34040) (ErrTime: 01:06:06).
Request → POST https://api-testnet.bybit.com/v5/position/trading-stop: {"category": "linear", "symbol": "BTCUSDT", "positionIdx": 0, "takeProfit": "84826.10", "stopLoss": "88768.79", "tpTriggerBy": "MarkPrice", "slTriggerBy": "MarkPrice"}.

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\marko\AppData\Local\Programs\Python\Python39\lib\logging\__init__.py", line 1082, in emit
    stream.write(msg + self.terminator)
  File "C:\Users\marko\AppData\Local\Programs\Python\Python39\lib\encodings\cp1252.py", line 19, in encode
    return codecs.charmap_encode(input,self.errors,encoding_table)[0]
UnicodeEncodeError: 'charmap' codec can't encode character '\u2192' in position 138: character maps to <undefined>
Call stack:
  File "C:\Users\marko\AppData\Local\Programs\Python\Python39\lib\threading.py", line 912, in _bootstrap
    self._bootstrap_inner()
  File "C:\Users\marko\AppData\Local\Programs\Python\Python39\lib\threading.py", line 954, in _bootstrap_inner
    self.run()
  File "C:\Users\marko\AppData\Local\Programs\Python\Python39\lib\threading.py", line 892, in run
    self._target(*self._args, **self._kwargs)
  File "G:\My Drive\MyBotFolder\Bybit\pybit_bot\pybit_bot\engine.py", line 341, in _main_loop_wrapper
    self._event_loop.run_until_complete(self._main_loop())
  File "C:\Users\marko\AppData\Local\Programs\Python\Python39\lib\asyncio\base_events.py", line 629, in run_until_complete
    self.run_forever()
  File "C:\Users\marko\AppData\Local\Programs\Python\Python39\lib\asyncio\windows_events.py", line 316, in run_forever
    super().run_forever()
  File "C:\Users\marko\AppData\Local\Programs\Python\Python39\lib\asyncio\base_events.py", line 596, in run_forever
    self._run_once()
  File "C:\Users\marko\AppData\Local\Programs\Python\Python39\lib\asyncio\base_events.py", line 1890, in _run_once
    handle._run()
  File "C:\Users\marko\AppData\Local\Programs\Python\Python39\lib\asyncio\events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
  File "G:\My Drive\MyBotFolder\Bybit\pybit_bot\pybit_bot\engine.py", line 394, in _main_loop
    await self.tpsl_manager.check_positions()
  File "G:\My Drive\MyBotFolder\Bybit\pybit_bot\pybit_bot\managers\tpsl_manager.py", line 77, in check_positions
    await self.check_pending_tpsl_orders()
  File "G:\My Drive\MyBotFolder\Bybit\pybit_bot\pybit_bot\managers\tpsl_manager.py", line 151, in check_pending_tpsl_orders
    await self.order_manager.check_pending_tpsl_orders()
  File "G:\My Drive\MyBotFolder\Bybit\pybit_bot\pybit_bot\managers\order_manager.py", line 794, in check_pending_tpsl_orders
    await self.set_tpsl_for_filled_order(symbol, order_id, atr)
  File "G:\My Drive\MyBotFolder\Bybit\pybit_bot\pybit_bot\managers\order_manager.py", line 894, in set_tpsl_for_filled_order
    result = self.order_client.set_trading_stop(
  File "G:\My Drive\MyBotFolder\Bybit\pybit_bot\pybit_bot\core\order_manager_client.py", line 704, in set_trading_stop
    self.logger.error(f"Exception setting trading stop (attempt {attempt+1}/{max_retries}): {str(e)}")
  File "G:\My Drive\MyBotFolder\Bybit\pybit_bot\pybit_bot\utils\logger.py", line 158, in error
    self._log(logging.ERROR, message, *args, **kwargs)
  File "G:\My Drive\MyBotFolder\Bybit\pybit_bot\pybit_bot\utils\logger.py", line 119, in _log
    self.logger.log(level, formatted_message, **kwargs)
Message: 'Exception setting trading stop (attempt 2/3): not modified (ErrCode: 34040) (ErrTime: 01:06:06).\nRequest → POST https://api-testnet.bybit.com/v5/position/trading-stop: {"category": "linear", "symbol": "BTCUSDT", "positionIdx": 0, "takeProfit": "84826.10", "stopLoss": "88768.79", "tpTriggerBy": "MarkPrice", "slTriggerBy": "MarkPrice"}.'
Arguments: ()
2025-06-21 11:06:06,595 [ERROR] Exception setting trading stop (attempt 2/3): not modified (ErrCode: 34040) (ErrTime: 01:06:06).
Request → POST https://api-testnet.bybit.com/v5/position/trading-stop: {"category": "linear", "symbol": "BTCUSDT", "positionIdx": 0, "takeProfit": "84826.10", "stopLoss": "88768.79", "tpTriggerBy": "MarkPrice", "slTriggerBy": "MarkPrice"}.
Engine status: Running=True, Active positions=0
2025-06-21 11:06:08 [TradingEngine] ERROR: Exception setting trading stop (attempt 3/3): not modified (ErrCode: 34040) (ErrTime: 01:06:08).
Request → POST https://api-testnet.bybit.com/v5/position/trading-stop: {"category": "linear", "symbol": "BTCUSDT", "positionIdx": 0, "takeProfit": "84826.10", "stopLoss": "88768.79", "tpTriggerBy": "MarkPrice", "slTriggerBy": "MarkPrice"}.
--- Logging error ---
Engine status: Running=True, Active positions=0
Traceback (most recent call last):
  File "G:\My Drive\MyBotFolder\Bybit\pybit_bot\pybit_bot\core\order_manager_client.py", line 682, in set_trading_stop
    response = self.client._make_request("POST", "/v5/position/trading-stop", params)
  File "G:\My Drive\MyBotFolder\Bybit\pybit_bot\pybit_bot\core\client.py", line 156, in _make_request
    response = self.http_client.set_trading_stop(**params)
  File "C:\Users\marko\AppData\Local\Programs\Python\Python39\lib\site-packages\pybit\_v5_position.py", line 176, in set_trading_stop
    return self._submit_request(
  File "C:\Users\marko\AppData\Local\Programs\Python\Python39\lib\site-packages\pybit\_http_manager.py", line377, in _submit_request
    raise InvalidRequestError(
pybit.exceptions.InvalidRequestError: not modified (ErrCode: 34040) (ErrTime: 01:06:08).
Request → POST https://api-testnet.bybit.com/v5/position/trading-stop: {"category": "linear", "symbol": "BTCUSDT", "positionIdx": 0, "takeProfit": "84826.10", "stopLoss": "88768.79", "tpTriggerBy": "MarkPrice", "slTriggerBy": "MarkPrice"}.

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\marko\AppData\Local\Programs\Python\Python39\lib\logging\__init__.py", line 1082, in emit
    stream.write(msg + self.terminator)
  File "C:\Users\marko\AppData\Local\Programs\Python\Python39\lib\encodings\cp1252.py", line 19, in encode
    return codecs.charmap_encode(input,self.errors,encoding_table)[0]
UnicodeEncodeError: 'charmap' codec can't encode character '\u2192' in position 138: character maps to <undefined>
Call stack:
  File "C:\Users\marko\AppData\Local\Programs\Python\Python39\lib\threading.py", line 912, in _bootstrap
    self._bootstrap_inner()
  File "C:\Users\marko\AppData\Local\Programs\Python\Python39\lib\threading.py", line 954, in _bootstrap_inner
    self.run()
  File "C:\Users\marko\AppData\Local\Programs\Python\Python39\lib\threading.py", line 892, in run
    self._target(*self._args, **self._kwargs)
  File "G:\My Drive\MyBotFolder\Bybit\pybit_bot\pybit_bot\engine.py", line 341, in _main_loop_wrapper
    self._event_loop.run_until_complete(self._main_loop())
  File "C:\Users\marko\AppData\Local\Programs\Python\Python39\lib\asyncio\base_events.py", line 629, in run_until_complete
    self.run_forever()
  File "C:\Users\marko\AppData\Local\Programs\Python\Python39\lib\asyncio\windows_events.py", line 316, in run_forever
    super().run_forever()
  File "C:\Users\marko\AppData\Local\Programs\Python\Python39\lib\asyncio\base_events.py", line 596, in run_forever
    self._run_once()
  File "C:\Users\marko\AppData\Local\Programs\Python\Python39\lib\asyncio\base_events.py", line 1890, in _run_once
    handle._run()
  File "C:\Users\marko\AppData\Local\Programs\Python\Python39\lib\asyncio\events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
  File "G:\My Drive\MyBotFolder\Bybit\pybit_bot\pybit_bot\engine.py", line 394, in _main_loop
    await self.tpsl_manager.check_positions()
  File "G:\My Drive\MyBotFolder\Bybit\pybit_bot\pybit_bot\managers\tpsl_manager.py", line 77, in check_positions
    await self.check_pending_tpsl_orders()
  File "G:\My Drive\MyBotFolder\Bybit\pybit_bot\pybit_bot\managers\tpsl_manager.py", line 151, in check_pending_tpsl_orders
    await self.order_manager.check_pending_tpsl_orders()
  File "G:\My Drive\MyBotFolder\Bybit\pybit_bot\pybit_bot\managers\order_manager.py", line 794, in check_pending_tpsl_orders
    await self.set_tpsl_for_filled_order(symbol, order_id, atr)
  File "G:\My Drive\MyBotFolder\Bybit\pybit_bot\pybit_bot\managers\order_manager.py", line 894, in set_tpsl_for_filled_order
    result = self.order_client.set_trading_stop(
  File "G:\My Drive\MyBotFolder\Bybit\pybit_bot\pybit_bot\core\order_manager_client.py", line 704, in set_trading_stop
    self.logger.error(f"Exception setting trading stop (attempt {attempt+1}/{max_retries}): {str(e)}")
  File "G:\My Drive\MyBotFolder\Bybit\pybit_bot\pybit_bot\utils\logger.py", line 158, in error
    self._log(logging.ERROR, message, *args, **kwargs)
  File "G:\My Drive\MyBotFolder\Bybit\pybit_bot\pybit_bot\utils\logger.py", line 119, in _log
    self.logger.log(level, formatted_message, **kwargs)
Message: 'Exception setting trading stop (attempt 3/3): not modified (ErrCode: 34040) (ErrTime: 01:06:08).\nRequest → POST https://api-testnet.bybit.com/v5/position/trading-stop: {"category": "linear", "symbol": "BTCUSDT", "positionIdx": 0, "takeProfit": "84826.10", "stopLoss": "88768.79", "tpTriggerBy": "MarkPrice", "slTriggerBy": "MarkPrice"}.'
Arguments: ()
2025-06-21 11:06:08,978 [ERROR] Exception setting trading stop (attempt 3/3): not modified (ErrCode: 34040) (ErrTime: 01:06:08).
Request → POST https://api-testnet.bybit.com/v5/position/trading-stop: {"category": "linear", "symbol": "BTCUSDT", "positionIdx": 0, "takeProfit": "84826.10", "stopLoss": "88768.79", "tpTriggerBy": "MarkPrice", "slTriggerBy": "MarkPrice"}.
2025-06-21 11:06:08 [TradingEngine] ERROR: Failed to set trading stop after 3 attempts
2025-06-21 11:06:08,997 [ERROR] Failed to set trading stop after 3 attempts
Updating position cache
Updating position cache...
Updated position for BTCUSDT: {'symbol': 'BTCUSDT', 'leverage': '1', 'autoAddMargin': 0, 'avgPrice': '87402','liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '84826.1', 'positionValue': '87.402', 'isReduceOnly': False, 'tpslMode': 'Full', 'riskId': 1, 'trailingStop': '0', 'unrealisedPnl': '-0.17008', 'markPrice': '87572.08', 'adlRankIndicator': 2, 'cumRealisedPnl': '-740.43431863', 'positionMM': '0.5331522', 'createdTime': '1746973619032', 'positionIdx': 0, 'positionIM': '87.4981422', 'seq': 9481247997, 'updatedTime': '1750467965215', 'side': 'Sell', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '-0.0480711', 'size': '0.001', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '88768.7', 'tradeMode': 0, 'sessionAvgPrice': ''}
Engine status: Running=True, Active positions=0
2025-06-21 11:06:09 [TradingEngine] INFO: Getting order info for fbcc4897-6533-441e-9e80-4974c63320b8 on BTCUSDT
2025-06-21 11:06:09,319 [INFO] Getting order info for fbcc4897-6533-441e-9e80-4974c63320b8 on BTCUSDT
2025-06-21 11:06:09 [TradingEngine] INFO: Fill info for fbcc4897-6533-441e-9e80-4974c63320b8: {'filled': True, 'fill_price': 87454.56, 'side': 'Sell', 'position_idx': 0}
2025-06-21 11:06:09,491 [INFO] Fill info for fbcc4897-6533-441e-9e80-4974c63320b8: {'filled': True, 'fill_price': 87454.56, 'side': 'Sell', 'position_idx': 0}
Pending order fbcc4897-6533-441e-9e80-4974c63320b8 filled at 87454.56, setting TP/SL
Setting TP/SL for filled order fbcc4897-6533-441e-9e80-4974c63320b8 at price 87454.56
ATR not found in data cache, calculating approximation
Calculated average range as ATR approximation: 326.82857142856875
Using ATR value: 326.82857142856875 for TP/SL calculation
Calculated TP/SL for BTCUSDT SHORT: TP=86147.25, SL=88108.22
2025-06-21 11:06:09 [TradingEngine] INFO: Setting TP/SL for BTCUSDT position: TP=86147.25, SL=88108.22
2025-06-21 11:06:09,908 [INFO] Setting TP/SL for BTCUSDT position: TP=86147.25, SL=88108.22
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
2025-06-21 11:06:12 [TradingEngine] WARNING: Error setting trading stop (attempt 1/3): No response
2025-06-21 11:06:12,027 [WARNING] Error setting trading stop (attempt 1/3): No response
Engine status: Running=True, Active positions=0
2025-06-21 11:06:13 [TradingEngine] ERROR: Exception setting trading stop (attempt 2/3): not modified (ErrCode: 34040) (ErrTime: 01:06:13).
Request → POST https://api-testnet.bybit.com/v5/position/trading-stop: {"category": "linear", "symbol": "BTCUSDT", "positionIdx": 0, "takeProfit": "86147.25", "stopLoss": "88108.22", "tpTriggerBy": "MarkPrice", "slTriggerBy": "MarkPrice"}.
--- Logging error ---
Traceback (most recent call last):
  File "G:\My Drive\MyBotFolder\Bybit\pybit_bot\pybit_bot\core\order_manager_client.py", line 682, in set_trading_stop
    response = self.client._make_request("POST", "/v5/position/trading-stop", params)
  File "G:\My Drive\MyBotFolder\Bybit\pybit_bot\pybit_bot\core\client.py", line 156, in _make_request
    response = self.http_client.set_trading_stop(**params)
  File "C:\Users\marko\AppData\Local\Programs\Python\Python39\lib\site-packages\pybit\_v5_position.py", line 176, in set_trading_stop
    return self._submit_request(
  File "C:\Users\marko\AppData\Local\Programs\Python\Python39\lib\site-packages\pybit\_http_manager.py", line377, in _submit_request
    raise InvalidRequestError(
pybit.exceptions.InvalidRequestError: not modified (ErrCode: 34040) (ErrTime: 01:06:13).
Request → POST https://api-testnet.bybit.com/v5/position/trading-stop: {"category": "linear", "symbol": "BTCUSDT", "positionIdx": 0, "takeProfit": "86147.25", "stopLoss": "88108.22", "tpTriggerBy": "MarkPrice", "slTriggerBy": "MarkPrice"}.

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\marko\AppData\Local\Programs\Python\Python39\lib\logging\__init__.py", line 1082, in emit
    stream.write(msg + self.terminator)
  File "C:\Users\marko\AppData\Local\Programs\Python\Python39\lib\encodings\cp1252.py", line 19, in encode
    return codecs.charmap_encode(input,self.errors,encoding_table)[0]
UnicodeEncodeError: 'charmap' codec can't encode character '\u2192' in position 138: character maps to <undefined>
Call stack:
  File "C:\Users\marko\AppData\Local\Programs\Python\Python39\lib\threading.py", line 912, in _bootstrap
    self._bootstrap_inner()
  File "C:\Users\marko\AppData\Local\Programs\Python\Python39\lib\threading.py", line 954, in _bootstrap_inner
    self.run()
  File "C:\Users\marko\AppData\Local\Programs\Python\Python39\lib\threading.py", line 892, in run
    self._target(*self._args, **self._kwargs)
  File "G:\My Drive\MyBotFolder\Bybit\pybit_bot\pybit_bot\engine.py", line 341, in _main_loop_wrapper
    self._event_loop.run_until_complete(self._main_loop())
  File "C:\Users\marko\AppData\Local\Programs\Python\Python39\lib\asyncio\base_events.py", line 629, in run_until_complete
    self.run_forever()
  File "C:\Users\marko\AppData\Local\Programs\Python\Python39\lib\asyncio\windows_events.py", line 316, in run_forever
    super().run_forever()
  File "C:\Users\marko\AppData\Local\Programs\Python\Python39\lib\asyncio\base_events.py", line 596, in run_forever
    self._run_once()
  File "C:\Users\marko\AppData\Local\Programs\Python\Python39\lib\asyncio\base_events.py", line 1890, in _run_once
    handle._run()
  File "C:\Users\marko\AppData\Local\Programs\Python\Python39\lib\asyncio\events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
  File "G:\My Drive\MyBotFolder\Bybit\pybit_bot\pybit_bot\engine.py", line 368, in _main_loop
    await self.check_pending_tpsl_orders()
  File "G:\My Drive\MyBotFolder\Bybit\pybit_bot\pybit_bot\engine.py", line 434, in check_pending_tpsl_orders
    await self._set_tpsl_for_filled_order(
  File "G:\My Drive\MyBotFolder\Bybit\pybit_bot\pybit_bot\engine.py", line 537, in _set_tpsl_for_filled_order
    tpsl_result = await self.order_manager.set_position_tpsl(
  File "G:\My Drive\MyBotFolder\Bybit\pybit_bot\pybit_bot\managers\order_manager.py", line 305, in set_position_tpsl
    result = self.order_client.set_trading_stop(
  File "G:\My Drive\MyBotFolder\Bybit\pybit_bot\pybit_bot\core\order_manager_client.py", line 704, in set_trading_stop
    self.logger.error(f"Exception setting trading stop (attempt {attempt+1}/{max_retries}): {str(e)}")
  File "G:\My Drive\MyBotFolder\Bybit\pybit_bot\pybit_bot\utils\logger.py", line 158, in error
    self._log(logging.ERROR, message, *args, **kwargs)
  File "G:\My Drive\MyBotFolder\Bybit\pybit_bot\pybit_bot\utils\logger.py", line 119, in _log
    self.logger.log(level, formatted_message, **kwargs)
Message: 'Exception setting trading stop (attempt 2/3): not modified (ErrCode: 34040) (ErrTime: 01:06:13).\nRequest → POST https://api-testnet.bybit.com/v5/position/trading-stop: {"category": "linear", "symbol": "BTCUSDT", "positionIdx": 0, "takeProfit": "86147.25", "stopLoss": "88108.22", "tpTriggerBy": "MarkPrice", "slTriggerBy": "MarkPrice"}.'
Arguments: ()
2025-06-21 11:06:13,152 [ERROR] Exception setting trading stop (attempt 2/3): not modified (ErrCode: 34040) (ErrTime: 01:06:13).
Request → POST https://api-testnet.bybit.com/v5/position/trading-stop: {"category": "linear", "symbol": "BTCUSDT", "positionIdx": 0, "takeProfit": "86147.25", "stopLoss": "88108.22", "tpTriggerBy": "MarkPrice", "slTriggerBy": "MarkPrice"}.
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
2025-06-21 11:06:15 [TradingEngine] ERROR: Exception setting trading stop (attempt 3/3): not modified (ErrCode: 34040) (ErrTime: 01:06:15).
Request → POST https://api-testnet.bybit.com/v5/position/trading-stop: {"category": "linear", "symbol": "BTCUSDT", "positionIdx": 0, "takeProfit": "86147.25", "stopLoss": "88108.22", "tpTriggerBy": "MarkPrice", "slTriggerBy": "MarkPrice"}.
--- Logging error ---
Traceback (most recent call last):
  File "G:\My Drive\MyBotFolder\Bybit\pybit_bot\pybit_bot\core\order_manager_client.py", line 682, in set_trading_stop
    response = self.client._make_request("POST", "/v5/position/trading-stop", params)
  File "G:\My Drive\MyBotFolder\Bybit\pybit_bot\pybit_bot\core\client.py", line 156, in _make_request
    response = self.http_client.set_trading_stop(**params)
  File "C:\Users\marko\AppData\Local\Programs\Python\Python39\lib\site-packages\pybit\_v5_position.py", line 176, in set_trading_stop
    return self._submit_request(
  File "C:\Users\marko\AppData\Local\Programs\Python\Python39\lib\site-packages\pybit\_http_manager.py", line377, in _submit_request
    raise InvalidRequestError(
pybit.exceptions.InvalidRequestError: not modified (ErrCode: 34040) (ErrTime: 01:06:15).
Request → POST https://api-testnet.bybit.com/v5/position/trading-stop: {"category": "linear", "symbol": "BTCUSDT", "positionIdx": 0, "takeProfit": "86147.25", "stopLoss": "88108.22", "tpTriggerBy": "MarkPrice", "slTriggerBy": "MarkPrice"}.

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\marko\AppData\Local\Programs\Python\Python39\lib\logging\__init__.py", line 1082, in emit
    stream.write(msg + self.terminator)
  File "C:\Users\marko\AppData\Local\Programs\Python\Python39\lib\encodings\cp1252.py", line 19, in encode
    return codecs.charmap_encode(input,self.errors,encoding_table)[0]
UnicodeEncodeError: 'charmap' codec can't encode character '\u2192' in position 138: character maps to <undefined>
Call stack:
  File "C:\Users\marko\AppData\Local\Programs\Python\Python39\lib\threading.py", line 912, in _bootstrap
    self._bootstrap_inner()
  File "C:\Users\marko\AppData\Local\Programs\Python\Python39\lib\threading.py", line 954, in _bootstrap_inner
    self.run()
  File "C:\Users\marko\AppData\Local\Programs\Python\Python39\lib\threading.py", line 892, in run
    self._target(*self._args, **self._kwargs)
  File "G:\My Drive\MyBotFolder\Bybit\pybit_bot\pybit_bot\engine.py", line 341, in _main_loop_wrapper
    self._event_loop.run_until_complete(self._main_loop())
  File "C:\Users\marko\AppData\Local\Programs\Python\Python39\lib\asyncio\base_events.py", line 629, in run_until_complete
    self.run_forever()
  File "C:\Users\marko\AppData\Local\Programs\Python\Python39\lib\asyncio\windows_events.py", line 316, in run_forever
    super().run_forever()
  File "C:\Users\marko\AppData\Local\Programs\Python\Python39\lib\asyncio\base_events.py", line 596, in run_forever
    self._run_once()
  File "C:\Users\marko\AppData\Local\Programs\Python\Python39\lib\asyncio\base_events.py", line 1890, in _run_once
    handle._run()
  File "C:\Users\marko\AppData\Local\Programs\Python\Python39\lib\asyncio\events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
  File "G:\My Drive\MyBotFolder\Bybit\pybit_bot\pybit_bot\engine.py", line 368, in _main_loop
    await self.check_pending_tpsl_orders()
  File "G:\My Drive\MyBotFolder\Bybit\pybit_bot\pybit_bot\engine.py", line 434, in check_pending_tpsl_orders
    await self._set_tpsl_for_filled_order(
  File "G:\My Drive\MyBotFolder\Bybit\pybit_bot\pybit_bot\engine.py", line 537, in _set_tpsl_for_filled_order
    tpsl_result = await self.order_manager.set_position_tpsl(
  File "G:\My Drive\MyBotFolder\Bybit\pybit_bot\pybit_bot\managers\order_manager.py", line 305, in set_position_tpsl
    result = self.order_client.set_trading_stop(
  File "G:\My Drive\MyBotFolder\Bybit\pybit_bot\pybit_bot\core\order_manager_client.py", line 704, in set_trading_stop
    self.logger.error(f"Exception setting trading stop (attempt {attempt+1}/{max_retries}): {str(e)}")
  File "G:\My Drive\MyBotFolder\Bybit\pybit_bot\pybit_bot\utils\logger.py", line 158, in error
    self._log(logging.ERROR, message, *args, **kwargs)
  File "G:\My Drive\MyBotFolder\Bybit\pybit_bot\pybit_bot\utils\logger.py", line 119, in _log
    self.logger.log(level, formatted_message, **kwargs)
Message: 'Exception setting trading stop (attempt 3/3): not modified (ErrCode: 34040) (ErrTime: 01:06:15).\nRequest → POST https://api-testnet.bybit.com/v5/position/trading-stop: {"category": "linear", "symbol": "BTCUSDT", "positionIdx": 0, "takeProfit": "86147.25", "stopLoss": "88108.22", "tpTriggerBy": "MarkPrice", "slTriggerBy": "MarkPrice"}.'
Arguments: ()
2025-06-21 11:06:15,336 [ERROR] Exception setting trading stop (attempt 3/3): not modified (ErrCode: 34040) (ErrTime: 01:06:15).
Request → POST https://api-testnet.bybit.com/v5/position/trading-stop: {"category": "linear", "symbol": "BTCUSDT", "positionIdx": 0, "takeProfit": "86147.25", "stopLoss": "88108.22", "tpTriggerBy": "MarkPrice", "slTriggerBy": "MarkPrice"}.
2025-06-21 11:06:15 [TradingEngine] ERROR: Failed to set trading stop after 3 attempts
2025-06-21 11:06:15,336 [ERROR] Failed to set trading stop after 3 attempts
2025-06-21 11:06:15 [TradingEngine] INFO: Set TP/SL result: {'error': 'Failed after 3 attempts'}
2025-06-21 11:06:15,336 [INFO] Set TP/SL result: {'error': 'Failed after 3 attempts'}
2025-06-21 11:06:15 [TradingEngine] ERROR: Error setting TP/SL: Failed after 3 attempts
2025-06-21 11:06:15,336 [ERROR] Error setting TP/SL: Failed after 3 attempts
ERROR setting TP/SL: Failed after 3 attempts
Waiting 46 seconds until next minute close
2025-06-21 11:06:15 [TradingEngine] INFO: Waiting 46 seconds until next minute close
2025-06-21 11:06:15,733 [INFO] Waiting 46 seconds until next minute close
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Processing symbol: BTCUSDT at minute close
Processing BTCUSDT on 1m timeframe
Fetching data for BTCUSDT 1m
2025-06-21 11:07:01 [TradingEngine] INFO: Fetching kline data for BTCUSDT 1, limit=100
2025-06-21 11:07:01,738 [INFO] Fetching kline data for BTCUSDT 1, limit=100
Engine status: Running=True, Active positions=0
2025-06-21 11:07:02 [TradingEngine] INFO: Retrieved 100 klines for BTCUSDT
2025-06-21 11:07:02,051 [INFO] Retrieved 100 klines for BTCUSDT
2025-06-21 11:07:02 [TradingEngine] INFO: Klines response type: <class 'list'>, data: [['1750468020000', '88000', '88000', '88000', '88000', '0', '0'], ['1750467960000', '87298.3', '88000', '87298.3', '88000', '0.178', '15551.0065']]
2025-06-21 11:07:02,051 [INFO] Klines response type: <class 'list'>, data: [['1750468020000', '88000', '88000', '88000', '88000', '0', '0'], ['1750467960000', '87298.3', '88000', '87298.3', '88000', '0.178', '15551.0065']]
Updated data cache for BTCUSDT 1m
New data received for BTCUSDT 1m
Running strategies for BTCUSDT 1m
2025-06-21 11:07:02 [StrategyB] INFO: Processing data for BTCUSDT with timeframes: ['1m']
2025-06-21 11:07:02,051 [INFO] Processing data for BTCUSDT with timeframes: ['1m']
2025-06-21 11:07:02 [StrategyB] INFO: Latest candle for BTCUSDT 1m:
2025-06-21 11:07:02,051 [INFO] Latest candle for BTCUSDT 1m:
2025-06-21 11:07:02 [StrategyB] INFO: - Time: 2025-06-21 09:28:00 (Minute: 28)
2025-06-21 11:07:02,051 [INFO] - Time: 2025-06-21 09:28:00 (Minute: 28)
2025-06-21 11:07:02 [StrategyB] INFO: - Price: 82838.60
2025-06-21 11:07:02,051 [INFO] - Price: 82838.60
2025-06-21 11:07:02 [StrategyB] INFO: - Even minute: True
2025-06-21 11:07:02,051 [INFO] - Even minute: True
2025-06-21 11:07:02 [StrategyB] INFO: FORCING BUY signal (alternating from previous SELL)
2025-06-21 11:07:02,051 [INFO] FORCING BUY signal (alternating from previous SELL)
2025-06-21 11:07:02 [StrategyB] INFO: Minute 28 is even, generating LONG signal
2025-06-21 11:07:02,051 [INFO] Minute 28 is even, generating LONG signal
2025-06-21 11:07:02 [StrategyB] INFO: Generated 1 signals for BTCUSDT
2025-06-21 11:07:02,051 [INFO] Generated 1 signals for BTCUSDT
2025-06-21 11:07:02 [StrategyB] INFO: Signal: SignalType.BUY at price 82838.6 with SL=81764.07, TP=84987.66
2025-06-21 11:07:02,051 [INFO] Signal: SignalType.BUY at price 82838.6 with SL=81764.07, TP=84987.66
2025-06-21 11:07:02 [TradingEngine] INFO: ======= BTCUSDT 1m CLOSE at 2025-06-20 23:28:00 =======
2025-06-21 11:07:02,051 [INFO] ======= BTCUSDT 1m CLOSE at 2025-06-20 23:28:00 =======
2025-06-21 11:07:02 [TradingEngine] INFO: OHLCV: Open=82964.90, High=82964.90, Low=82838.60, Close=82838.60, Volume=0.00
2025-06-21 11:07:02,051 [INFO] OHLCV: Open=82964.90, High=82964.90, Low=82838.60, Close=82838.60, Volume=0.00
Processed BTCUSDT 1m candle close at 2025-06-20 23:28:00
Received 1 signals for BTCUSDT
2025-06-21 11:07:02 [TradingEngine] INFO: Signal generated for BTCUSDT: SignalType.BUY LONG
2025-06-21 11:07:02,051 [INFO] Signal generated for BTCUSDT: SignalType.BUY LONG
SIGNAL: BTCUSDT SignalType.BUY LONG
Validating trade for BTCUSDT...
TEST MODE: All trades allowed for testing
Executing signal for BTCUSDT...
Executing signal for BTCUSDT...
Current price for BTCUSDT: 88000.0
Using fixed position size: 0.01
Order side: Buy, direction: LONG
Placing Buy market order for BTCUSDT without TP/SL
2025-06-21 11:07:02 [TradingEngine] INFO: Entering LONG position for BTCUSDT, qty=0.01 (without TP/SL)
2025-06-21 11:07:02,437 [INFO] Entering LONG position for BTCUSDT, qty=0.01 (without TP/SL)
2025-06-21 11:07:02 [TradingEngine] ERROR: Failed to place order: Unknown error
2025-06-21 11:07:02,567 [ERROR] Failed to place order: Unknown error
2025-06-21 11:07:02 [TradingEngine] INFO: LONG order result: {'orderId': '0385f3ff-9a08-4359-9efd-7b56bdd60463', 'orderLinkId': ''}
2025-06-21 11:07:02,567 [INFO] LONG order result: {'orderId': '0385f3ff-9a08-4359-9efd-7b56bdd60463', 'orderLinkId': ''}
Order not filled immediately, will set TP/SL after fill confirmation
2025-06-21 11:07:02 [TradingEngine] INFO: Order executed for BTCUSDT Buy: 0385f3ff-9a08-4359-9efd-7b56bdd60463
2025-06-21 11:07:02,567 [INFO] Order executed for BTCUSDT Buy: 0385f3ff-9a08-4359-9efd-7b56bdd60463
SUCCESS: Order executed for BTCUSDT Buy: 0385f3ff-9a08-4359-9efd-7b56bdd60463
Processing BTCUSDT on 5m timeframe
Fetching data for BTCUSDT 5m
2025-06-21 11:07:02 [TradingEngine] INFO: Fetching kline data for BTCUSDT 5, limit=100
2025-06-21 11:07:02,583 [INFO] Fetching kline data for BTCUSDT 5, limit=100
2025-06-21 11:07:02 [TradingEngine] INFO: Retrieved 100 klines for BTCUSDT
2025-06-21 11:07:02,710 [INFO] Retrieved 100 klines for BTCUSDT
2025-06-21 11:07:02 [TradingEngine] INFO: Klines response type: <class 'list'>, data: [['1750467900000', '87743.6', '88024.6', '87298.3', '88000', '0.234', '20457.4924'], ['1750467600000', '87298.3', '88000', '87298.3','87743.6', '0.322', '28151.1089']]
2025-06-21 11:07:02,710 [INFO] Klines response type: <class 'list'>, data: [['1750467900000', '87743.6', '88024.6', '87298.3', '88000', '0.234', '20457.4924'], ['1750467600000', '87298.3', '88000', '87298.3', '87743.6','0.322', '28151.1089']]
No new data for BTCUSDT 5m
No new data for BTCUSDT 5m
Processing BTCUSDT on 1h timeframe
Fetching data for BTCUSDT 1h
2025-06-21 11:07:02 [TradingEngine] INFO: Fetching kline data for BTCUSDT 60, limit=100
2025-06-21 11:07:02,710 [INFO] Fetching kline data for BTCUSDT 60, limit=100
Engine status: Running=True, Active positions=0
2025-06-21 11:07:03 [TradingEngine] INFO: Retrieved 100 klines for BTCUSDT
2025-06-21 11:07:03,022 [INFO] Retrieved 100 klines for BTCUSDT
2025-06-21 11:07:03 [TradingEngine] INFO: Klines response type: <class 'list'>, data: [['1750467600000', '87298.3', '88024.6', '87298.3', '88000', '0.556', '48608.6013'], ['1750464000000', '83707.9', '88096.2', '83707.9', '87298.3', '6.67', '576283.1679']]
2025-06-21 11:07:03,022 [INFO] Klines response type: <class 'list'>, data: [['1750467600000', '87298.3', '88024.6', '87298.3', '88000', '0.556', '48608.6013'], ['1750464000000', '83707.9', '88096.2', '83707.9', '87298.3', '6.67', '576283.1679']]
No new data for BTCUSDT 1h
No new data for BTCUSDT 1h
Checking TP/SL conditions
2025-06-21 11:07:03 [TradingEngine] INFO: Checking 1 pending TP/SL orders
2025-06-21 11:07:03,026 [INFO] Checking 1 pending TP/SL orders
2025-06-21 11:07:03 [TradingEngine] INFO: Getting order info for 0385f3ff-9a08-4359-9efd-7b56bdd60463 on BTCUSDT
2025-06-21 11:07:03,026 [INFO] Getting order info for 0385f3ff-9a08-4359-9efd-7b56bdd60463 on BTCUSDT
2025-06-21 11:07:03 [TradingEngine] INFO: Order 0385f3ff-9a08-4359-9efd-7b56bdd60463 filled, setting TP/SL
2025-06-21 11:07:03,613 [INFO] Order 0385f3ff-9a08-4359-9efd-7b56bdd60463 filled, setting TP/SL
2025-06-21 11:07:03 [TradingEngine] INFO: Fetching kline data for BTCUSDT 1, limit=20
2025-06-21 11:07:03,741 [INFO] Fetching kline data for BTCUSDT 1, limit=20
2025-06-21 11:07:03 [TradingEngine] INFO: Retrieved 20 klines for BTCUSDT
2025-06-21 11:07:03,868 [INFO] Retrieved 20 klines for BTCUSDT
2025-06-21 11:07:03 [TradingEngine] INFO: Klines response type: <class 'list'>, data: [['1750468020000', '88000', '88000', '87746.5', '87834.1', '0.01', '877.8154'], ['1750467960000', '87298.3', '88000', '87298.3', '88000', '0.178', '15551.0065']]
2025-06-21 11:07:03,868 [INFO] Klines response type: <class 'list'>, data: [['1750468020000', '88000', '88000', '87746.5', '87834.1', '0.01', '877.8154'], ['1750467960000', '87298.3', '88000', '87298.3', '88000', '0.178', '15551.0065']]
2025-06-21 11:07:03 [TradingEngine] INFO: Calculated ATR from historical data: 707.2357142857124
2025-06-21 11:07:03,884 [INFO] Calculated ATR from historical data: 707.2357142857124
2025-06-21 11:07:03 [TradingEngine] INFO: Setting TP/SL for filled order 0385f3ff-9a08-4359-9efd-7b56bdd60463
2025-06-21 11:07:03,884 [INFO] Setting TP/SL for filled order 0385f3ff-9a08-4359-9efd-7b56bdd60463
2025-06-21 11:07:03 [TradingEngine] INFO: Getting order info for 0385f3ff-9a08-4359-9efd-7b56bdd60463 on BTCUSDT
2025-06-21 11:07:03,884 [INFO] Getting order info for 0385f3ff-9a08-4359-9efd-7b56bdd60463 on BTCUSDT
2025-06-21 11:07:04 [TradingEngine] INFO: Fill info for 0385f3ff-9a08-4359-9efd-7b56bdd60463: {'filled': True, 'fill_price': 87781.54, 'side': 'Buy', 'position_idx': 0}
2025-06-21 11:07:04,014 [INFO] Fill info for 0385f3ff-9a08-4359-9efd-7b56bdd60463: {'filled': True, 'fill_price': 87781.54, 'side': 'Buy', 'position_idx': 0}
Engine status: Running=True, Active positions=0
2025-06-21 11:07:04 [TradingEngine] INFO: Final TP/SL for BTCUSDT LONG: TP=90610.48, SL=86367.07, Mark Price=88000.0
2025-06-21 11:07:04,143 [INFO] Final TP/SL for BTCUSDT LONG: TP=90610.48, SL=86367.07, Mark Price=88000.0
Engine status: Running=True, Active positions=0
2025-06-21 11:07:05 [TradingEngine] WARNING: Error setting trading stop (attempt 1/3): No response
2025-06-21 11:07:05,972 [WARNING] Error setting trading stop (attempt 1/3): No response
Engine status: Running=True, Active positions=0
2025-06-21 11:07:07 [TradingEngine] ERROR: Exception setting trading stop (attempt 2/3): not modified (ErrCode: 34040) (ErrTime: 01:07:07).
Request → POST https://api-testnet.bybit.com/v5/position/trading-stop: {"category": "linear", "symbol": "BTCUSDT", "positionIdx": 0, "takeProfit": "90610.48", "stopLoss": "86367.07", "tpTriggerBy": "MarkPrice", "slTriggerBy": "MarkPrice"}.
--- Logging error ---
Traceback (most recent call last):
  File "G:\My Drive\MyBotFolder\Bybit\pybit_bot\pybit_bot\core\order_manager_client.py", line 682, in set_trading_stop
    response = self.client._make_request("POST", "/v5/position/trading-stop", params)
  File "G:\My Drive\MyBotFolder\Bybit\pybit_bot\pybit_bot\core\client.py", line 156, in _make_request
    response = self.http_client.set_trading_stop(**params)
  File "C:\Users\marko\AppData\Local\Programs\Python\Python39\lib\site-packages\pybit\_v5_position.py", line 176, in set_trading_stop
    return self._submit_request(
  File "C:\Users\marko\AppData\Local\Programs\Python\Python39\lib\site-packages\pybit\_http_manager.py", line377, in _submit_request
    raise InvalidRequestError(
pybit.exceptions.InvalidRequestError: not modified (ErrCode: 34040) (ErrTime: 01:07:07).
Request → POST https://api-testnet.bybit.com/v5/position/trading-stop: {"category": "linear", "symbol": "BTCUSDT", "positionIdx": 0, "takeProfit": "90610.48", "stopLoss": "86367.07", "tpTriggerBy": "MarkPrice", "slTriggerBy": "MarkPrice"}.

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\marko\AppData\Local\Programs\Python\Python39\lib\logging\__init__.py", line 1082, in emit
    stream.write(msg + self.terminator)
  File "C:\Users\marko\AppData\Local\Programs\Python\Python39\lib\encodings\cp1252.py", line 19, in encode
    return codecs.charmap_encode(input,self.errors,encoding_table)[0]
UnicodeEncodeError: 'charmap' codec can't encode character '\u2192' in position 138: character maps to <undefined>
Call stack:
  File "C:\Users\marko\AppData\Local\Programs\Python\Python39\lib\threading.py", line 912, in _bootstrap
    self._bootstrap_inner()
  File "C:\Users\marko\AppData\Local\Programs\Python\Python39\lib\threading.py", line 954, in _bootstrap_inner
    self.run()
  File "C:\Users\marko\AppData\Local\Programs\Python\Python39\lib\threading.py", line 892, in run
    self._target(*self._args, **self._kwargs)
  File "G:\My Drive\MyBotFolder\Bybit\pybit_bot\pybit_bot\engine.py", line 341, in _main_loop_wrapper
    self._event_loop.run_until_complete(self._main_loop())
  File "C:\Users\marko\AppData\Local\Programs\Python\Python39\lib\asyncio\base_events.py", line 629, in run_until_complete
    self.run_forever()
  File "C:\Users\marko\AppData\Local\Programs\Python\Python39\lib\asyncio\windows_events.py", line 316, in run_forever
    super().run_forever()
  File "C:\Users\marko\AppData\Local\Programs\Python\Python39\lib\asyncio\base_events.py", line 596, in run_forever
    self._run_once()
  File "C:\Users\marko\AppData\Local\Programs\Python\Python39\lib\asyncio\base_events.py", line 1890, in _run_once
    handle._run()
  File "C:\Users\marko\AppData\Local\Programs\Python\Python39\lib\asyncio\events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
  File "G:\My Drive\MyBotFolder\Bybit\pybit_bot\pybit_bot\engine.py", line 394, in _main_loop
    await self.tpsl_manager.check_positions()
  File "G:\My Drive\MyBotFolder\Bybit\pybit_bot\pybit_bot\managers\tpsl_manager.py", line 77, in check_positions
    await self.check_pending_tpsl_orders()
  File "G:\My Drive\MyBotFolder\Bybit\pybit_bot\pybit_bot\managers\tpsl_manager.py", line 151, in check_pending_tpsl_orders
    await self.order_manager.check_pending_tpsl_orders()
  File "G:\My Drive\MyBotFolder\Bybit\pybit_bot\pybit_bot\managers\order_manager.py", line 794, in check_pending_tpsl_orders
    await self.set_tpsl_for_filled_order(symbol, order_id, atr)
  File "G:\My Drive\MyBotFolder\Bybit\pybit_bot\pybit_bot\managers\order_manager.py", line 894, in set_tpsl_for_filled_order
    result = self.order_client.set_trading_stop(
  File "G:\My Drive\MyBotFolder\Bybit\pybit_bot\pybit_bot\core\order_manager_client.py", line 704, in set_trading_stop
    self.logger.error(f"Exception setting trading stop (attempt {attempt+1}/{max_retries}): {str(e)}")
  File "G:\My Drive\MyBotFolder\Bybit\pybit_bot\pybit_bot\utils\logger.py", line 158, in error
    self._log(logging.ERROR, message, *args, **kwargs)
  File "G:\My Drive\MyBotFolder\Bybit\pybit_bot\pybit_bot\utils\logger.py", line 119, in _log
    self.logger.log(level, formatted_message, **kwargs)
Message: 'Exception setting trading stop (attempt 2/3): not modified (ErrCode: 34040) (ErrTime: 01:07:07).\nRequest → POST https://api-testnet.bybit.com/v5/position/trading-stop: {"category": "linear", "symbol": "BTCUSDT", "positionIdx": 0, "takeProfit": "90610.48", "stopLoss": "86367.07", "tpTriggerBy": "MarkPrice", "slTriggerBy": "MarkPrice"}.'
Arguments: ()
2025-06-21 11:07:07,098 [ERROR] Exception setting trading stop (attempt 2/3): not modified (ErrCode: 34040) (ErrTime: 01:07:07).
Request → POST https://api-testnet.bybit.com/v5/position/trading-stop: {"category": "linear", "symbol": "BTCUSDT", "positionIdx": 0, "takeProfit": "90610.48", "stopLoss": "86367.07", "tpTriggerBy": "MarkPrice", "slTriggerBy": "MarkPrice"}.
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
2025-06-21 11:07:09 [TradingEngine] ERROR: Exception setting trading stop (attempt 3/3): not modified (ErrCode: 34040) (ErrTime: 01:07:09).
Request → POST https://api-testnet.bybit.com/v5/position/trading-stop: {"category": "linear", "symbol": "BTCUSDT", "positionIdx": 0, "takeProfit": "90610.48", "stopLoss": "86367.07", "tpTriggerBy": "MarkPrice", "slTriggerBy": "MarkPrice"}.
--- Logging error ---
Traceback (most recent call last):
  File "G:\My Drive\MyBotFolder\Bybit\pybit_bot\pybit_bot\core\order_manager_client.py", line 682, in set_trading_stop
    response = self.client._make_request("POST", "/v5/position/trading-stop", params)
  File "G:\My Drive\MyBotFolder\Bybit\pybit_bot\pybit_bot\core\client.py", line 156, in _make_request
    response = self.http_client.set_trading_stop(**params)
  File "C:\Users\marko\AppData\Local\Programs\Python\Python39\lib\site-packages\pybit\_v5_position.py", line 176, in set_trading_stop
    return self._submit_request(
  File "C:\Users\marko\AppData\Local\Programs\Python\Python39\lib\site-packages\pybit\_http_manager.py", line377, in _submit_request
    raise InvalidRequestError(
pybit.exceptions.InvalidRequestError: not modified (ErrCode: 34040) (ErrTime: 01:07:09).
Request → POST https://api-testnet.bybit.com/v5/position/trading-stop: {"category": "linear", "symbol": "BTCUSDT", "positionIdx": 0, "takeProfit": "90610.48", "stopLoss": "86367.07", "tpTriggerBy": "MarkPrice", "slTriggerBy": "MarkPrice"}.

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\marko\AppData\Local\Programs\Python\Python39\lib\logging\__init__.py", line 1082, in emit
    stream.write(msg + self.terminator)
  File "C:\Users\marko\AppData\Local\Programs\Python\Python39\lib\encodings\cp1252.py", line 19, in encode
    return codecs.charmap_encode(input,self.errors,encoding_table)[0]
UnicodeEncodeError: 'charmap' codec can't encode character '\u2192' in position 138: character maps to <undefined>
Call stack:
  File "C:\Users\marko\AppData\Local\Programs\Python\Python39\lib\threading.py", line 912, in _bootstrap
    self._bootstrap_inner()
  File "C:\Users\marko\AppData\Local\Programs\Python\Python39\lib\threading.py", line 954, in _bootstrap_inner
    self.run()
  File "C:\Users\marko\AppData\Local\Programs\Python\Python39\lib\threading.py", line 892, in run
    self._target(*self._args, **self._kwargs)
  File "G:\My Drive\MyBotFolder\Bybit\pybit_bot\pybit_bot\engine.py", line 341, in _main_loop_wrapper
    self._event_loop.run_until_complete(self._main_loop())
  File "C:\Users\marko\AppData\Local\Programs\Python\Python39\lib\asyncio\base_events.py", line 629, in run_until_complete
    self.run_forever()
  File "C:\Users\marko\AppData\Local\Programs\Python\Python39\lib\asyncio\windows_events.py", line 316, in run_forever
    super().run_forever()
  File "C:\Users\marko\AppData\Local\Programs\Python\Python39\lib\asyncio\base_events.py", line 596, in run_forever
    self._run_once()
  File "C:\Users\marko\AppData\Local\Programs\Python\Python39\lib\asyncio\base_events.py", line 1890, in _run_once
    handle._run()
  File "C:\Users\marko\AppData\Local\Programs\Python\Python39\lib\asyncio\events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
  File "G:\My Drive\MyBotFolder\Bybit\pybit_bot\pybit_bot\engine.py", line 394, in _main_loop
    await self.tpsl_manager.check_positions()
  File "G:\My Drive\MyBotFolder\Bybit\pybit_bot\pybit_bot\managers\tpsl_manager.py", line 77, in check_positions
    await self.check_pending_tpsl_orders()
  File "G:\My Drive\MyBotFolder\Bybit\pybit_bot\pybit_bot\managers\tpsl_manager.py", line 151, in check_pending_tpsl_orders
    await self.order_manager.check_pending_tpsl_orders()
  File "G:\My Drive\MyBotFolder\Bybit\pybit_bot\pybit_bot\managers\order_manager.py", line 794, in check_pending_tpsl_orders
    await self.set_tpsl_for_filled_order(symbol, order_id, atr)
  File "G:\My Drive\MyBotFolder\Bybit\pybit_bot\pybit_bot\managers\order_manager.py", line 894, in set_tpsl_for_filled_order
    result = self.order_client.set_trading_stop(
  File "G:\My Drive\MyBotFolder\Bybit\pybit_bot\pybit_bot\core\order_manager_client.py", line 704, in set_trading_stop
    self.logger.error(f"Exception setting trading stop (attempt {attempt+1}/{max_retries}): {str(e)}")
  File "G:\My Drive\MyBotFolder\Bybit\pybit_bot\pybit_bot\utils\logger.py", line 158, in error
    self._log(logging.ERROR, message, *args, **kwargs)
  File "G:\My Drive\MyBotFolder\Bybit\pybit_bot\pybit_bot\utils\logger.py", line 119, in _log
    self.logger.log(level, formatted_message, **kwargs)
Message: 'Exception setting trading stop (attempt 3/3): not modified (ErrCode: 34040) (ErrTime: 01:07:09).\nRequest → POST https://api-testnet.bybit.com/v5/position/trading-stop: {"category": "linear", "symbol": "BTCUSDT", "positionIdx": 0, "takeProfit": "90610.48", "stopLoss": "86367.07", "tpTriggerBy": "MarkPrice", "slTriggerBy": "MarkPrice"}.'
Arguments: ()
2025-06-21 11:07:09,250 [ERROR] Exception setting trading stop (attempt 3/3): not modified (ErrCode: 34040) (ErrTime: 01:07:09).
Request → POST https://api-testnet.bybit.com/v5/position/trading-stop: {"category": "linear", "symbol": "BTCUSDT", "positionIdx": 0, "takeProfit": "90610.48", "stopLoss": "86367.07", "tpTriggerBy": "MarkPrice", "slTriggerBy": "MarkPrice"}.
2025-06-21 11:07:09 [TradingEngine] ERROR: Failed to set trading stop after 3 attempts
2025-06-21 11:07:09,293 [ERROR] Failed to set trading stop after 3 attempts
Updating position cache
Updating position cache...
Updated position for BTCUSDT: {'symbol': 'BTCUSDT', 'leverage': '1', 'autoAddMargin': 0, 'avgPrice': '87785.43333333', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '90610.4', 'positionValue': '790.0689', 'isReduceOnly': False, 'tpslMode': 'Full', 'riskId': 1, 'trailingStop': '0', 'unrealisedPnl': '0.438', 'markPrice': '87834.1', 'adlRankIndicator': 2, 'cumRealisedPnl': '-741.2616171', 'positionMM': '3.9503445', 'createdTime': '1746973619032', 'positionIdx': 0, 'positionIM': '790.0689', 'seq': 9481248192, 'updatedTime': '1750468025919', 'side': 'Buy', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl':'-0.43453789', 'size': '0.009', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '86367', 'tradeMode': 0, 'sessionAvgPrice': ''}
Engine status: Running=True, Active positions=0
2025-06-21 11:07:09 [TradingEngine] INFO: Getting order info for 0385f3ff-9a08-4359-9efd-7b56bdd60463 on BTCUSDT
2025-06-21 11:07:09,486 [INFO] Getting order info for 0385f3ff-9a08-4359-9efd-7b56bdd60463 on BTCUSDT
2025-06-21 11:07:09 [TradingEngine] INFO: Fill info for 0385f3ff-9a08-4359-9efd-7b56bdd60463: {'filled': True, 'fill_price': 87781.54, 'side': 'Buy', 'position_idx': 0}
2025-06-21 11:07:09,614 [INFO] Fill info for 0385f3ff-9a08-4359-9efd-7b56bdd60463: {'filled': True, 'fill_price': 87781.54, 'side': 'Buy', 'position_idx': 0}
Pending order 0385f3ff-9a08-4359-9efd-7b56bdd60463 filled at 87781.54, setting TP/SL
Setting TP/SL for filled order 0385f3ff-9a08-4359-9efd-7b56bdd60463 at price 87781.54
ATR not found in data cache, calculating approximation
Calculated average range as ATR approximation: 382.3999999999973
Using ATR value: 382.3999999999973 for TP/SL calculation
Calculated TP/SL for BTCUSDT LONG: TP=89311.14, SL=87016.74
2025-06-21 11:07:09 [TradingEngine] INFO: Setting TP/SL for BTCUSDT position: TP=89311.14, SL=87016.74
2025-06-21 11:07:09,970 [INFO] Setting TP/SL for BTCUSDT position: TP=89311.14, SL=87016.74
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
2025-06-21 11:07:12 [TradingEngine] WARNING: Error setting trading stop (attempt 1/3): No response
2025-06-21 11:07:12,133 [WARNING] Error setting trading stop (attempt 1/3): No response
Engine status: Running=True, Active positions=0
2025-06-21 11:07:13 [TradingEngine] ERROR: Exception setting trading stop (attempt 2/3): not modified (ErrCode: 34040) (ErrTime: 01:07:13).
Request → POST https://api-testnet.bybit.com/v5/position/trading-stop: {"category": "linear", "symbol": "BTCUSDT", "positionIdx": 0, "takeProfit": "89311.14", "stopLoss": "87016.74", "tpTriggerBy": "MarkPrice", "slTriggerBy": "MarkPrice"}.
--- Logging error ---
Traceback (most recent call last):
  File "G:\My Drive\MyBotFolder\Bybit\pybit_bot\pybit_bot\core\order_manager_client.py", line 682, in set_trading_stop
    response = self.client._make_request("POST", "/v5/position/trading-stop", params)
  File "G:\My Drive\MyBotFolder\Bybit\pybit_bot\pybit_bot\core\client.py", line 156, in _make_request
    response = self.http_client.set_trading_stop(**params)
  File "C:\Users\marko\AppData\Local\Programs\Python\Python39\lib\site-packages\pybit\_v5_position.py", line 176, in set_trading_stop
    return self._submit_request(
  File "C:\Users\marko\AppData\Local\Programs\Python\Python39\lib\site-packages\pybit\_http_manager.py", line377, in _submit_request
    raise InvalidRequestError(
pybit.exceptions.InvalidRequestError: not modified (ErrCode: 34040) (ErrTime: 01:07:13).
Request → POST https://api-testnet.bybit.com/v5/position/trading-stop: {"category": "linear", "symbol": "BTCUSDT", "positionIdx": 0, "takeProfit": "89311.14", "stopLoss": "87016.74", "tpTriggerBy": "MarkPrice", "slTriggerBy": "MarkPrice"}.

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\marko\AppData\Local\Programs\Python\Python39\lib\logging\__init__.py", line 1082, in emit
    stream.write(msg + self.terminator)
  File "C:\Users\marko\AppData\Local\Programs\Python\Python39\lib\encodings\cp1252.py", line 19, in encode
    return codecs.charmap_encode(input,self.errors,encoding_table)[0]
UnicodeEncodeError: 'charmap' codec can't encode character '\u2192' in position 138: character maps to <undefined>
Call stack:
  File "C:\Users\marko\AppData\Local\Programs\Python\Python39\lib\threading.py", line 912, in _bootstrap
    self._bootstrap_inner()
  File "C:\Users\marko\AppData\Local\Programs\Python\Python39\lib\threading.py", line 954, in _bootstrap_inner
    self.run()
  File "C:\Users\marko\AppData\Local\Programs\Python\Python39\lib\threading.py", line 892, in run
    self._target(*self._args, **self._kwargs)
  File "G:\My Drive\MyBotFolder\Bybit\pybit_bot\pybit_bot\engine.py", line 341, in _main_loop_wrapper
    self._event_loop.run_until_complete(self._main_loop())
  File "C:\Users\marko\AppData\Local\Programs\Python\Python39\lib\asyncio\base_events.py", line 629, in run_until_complete
    self.run_forever()
  File "C:\Users\marko\AppData\Local\Programs\Python\Python39\lib\asyncio\windows_events.py", line 316, in run_forever
    super().run_forever()
  File "C:\Users\marko\AppData\Local\Programs\Python\Python39\lib\asyncio\base_events.py", line 596, in run_forever
    self._run_once()
  File "C:\Users\marko\AppData\Local\Programs\Python\Python39\lib\asyncio\base_events.py", line 1890, in _run_once
    handle._run()
  File "C:\Users\marko\AppData\Local\Programs\Python\Python39\lib\asyncio\events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
  File "G:\My Drive\MyBotFolder\Bybit\pybit_bot\pybit_bot\engine.py", line 368, in _main_loop
    await self.check_pending_tpsl_orders()
  File "G:\My Drive\MyBotFolder\Bybit\pybit_bot\pybit_bot\engine.py", line 434, in check_pending_tpsl_orders
    await self._set_tpsl_for_filled_order(
  File "G:\My Drive\MyBotFolder\Bybit\pybit_bot\pybit_bot\engine.py", line 537, in _set_tpsl_for_filled_order
    tpsl_result = await self.order_manager.set_position_tpsl(
  File "G:\My Drive\MyBotFolder\Bybit\pybit_bot\pybit_bot\managers\order_manager.py", line 305, in set_position_tpsl
    result = self.order_client.set_trading_stop(
  File "G:\My Drive\MyBotFolder\Bybit\pybit_bot\pybit_bot\core\order_manager_client.py", line 704, in set_trading_stop
    self.logger.error(f"Exception setting trading stop (attempt {attempt+1}/{max_retries}): {str(e)}")
  File "G:\My Drive\MyBotFolder\Bybit\pybit_bot\pybit_bot\utils\logger.py", line 158, in error
    self._log(logging.ERROR, message, *args, **kwargs)
  File "G:\My Drive\MyBotFolder\Bybit\pybit_bot\pybit_bot\utils\logger.py", line 119, in _log
    self.logger.log(level, formatted_message, **kwargs)
Message: 'Exception setting trading stop (attempt 2/3): not modified (ErrCode: 34040) (ErrTime: 01:07:13).\nRequest → POST https://api-testnet.bybit.com/v5/position/trading-stop: {"category": "linear", "symbol": "BTCUSDT", "positionIdx": 0, "takeProfit": "89311.14", "stopLoss": "87016.74", "tpTriggerBy": "MarkPrice", "slTriggerBy": "MarkPrice"}.'
Arguments: ()
2025-06-21 11:07:13,461 [ERROR] Exception setting trading stop (attempt 2/3): not modified (ErrCode: 34040) (ErrTime: 01:07:13).
Request → POST https://api-testnet.bybit.com/v5/position/trading-stop: {"category": "linear", "symbol": "BTCUSDT", "positionIdx": 0, "takeProfit": "89311.14", "stopLoss": "87016.74", "tpTriggerBy": "MarkPrice", "slTriggerBy": "MarkPrice"}.
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
2025-06-21 11:07:15 [TradingEngine] ERROR: Exception setting trading stop (attempt 3/3): not modified (ErrCode: 34040) (ErrTime: 01:07:15).
Request → POST https://api-testnet.bybit.com/v5/position/trading-stop: {"category": "linear", "symbol": "BTCUSDT", "positionIdx": 0, "takeProfit": "89311.14", "stopLoss": "87016.74", "tpTriggerBy": "MarkPrice", "slTriggerBy": "MarkPrice"}.
--- Logging error ---
Traceback (most recent call last):
  File "G:\My Drive\MyBotFolder\Bybit\pybit_bot\pybit_bot\core\order_manager_client.py", line 682, in set_trading_stop
    response = self.client._make_request("POST", "/v5/position/trading-stop", params)
  File "G:\My Drive\MyBotFolder\Bybit\pybit_bot\pybit_bot\core\client.py", line 156, in _make_request
    response = self.http_client.set_trading_stop(**params)
  File "C:\Users\marko\AppData\Local\Programs\Python\Python39\lib\site-packages\pybit\_v5_position.py", line 176, in set_trading_stop
    return self._submit_request(
  File "C:\Users\marko\AppData\Local\Programs\Python\Python39\lib\site-packages\pybit\_http_manager.py", line377, in _submit_request
    raise InvalidRequestError(
pybit.exceptions.InvalidRequestError: not modified (ErrCode: 34040) (ErrTime: 01:07:15).
Request → POST https://api-testnet.bybit.com/v5/position/trading-stop: {"category": "linear", "symbol": "BTCUSDT", "positionIdx": 0, "takeProfit": "89311.14", "stopLoss": "87016.74", "tpTriggerBy": "MarkPrice", "slTriggerBy": "MarkPrice"}.

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\marko\AppData\Local\Programs\Python\Python39\lib\logging\__init__.py", line 1082, in emit
    stream.write(msg + self.terminator)
  File "C:\Users\marko\AppData\Local\Programs\Python\Python39\lib\encodings\cp1252.py", line 19, in encode
    return codecs.charmap_encode(input,self.errors,encoding_table)[0]
UnicodeEncodeError: 'charmap' codec can't encode character '\u2192' in position 138: character maps to <undefined>
Call stack:
  File "C:\Users\marko\AppData\Local\Programs\Python\Python39\lib\threading.py", line 912, in _bootstrap
    self._bootstrap_inner()
  File "C:\Users\marko\AppData\Local\Programs\Python\Python39\lib\threading.py", line 954, in _bootstrap_inner
    self.run()
  File "C:\Users\marko\AppData\Local\Programs\Python\Python39\lib\threading.py", line 892, in run
    self._target(*self._args, **self._kwargs)
  File "G:\My Drive\MyBotFolder\Bybit\pybit_bot\pybit_bot\engine.py", line 341, in _main_loop_wrapper
    self._event_loop.run_until_complete(self._main_loop())
  File "C:\Users\marko\AppData\Local\Programs\Python\Python39\lib\asyncio\base_events.py", line 629, in run_until_complete
    self.run_forever()
  File "C:\Users\marko\AppData\Local\Programs\Python\Python39\lib\asyncio\windows_events.py", line 316, in run_forever
    super().run_forever()
  File "C:\Users\marko\AppData\Local\Programs\Python\Python39\lib\asyncio\base_events.py", line 596, in run_forever
    self._run_once()
  File "C:\Users\marko\AppData\Local\Programs\Python\Python39\lib\asyncio\base_events.py", line 1890, in _run_once
    handle._run()
  File "C:\Users\marko\AppData\Local\Programs\Python\Python39\lib\asyncio\events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
  File "G:\My Drive\MyBotFolder\Bybit\pybit_bot\pybit_bot\engine.py", line 368, in _main_loop
    await self.check_pending_tpsl_orders()
  File "G:\My Drive\MyBotFolder\Bybit\pybit_bot\pybit_bot\engine.py", line 434, in check_pending_tpsl_orders
    await self._set_tpsl_for_filled_order(
  File "G:\My Drive\MyBotFolder\Bybit\pybit_bot\pybit_bot\engine.py", line 537, in _set_tpsl_for_filled_order
    tpsl_result = await self.order_manager.set_position_tpsl(
  File "G:\My Drive\MyBotFolder\Bybit\pybit_bot\pybit_bot\managers\order_manager.py", line 305, in set_position_tpsl
    result = self.order_client.set_trading_stop(
  File "G:\My Drive\MyBotFolder\Bybit\pybit_bot\pybit_bot\core\order_manager_client.py", line 704, in set_trading_stop
    self.logger.error(f"Exception setting trading stop (attempt {attempt+1}/{max_retries}): {str(e)}")
  File "G:\My Drive\MyBotFolder\Bybit\pybit_bot\pybit_bot\utils\logger.py", line 158, in error
    self._log(logging.ERROR, message, *args, **kwargs)
  File "G:\My Drive\MyBotFolder\Bybit\pybit_bot\pybit_bot\utils\logger.py", line 119, in _log
    self.logger.log(level, formatted_message, **kwargs)
Message: 'Exception setting trading stop (attempt 3/3): not modified (ErrCode: 34040) (ErrTime: 01:07:15).\nRequest → POST https://api-testnet.bybit.com/v5/position/trading-stop: {"category": "linear", "symbol": "BTCUSDT", "positionIdx": 0, "takeProfit": "89311.14", "stopLoss": "87016.74", "tpTriggerBy": "MarkPrice", "slTriggerBy": "MarkPrice"}.'
Arguments: ()
2025-06-21 11:07:15,627 [ERROR] Exception setting trading stop (attempt 3/3): not modified (ErrCode: 34040) (ErrTime: 01:07:15).
Request → POST https://api-testnet.bybit.com/v5/position/trading-stop: {"category": "linear", "symbol": "BTCUSDT", "positionIdx": 0, "takeProfit": "89311.14", "stopLoss": "87016.74", "tpTriggerBy": "MarkPrice", "slTriggerBy": "MarkPrice"}.
2025-06-21 11:07:15 [TradingEngine] ERROR: Failed to set trading stop after 3 attempts
2025-06-21 11:07:15,643 [ERROR] Failed to set trading stop after 3 attempts
2025-06-21 11:07:15 [TradingEngine] INFO: Set TP/SL result: {'error': 'Failed after 3 attempts'}
2025-06-21 11:07:15,643 [INFO] Set TP/SL result: {'error': 'Failed after 3 attempts'}
2025-06-21 11:07:15 [TradingEngine] ERROR: Error setting TP/SL: Failed after 3 attempts
2025-06-21 11:07:15,643 [ERROR] Error setting TP/SL: Failed after 3 attempts
ERROR setting TP/SL: Failed after 3 attempts
Waiting 46 seconds until next minute close
2025-06-21 11:07:15 [TradingEngine] INFO: Waiting 46 seconds until next minute close
2025-06-21 11:07:15,949 [INFO] Waiting 46 seconds until next minute close
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Processing symbol: BTCUSDT at minute close
Processing BTCUSDT on 1m timeframe
Fetching data for BTCUSDT 1m
2025-06-21 11:08:01 [TradingEngine] INFO: Fetching kline data for BTCUSDT 1, limit=100
2025-06-21 11:08:01,959 [INFO] Fetching kline data for BTCUSDT 1, limit=100
Engine status: Running=True, Active positions=0
2025-06-21 11:08:02 [TradingEngine] INFO: Retrieved 100 klines for BTCUSDT
2025-06-21 11:08:02,262 [INFO] Retrieved 100 klines for BTCUSDT
2025-06-21 11:08:02 [TradingEngine] INFO: Klines response type: <class 'list'>, data: [['1750468080000', '87834.1', '87834.1', '87834.1', '87834.1', '0', '0'], ['1750468020000', '88000', '88000', '87746.5', '87834.1', '0.01', '877.8154']]
2025-06-21 11:08:02,262 [INFO] Klines response type: <class 'list'>, data: [['1750468080000', '87834.1', '87834.1', '87834.1', '87834.1', '0', '0'], ['1750468020000', '88000', '88000', '87746.5', '87834.1', '0.01', '877.8154']]
Updated data cache for BTCUSDT 1m
New data received for BTCUSDT 1m
Running strategies for BTCUSDT 1m
2025-06-21 11:08:02 [StrategyB] INFO: Processing data for BTCUSDT with timeframes: ['1m']
2025-06-21 11:08:02,278 [INFO] Processing data for BTCUSDT with timeframes: ['1m']
2025-06-21 11:08:02 [StrategyB] INFO: Latest candle for BTCUSDT 1m:
2025-06-21 11:08:02,278 [INFO] Latest candle for BTCUSDT 1m:
2025-06-21 11:08:02 [StrategyB] INFO: - Time: 2025-06-21 09:29:00 (Minute: 29)
2025-06-21 11:08:02,278 [INFO] - Time: 2025-06-21 09:29:00 (Minute: 29)
2025-06-21 11:08:02 [StrategyB] INFO: - Price: 83288.10
2025-06-21 11:08:02,278 [INFO] - Price: 83288.10
2025-06-21 11:08:02 [StrategyB] INFO: - Even minute: False
2025-06-21 11:08:02,278 [INFO] - Even minute: False
2025-06-21 11:08:02 [StrategyB] INFO: FORCING SELL signal (alternating from previous BUY)
2025-06-21 11:08:02,295 [INFO] FORCING SELL signal (alternating from previous BUY)
2025-06-21 11:08:02 [StrategyB] INFO: Minute 29 is odd, generating SHORT signal
2025-06-21 11:08:02,297 [INFO] Minute 29 is odd, generating SHORT signal
2025-06-21 11:08:02 [StrategyB] INFO: Generated 1 signals for BTCUSDT
2025-06-21 11:08:02,297 [INFO] Generated 1 signals for BTCUSDT
2025-06-21 11:08:02 [StrategyB] INFO: Signal: SignalType.SELL at price 83288.1 with SL=84328.47, TP=81207.36
2025-06-21 11:08:02,297 [INFO] Signal: SignalType.SELL at price 83288.1 with SL=84328.47, TP=81207.36
2025-06-21 11:08:02 [TradingEngine] INFO: ======= BTCUSDT 1m CLOSE at 2025-06-20 23:29:00 =======
2025-06-21 11:08:02,297 [INFO] ======= BTCUSDT 1m CLOSE at 2025-06-20 23:29:00 =======
2025-06-21 11:08:02 [TradingEngine] INFO: OHLCV: Open=82838.60, High=83707.90, Low=82838.60, Close=83288.10, Volume=0.40
2025-06-21 11:08:02,297 [INFO] OHLCV: Open=82838.60, High=83707.90, Low=82838.60, Close=83288.10, Volume=0.40
Processed BTCUSDT 1m candle close at 2025-06-20 23:29:00
Received 1 signals for BTCUSDT
2025-06-21 11:08:02 [TradingEngine] INFO: Signal generated for BTCUSDT: SignalType.SELL SHORT
2025-06-21 11:08:02,297 [INFO] Signal generated for BTCUSDT: SignalType.SELL SHORT
SIGNAL: BTCUSDT SignalType.SELL SHORT
Validating trade for BTCUSDT...
TEST MODE: All trades allowed for testing
Executing signal for BTCUSDT...
Executing signal for BTCUSDT...
Current price for BTCUSDT: 87834.1
Using fixed position size: 0.01
Order side: Sell, direction: SHORT
Placing Sell market order for BTCUSDT without TP/SL
2025-06-21 11:08:02 [TradingEngine] INFO: Entering SHORT position for BTCUSDT, qty=0.01 (without TP/SL)
2025-06-21 11:08:02,647 [INFO] Entering SHORT position for BTCUSDT, qty=0.01 (without TP/SL)
2025-06-21 11:08:02 [TradingEngine] ERROR: Failed to place order: Unknown error
2025-06-21 11:08:02,775 [ERROR] Failed to place order: Unknown error
2025-06-21 11:08:02 [TradingEngine] INFO: SHORT order result: {'orderId': '2fba26c1-6a82-44ac-ad1e-d41513637dc4', 'orderLinkId': ''}
2025-06-21 11:08:02,775 [INFO] SHORT order result: {'orderId': '2fba26c1-6a82-44ac-ad1e-d41513637dc4', 'orderLinkId': ''}
Order not filled immediately, will set TP/SL after fill confirmation
2025-06-21 11:08:02 [TradingEngine] INFO: Order executed for BTCUSDT Sell: 2fba26c1-6a82-44ac-ad1e-d41513637dc4
2025-06-21 11:08:02,775 [INFO] Order executed for BTCUSDT Sell: 2fba26c1-6a82-44ac-ad1e-d41513637dc4
SUCCESS: Order executed for BTCUSDT Sell: 2fba26c1-6a82-44ac-ad1e-d41513637dc4
Processing BTCUSDT on 5m timeframe
Fetching data for BTCUSDT 5m
2025-06-21 11:08:02 [TradingEngine] INFO: Fetching kline data for BTCUSDT 5, limit=100
2025-06-21 11:08:02,775 [INFO] Fetching kline data for BTCUSDT 5, limit=100
2025-06-21 11:08:03 [TradingEngine] INFO: Retrieved 100 klines for BTCUSDT
2025-06-21 11:08:03,141 [INFO] Retrieved 100 klines for BTCUSDT
2025-06-21 11:08:03 [TradingEngine] INFO: Klines response type: <class 'list'>, data: [['1750467900000', '87743.6', '88024.6', '87298.3', '87834.1', '0.244', '21335.3078'], ['1750467600000', '87298.3', '88000', '87298.3', '87743.6', '0.322', '28151.1089']]
2025-06-21 11:08:03,141 [INFO] Klines response type: <class 'list'>, data: [['1750467900000', '87743.6', '88024.6', '87298.3', '87834.1', '0.244', '21335.3078'], ['1750467600000', '87298.3', '88000', '87298.3', '87743.6', '0.322', '28151.1089']]
No new data for BTCUSDT 5m
No new data for BTCUSDT 5m
Processing BTCUSDT on 1h timeframe
Fetching data for BTCUSDT 1h
2025-06-21 11:08:03 [TradingEngine] INFO: Fetching kline data for BTCUSDT 60, limit=100
2025-06-21 11:08:03,156 [INFO] Fetching kline data for BTCUSDT 60, limit=100
2025-06-21 11:08:03 [TradingEngine] INFO: Retrieved 100 klines for BTCUSDT
2025-06-21 11:08:03,289 [INFO] Retrieved 100 klines for BTCUSDT
2025-06-21 11:08:03 [TradingEngine] INFO: Klines response type: <class 'list'>, data: [['1750467600000', '87298.3', '88024.6', '87298.3', '87834.1', '0.566', '49486.4167'], ['1750464000000', '83707.9', '88096.2', '83707.9', '87298.3', '6.67', '576283.1679']]
2025-06-21 11:08:03,289 [INFO] Klines response type: <class 'list'>, data: [['1750467600000', '87298.3', '88024.6', '87298.3', '87834.1', '0.566', '49486.4167'], ['1750464000000', '83707.9', '88096.2', '83707.9', '87298.3', '6.67', '576283.1679']]
No new data for BTCUSDT 1h
No new data for BTCUSDT 1h
Checking TP/SL conditions
2025-06-21 11:08:03 [TradingEngine] INFO: Checking 1 pending TP/SL orders
2025-06-21 11:08:03,291 [INFO] Checking 1 pending TP/SL orders
2025-06-21 11:08:03 [TradingEngine] INFO: Getting order info for 2fba26c1-6a82-44ac-ad1e-d41513637dc4 on BTCUSDT
2025-06-21 11:08:03,293 [INFO] Getting order info for 2fba26c1-6a82-44ac-ad1e-d41513637dc4 on BTCUSDT
2025-06-21 11:08:03 [TradingEngine] INFO: Order 2fba26c1-6a82-44ac-ad1e-d41513637dc4 filled, setting TP/SL
2025-06-21 11:08:03,409 [INFO] Order 2fba26c1-6a82-44ac-ad1e-d41513637dc4 filled, setting TP/SL
2025-06-21 11:08:03 [TradingEngine] INFO: Calculated ATR from historical data: 707.2357142857124
2025-06-21 11:08:03,535 [INFO] Calculated ATR from historical data: 707.2357142857124
2025-06-21 11:08:03 [TradingEngine] INFO: Setting TP/SL for filled order 2fba26c1-6a82-44ac-ad1e-d41513637dc4
2025-06-21 11:08:03,535 [INFO] Setting TP/SL for filled order 2fba26c1-6a82-44ac-ad1e-d41513637dc4
2025-06-21 11:08:03 [TradingEngine] INFO: Getting order info for 2fba26c1-6a82-44ac-ad1e-d41513637dc4 on BTCUSDT
2025-06-21 11:08:03,535 [INFO] Getting order info for 2fba26c1-6a82-44ac-ad1e-d41513637dc4 on BTCUSDT
Engine status: Running=True, Active positions=0
2025-06-21 11:08:03 [TradingEngine] INFO: Fill info for 2fba26c1-6a82-44ac-ad1e-d41513637dc4: {'filled': True, 'fill_price': 87496.73, 'side': 'Sell', 'position_idx': 0}
2025-06-21 11:08:03,844 [INFO] Fill info for 2fba26c1-6a82-44ac-ad1e-d41513637dc4: {'filled': True, 'fill_price': 87496.73, 'side': 'Sell', 'position_idx': 0}
2025-06-21 11:08:03 [TradingEngine] INFO: Final TP/SL for BTCUSDT SHORT: TP=84667.79, SL=88911.20, Mark Price=87834.1
2025-06-21 11:08:03,974 [INFO] Final TP/SL for BTCUSDT SHORT: TP=84667.79, SL=88911.20, Mark Price=87834.1
Engine status: Running=True, Active positions=0
2025-06-21 11:08:05 [TradingEngine] WARNING: Error setting trading stop (attempt 1/3): No response
2025-06-21 11:08:05,616 [WARNING] Error setting trading stop (attempt 1/3): No response
Engine status: Running=True, Active positions=0
2025-06-21 11:08:06 [TradingEngine] ERROR: Exception setting trading stop (attempt 2/3): not modified (ErrCode: 34040) (ErrTime: 01:08:06).
Request → POST https://api-testnet.bybit.com/v5/position/trading-stop: {"category": "linear", "symbol": "BTCUSDT", "positionIdx": 0, "takeProfit": "84667.79", "stopLoss": "88911.20", "tpTriggerBy": "MarkPrice", "slTriggerBy": "MarkPrice"}.
--- Logging error ---
Traceback (most recent call last):
  File "G:\My Drive\MyBotFolder\Bybit\pybit_bot\pybit_bot\core\order_manager_client.py", line 682, in set_trading_stop
    response = self.client._make_request("POST", "/v5/position/trading-stop", params)
  File "G:\My Drive\MyBotFolder\Bybit\pybit_bot\pybit_bot\core\client.py", line 156, in _make_request
    response = self.http_client.set_trading_stop(**params)
  File "C:\Users\marko\AppData\Local\Programs\Python\Python39\lib\site-packages\pybit\_v5_position.py", line 176, in set_trading_stop
    return self._submit_request(
  File "C:\Users\marko\AppData\Local\Programs\Python\Python39\lib\site-packages\pybit\_http_manager.py", line377, in _submit_request
    raise InvalidRequestError(
pybit.exceptions.InvalidRequestError: not modified (ErrCode: 34040) (ErrTime: 01:08:06).
Request → POST https://api-testnet.bybit.com/v5/position/trading-stop: {"category": "linear", "symbol": "BTCUSDT", "positionIdx": 0, "takeProfit": "84667.79", "stopLoss": "88911.20", "tpTriggerBy": "MarkPrice", "slTriggerBy": "MarkPrice"}.

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\marko\AppData\Local\Programs\Python\Python39\lib\logging\__init__.py", line 1082, in emit
    stream.write(msg + self.terminator)
  File "C:\Users\marko\AppData\Local\Programs\Python\Python39\lib\encodings\cp1252.py", line 19, in encode
    return codecs.charmap_encode(input,self.errors,encoding_table)[0]
UnicodeEncodeError: 'charmap' codec can't encode character '\u2192' in position 138: character maps to <undefined>
Call stack:
  File "C:\Users\marko\AppData\Local\Programs\Python\Python39\lib\threading.py", line 912, in _bootstrap
    self._bootstrap_inner()
  File "C:\Users\marko\AppData\Local\Programs\Python\Python39\lib\threading.py", line 954, in _bootstrap_inner
    self.run()
  File "C:\Users\marko\AppData\Local\Programs\Python\Python39\lib\threading.py", line 892, in run
    self._target(*self._args, **self._kwargs)
  File "G:\My Drive\MyBotFolder\Bybit\pybit_bot\pybit_bot\engine.py", line 341, in _main_loop_wrapper
    self._event_loop.run_until_complete(self._main_loop())
  File "C:\Users\marko\AppData\Local\Programs\Python\Python39\lib\asyncio\base_events.py", line 629, in run_until_complete
    self.run_forever()
  File "C:\Users\marko\AppData\Local\Programs\Python\Python39\lib\asyncio\windows_events.py", line 316, in run_forever
    super().run_forever()
  File "C:\Users\marko\AppData\Local\Programs\Python\Python39\lib\asyncio\base_events.py", line 596, in run_forever
    self._run_once()
  File "C:\Users\marko\AppData\Local\Programs\Python\Python39\lib\asyncio\base_events.py", line 1890, in _run_once
    handle._run()
  File "C:\Users\marko\AppData\Local\Programs\Python\Python39\lib\asyncio\events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
  File "G:\My Drive\MyBotFolder\Bybit\pybit_bot\pybit_bot\engine.py", line 394, in _main_loop
    await self.tpsl_manager.check_positions()
  File "G:\My Drive\MyBotFolder\Bybit\pybit_bot\pybit_bot\managers\tpsl_manager.py", line 77, in check_positions
    await self.check_pending_tpsl_orders()
  File "G:\My Drive\MyBotFolder\Bybit\pybit_bot\pybit_bot\managers\tpsl_manager.py", line 151, in check_pending_tpsl_orders
    await self.order_manager.check_pending_tpsl_orders()
  File "G:\My Drive\MyBotFolder\Bybit\pybit_bot\pybit_bot\managers\order_manager.py", line 794, in check_pending_tpsl_orders
    await self.set_tpsl_for_filled_order(symbol, order_id, atr)
  File "G:\My Drive\MyBotFolder\Bybit\pybit_bot\pybit_bot\managers\order_manager.py", line 894, in set_tpsl_for_filled_order
    result = self.order_client.set_trading_stop(
  File "G:\My Drive\MyBotFolder\Bybit\pybit_bot\pybit_bot\core\order_manager_client.py", line 704, in set_trading_stop
    self.logger.error(f"Exception setting trading stop (attempt {attempt+1}/{max_retries}): {str(e)}")
  File "G:\My Drive\MyBotFolder\Bybit\pybit_bot\pybit_bot\utils\logger.py", line 158, in error
    self._log(logging.ERROR, message, *args, **kwargs)
  File "G:\My Drive\MyBotFolder\Bybit\pybit_bot\pybit_bot\utils\logger.py", line 119, in _log
    self.logger.log(level, formatted_message, **kwargs)
Message: 'Exception setting trading stop (attempt 2/3): not modified (ErrCode: 34040) (ErrTime: 01:08:06).\nRequest → POST https://api-testnet.bybit.com/v5/position/trading-stop: {"category": "linear", "symbol": "BTCUSDT", "positionIdx": 0, "takeProfit": "84667.79", "stopLoss": "88911.20", "tpTriggerBy": "MarkPrice", "slTriggerBy": "MarkPrice"}.'
Arguments: ()
2025-06-21 11:08:06,767 [ERROR] Exception setting trading stop (attempt 2/3): not modified (ErrCode: 34040) (ErrTime: 01:08:06).
Request → POST https://api-testnet.bybit.com/v5/position/trading-stop: {"category": "linear", "symbol": "BTCUSDT", "positionIdx": 0, "takeProfit": "84667.79", "stopLoss": "88911.20", "tpTriggerBy": "MarkPrice", "slTriggerBy": "MarkPrice"}.
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
2025-06-21 11:08:09 [TradingEngine] ERROR: Exception setting trading stop (attempt 3/3): not modified (ErrCode: 34040) (ErrTime: 01:08:09).
Request → POST https://api-testnet.bybit.com/v5/position/trading-stop: {"category": "linear", "symbol": "BTCUSDT", "positionIdx": 0, "takeProfit": "84667.79", "stopLoss": "88911.20", "tpTriggerBy": "MarkPrice", "slTriggerBy": "MarkPrice"}.
--- Logging error ---
Traceback (most recent call last):
  File "G:\My Drive\MyBotFolder\Bybit\pybit_bot\pybit_bot\core\order_manager_client.py", line 682, in set_trading_stop
    response = self.client._make_request("POST", "/v5/position/trading-stop", params)
  File "G:\My Drive\MyBotFolder\Bybit\pybit_bot\pybit_bot\core\client.py", line 156, in _make_request
    response = self.http_client.set_trading_stop(**params)
  File "C:\Users\marko\AppData\Local\Programs\Python\Python39\lib\site-packages\pybit\_v5_position.py", line 176, in set_trading_stop
    return self._submit_request(
  File "C:\Users\marko\AppData\Local\Programs\Python\Python39\lib\site-packages\pybit\_http_manager.py", line377, in _submit_request
    raise InvalidRequestError(
pybit.exceptions.InvalidRequestError: not modified (ErrCode: 34040) (ErrTime: 01:08:09).
Request → POST https://api-testnet.bybit.com/v5/position/trading-stop: {"category": "linear", "symbol": "BTCUSDT", "positionIdx": 0, "takeProfit": "84667.79", "stopLoss": "88911.20", "tpTriggerBy": "MarkPrice", "slTriggerBy": "MarkPrice"}.

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\marko\AppData\Local\Programs\Python\Python39\lib\logging\__init__.py", line 1082, in emit
    stream.write(msg + self.terminator)
  File "C:\Users\marko\AppData\Local\Programs\Python\Python39\lib\encodings\cp1252.py", line 19, in encode
    return codecs.charmap_encode(input,self.errors,encoding_table)[0]
UnicodeEncodeError: 'charmap' codec can't encode character '\u2192' in position 138: character maps to <undefined>
Call stack:
  File "C:\Users\marko\AppData\Local\Programs\Python\Python39\lib\threading.py", line 912, in _bootstrap
    self._bootstrap_inner()
  File "C:\Users\marko\AppData\Local\Programs\Python\Python39\lib\threading.py", line 954, in _bootstrap_inner
    self.run()
  File "C:\Users\marko\AppData\Local\Programs\Python\Python39\lib\threading.py", line 892, in run
    self._target(*self._args, **self._kwargs)
  File "G:\My Drive\MyBotFolder\Bybit\pybit_bot\pybit_bot\engine.py", line 341, in _main_loop_wrapper
    self._event_loop.run_until_complete(self._main_loop())
  File "C:\Users\marko\AppData\Local\Programs\Python\Python39\lib\asyncio\base_events.py", line 629, in run_until_complete
    self.run_forever()
  File "C:\Users\marko\AppData\Local\Programs\Python\Python39\lib\asyncio\windows_events.py", line 316, in run_forever
    super().run_forever()
  File "C:\Users\marko\AppData\Local\Programs\Python\Python39\lib\asyncio\base_events.py", line 596, in run_forever
    self._run_once()
  File "C:\Users\marko\AppData\Local\Programs\Python\Python39\lib\asyncio\base_events.py", line 1890, in _run_once
    handle._run()
  File "C:\Users\marko\AppData\Local\Programs\Python\Python39\lib\asyncio\events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
  File "G:\My Drive\MyBotFolder\Bybit\pybit_bot\pybit_bot\engine.py", line 394, in _main_loop
    await self.tpsl_manager.check_positions()
  File "G:\My Drive\MyBotFolder\Bybit\pybit_bot\pybit_bot\managers\tpsl_manager.py", line 77, in check_positions
    await self.check_pending_tpsl_orders()
  File "G:\My Drive\MyBotFolder\Bybit\pybit_bot\pybit_bot\managers\tpsl_manager.py", line 151, in check_pending_tpsl_orders
    await self.order_manager.check_pending_tpsl_orders()
  File "G:\My Drive\MyBotFolder\Bybit\pybit_bot\pybit_bot\managers\order_manager.py", line 794, in check_pending_tpsl_orders
    await self.set_tpsl_for_filled_order(symbol, order_id, atr)
  File "G:\My Drive\MyBotFolder\Bybit\pybit_bot\pybit_bot\managers\order_manager.py", line 894, in set_tpsl_for_filled_order
    result = self.order_client.set_trading_stop(
  File "G:\My Drive\MyBotFolder\Bybit\pybit_bot\pybit_bot\core\order_manager_client.py", line 704, in set_trading_stop
    self.logger.error(f"Exception setting trading stop (attempt {attempt+1}/{max_retries}): {str(e)}")
  File "G:\My Drive\MyBotFolder\Bybit\pybit_bot\pybit_bot\utils\logger.py", line 158, in error
    self._log(logging.ERROR, message, *args, **kwargs)
  File "G:\My Drive\MyBotFolder\Bybit\pybit_bot\pybit_bot\utils\logger.py", line 119, in _log
    self.logger.log(level, formatted_message, **kwargs)
Message: 'Exception setting trading stop (attempt 3/3): not modified (ErrCode: 34040) (ErrTime: 01:08:09).\nRequest → POST https://api-testnet.bybit.com/v5/position/trading-stop: {"category": "linear", "symbol": "BTCUSDT", "positionIdx": 0, "takeProfit": "84667.79", "stopLoss": "88911.20", "tpTriggerBy": "MarkPrice", "slTriggerBy": "MarkPrice"}.'
Arguments: ()
2025-06-21 11:08:09,093 [ERROR] Exception setting trading stop (attempt 3/3): not modified (ErrCode: 34040) (ErrTime: 01:08:09).
Request → POST https://api-testnet.bybit.com/v5/position/trading-stop: {"category": "linear", "symbol": "BTCUSDT", "positionIdx": 0, "takeProfit": "84667.79", "stopLoss": "88911.20", "tpTriggerBy": "MarkPrice", "slTriggerBy": "MarkPrice"}.
2025-06-21 11:08:09 [TradingEngine] ERROR: Failed to set trading stop after 3 attempts
2025-06-21 11:08:09,096 [ERROR] Failed to set trading stop after 3 attempts
Updating position cache
Updating position cache...
Updated position for BTCUSDT: {'symbol': 'BTCUSDT', 'leverage': '1', 'autoAddMargin': 0, 'avgPrice': '87437.9', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '84667.7', 'positionValue': '87.4379', 'isReduceOnly': False, 'tpslMode': 'Full', 'riskId': 1, 'trailingStop': '0', 'unrealisedPnl': '-0.13139', 'markPrice': '87569.29', 'adlRankIndicator': 2, 'cumRealisedPnl': '-744.28234912', 'positionMM': '0.53337119', 'createdTime': '1746973619032', 'positionIdx': 0, 'positionIM': '87.53408169', 'seq': 9481248303, 'updatedTime': '1750468085570', 'side': 'Sell', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '-0.04809084', 'size': '0.001', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '88911.2','tradeMode': 0, 'sessionAvgPrice': ''}
Engine status: Running=True, Active positions=0
2025-06-21 11:08:09 [TradingEngine] INFO: Getting order info for 2fba26c1-6a82-44ac-ad1e-d41513637dc4 on BTCUSDT
2025-06-21 11:08:09,403 [INFO] Getting order info for 2fba26c1-6a82-44ac-ad1e-d41513637dc4 on BTCUSDT
2025-06-21 11:08:09 [TradingEngine] INFO: Fill info for 2fba26c1-6a82-44ac-ad1e-d41513637dc4: {'filled': True, 'fill_price': 87496.73, 'side': 'Sell', 'position_idx': 0}
2025-06-21 11:08:09,548 [INFO] Fill info for 2fba26c1-6a82-44ac-ad1e-d41513637dc4: {'filled': True, 'fill_price': 87496.73, 'side': 'Sell', 'position_idx': 0}
Pending order 2fba26c1-6a82-44ac-ad1e-d41513637dc4 filled at 87496.73, setting TP/SL
Setting TP/SL for filled order 2fba26c1-6a82-44ac-ad1e-d41513637dc4 at price 87496.73
ATR not found in data cache, calculating approximation
Calculated average range as ATR approximation: 388.40714285714057
Using ATR value: 388.40714285714057 for TP/SL calculation
Engine status: Running=True, Active positions=0
Calculated TP/SL for BTCUSDT SHORT: TP=85943.1, SL=88273.54
2025-06-21 11:08:09 [TradingEngine] INFO: Setting TP/SL for BTCUSDT position: TP=85943.1, SL=88273.54
2025-06-21 11:08:09,675 [INFO] Setting TP/SL for BTCUSDT position: TP=85943.1, SL=88273.54
Engine status: Running=True, Active positions=0
2025-06-21 11:08:11 [TradingEngine] WARNING: Error setting trading stop (attempt 1/3): No response
2025-06-21 11:08:11,809 [WARNING] Error setting trading stop (attempt 1/3): No response
Engine status: Running=True, Active positions=0
2025-06-21 11:08:12 [TradingEngine] ERROR: Exception setting trading stop (attempt 2/3): not modified (ErrCode: 34040) (ErrTime: 01:08:12).
Request → POST https://api-testnet.bybit.com/v5/position/trading-stop: {"category": "linear", "symbol": "BTCUSDT", "positionIdx": 0, "takeProfit": "85943.10", "stopLoss": "88273.54", "tpTriggerBy": "MarkPrice", "slTriggerBy": "MarkPrice"}.
--- Logging error ---
Traceback (most recent call last):
  File "G:\My Drive\MyBotFolder\Bybit\pybit_bot\pybit_bot\core\order_manager_client.py", line 682, in set_trading_stop
    response = self.client._make_request("POST", "/v5/position/trading-stop", params)
  File "G:\My Drive\MyBotFolder\Bybit\pybit_bot\pybit_bot\core\client.py", line 156, in _make_request
    response = self.http_client.set_trading_stop(**params)
  File "C:\Users\marko\AppData\Local\Programs\Python\Python39\lib\site-packages\pybit\_v5_position.py", line 176, in set_trading_stop
    return self._submit_request(
  File "C:\Users\marko\AppData\Local\Programs\Python\Python39\lib\site-packages\pybit\_http_manager.py", line377, in _submit_request
    raise InvalidRequestError(
pybit.exceptions.InvalidRequestError: not modified (ErrCode: 34040) (ErrTime: 01:08:12).
Request → POST https://api-testnet.bybit.com/v5/position/trading-stop: {"category": "linear", "symbol": "BTCUSDT", "positionIdx": 0, "takeProfit": "85943.10", "stopLoss": "88273.54", "tpTriggerBy": "MarkPrice", "slTriggerBy": "MarkPrice"}.

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\marko\AppData\Local\Programs\Python\Python39\lib\logging\__init__.py", line 1082, in emit
    stream.write(msg + self.terminator)
  File "C:\Users\marko\AppData\Local\Programs\Python\Python39\lib\encodings\cp1252.py", line 19, in encode
    return codecs.charmap_encode(input,self.errors,encoding_table)[0]
UnicodeEncodeError: 'charmap' codec can't encode character '\u2192' in position 138: character maps to <undefined>
Call stack:
  File "C:\Users\marko\AppData\Local\Programs\Python\Python39\lib\threading.py", line 912, in _bootstrap
    self._bootstrap_inner()
  File "C:\Users\marko\AppData\Local\Programs\Python\Python39\lib\threading.py", line 954, in _bootstrap_inner
    self.run()
  File "C:\Users\marko\AppData\Local\Programs\Python\Python39\lib\threading.py", line 892, in run
    self._target(*self._args, **self._kwargs)
  File "G:\My Drive\MyBotFolder\Bybit\pybit_bot\pybit_bot\engine.py", line 341, in _main_loop_wrapper
    self._event_loop.run_until_complete(self._main_loop())
  File "C:\Users\marko\AppData\Local\Programs\Python\Python39\lib\asyncio\base_events.py", line 629, in run_until_complete
    self.run_forever()
  File "C:\Users\marko\AppData\Local\Programs\Python\Python39\lib\asyncio\windows_events.py", line 316, in run_forever
    super().run_forever()
  File "C:\Users\marko\AppData\Local\Programs\Python\Python39\lib\asyncio\base_events.py", line 596, in run_forever
    self._run_once()
  File "C:\Users\marko\AppData\Local\Programs\Python\Python39\lib\asyncio\base_events.py", line 1890, in _run_once
    handle._run()
  File "C:\Users\marko\AppData\Local\Programs\Python\Python39\lib\asyncio\events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
  File "G:\My Drive\MyBotFolder\Bybit\pybit_bot\pybit_bot\engine.py", line 368, in _main_loop
    await self.check_pending_tpsl_orders()
  File "G:\My Drive\MyBotFolder\Bybit\pybit_bot\pybit_bot\engine.py", line 434, in check_pending_tpsl_orders
    await self._set_tpsl_for_filled_order(
  File "G:\My Drive\MyBotFolder\Bybit\pybit_bot\pybit_bot\engine.py", line 537, in _set_tpsl_for_filled_order
    tpsl_result = await self.order_manager.set_position_tpsl(
  File "G:\My Drive\MyBotFolder\Bybit\pybit_bot\pybit_bot\managers\order_manager.py", line 305, in set_position_tpsl
    result = self.order_client.set_trading_stop(
  File "G:\My Drive\MyBotFolder\Bybit\pybit_bot\pybit_bot\core\order_manager_client.py", line 704, in set_trading_stop
    self.logger.error(f"Exception setting trading stop (attempt {attempt+1}/{max_retries}): {str(e)}")
  File "G:\My Drive\MyBotFolder\Bybit\pybit_bot\pybit_bot\utils\logger.py", line 158, in error
    self._log(logging.ERROR, message, *args, **kwargs)
  File "G:\My Drive\MyBotFolder\Bybit\pybit_bot\pybit_bot\utils\logger.py", line 119, in _log
    self.logger.log(level, formatted_message, **kwargs)
Message: 'Exception setting trading stop (attempt 2/3): not modified (ErrCode: 34040) (ErrTime: 01:08:12).\nRequest → POST https://api-testnet.bybit.com/v5/position/trading-stop: {"category": "linear", "symbol": "BTCUSDT", "positionIdx": 0, "takeProfit": "85943.10", "stopLoss": "88273.54", "tpTriggerBy": "MarkPrice", "slTriggerBy": "MarkPrice"}.'
Arguments: ()
2025-06-21 11:08:12,962 [ERROR] Exception setting trading stop (attempt 2/3): not modified (ErrCode: 34040) (ErrTime: 01:08:12).
Request → POST https://api-testnet.bybit.com/v5/position/trading-stop: {"category": "linear", "symbol": "BTCUSDT", "positionIdx": 0, "takeProfit": "85943.10", "stopLoss": "88273.54", "tpTriggerBy": "MarkPrice", "slTriggerBy": "MarkPrice"}.
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
2025-06-21 11:08:15 [TradingEngine] ERROR: Exception setting trading stop (attempt 3/3): not modified (ErrCode: 34040) (ErrTime: 01:08:15).
Request → POST https://api-testnet.bybit.com/v5/position/trading-stop: {"category": "linear", "symbol": "BTCUSDT", "positionIdx": 0, "takeProfit": "85943.10", "stopLoss": "88273.54", "tpTriggerBy": "MarkPrice", "slTriggerBy": "MarkPrice"}.
--- Logging error ---
Traceback (most recent call last):
  File "G:\My Drive\MyBotFolder\Bybit\pybit_bot\pybit_bot\core\order_manager_client.py", line 682, in set_trading_stop
    response = self.client._make_request("POST", "/v5/position/trading-stop", params)
  File "G:\My Drive\MyBotFolder\Bybit\pybit_bot\pybit_bot\core\client.py", line 156, in _make_request
    response = self.http_client.set_trading_stop(**params)
  File "C:\Users\marko\AppData\Local\Programs\Python\Python39\lib\site-packages\pybit\_v5_position.py", line 176, in set_trading_stop
    return self._submit_request(
  File "C:\Users\marko\AppData\Local\Programs\Python\Python39\lib\site-packages\pybit\_http_manager.py", line377, in _submit_request
    raise InvalidRequestError(
pybit.exceptions.InvalidRequestError: not modified (ErrCode: 34040) (ErrTime: 01:08:15).
Request → POST https://api-testnet.bybit.com/v5/position/trading-stop: {"category": "linear", "symbol": "BTCUSDT", "positionIdx": 0, "takeProfit": "85943.10", "stopLoss": "88273.54", "tpTriggerBy": "MarkPrice", "slTriggerBy": "MarkPrice"}.

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\marko\AppData\Local\Programs\Python\Python39\lib\logging\__init__.py", line 1082, in emit
    stream.write(msg + self.terminator)
  File "C:\Users\marko\AppData\Local\Programs\Python\Python39\lib\encodings\cp1252.py", line 19, in encode
    return codecs.charmap_encode(input,self.errors,encoding_table)[0]
UnicodeEncodeError: 'charmap' codec can't encode character '\u2192' in position 138: character maps to <undefined>
Call stack:
  File "C:\Users\marko\AppData\Local\Programs\Python\Python39\lib\threading.py", line 912, in _bootstrap
    self._bootstrap_inner()
  File "C:\Users\marko\AppData\Local\Programs\Python\Python39\lib\threading.py", line 954, in _bootstrap_inner
    self.run()
  File "C:\Users\marko\AppData\Local\Programs\Python\Python39\lib\threading.py", line 892, in run
    self._target(*self._args, **self._kwargs)
  File "G:\My Drive\MyBotFolder\Bybit\pybit_bot\pybit_bot\engine.py", line 341, in _main_loop_wrapper
    self._event_loop.run_until_complete(self._main_loop())
  File "C:\Users\marko\AppData\Local\Programs\Python\Python39\lib\asyncio\base_events.py", line 629, in run_until_complete
    self.run_forever()
  File "C:\Users\marko\AppData\Local\Programs\Python\Python39\lib\asyncio\windows_events.py", line 316, in run_forever
    super().run_forever()
  File "C:\Users\marko\AppData\Local\Programs\Python\Python39\lib\asyncio\base_events.py", line 596, in run_forever
    self._run_once()
  File "C:\Users\marko\AppData\Local\Programs\Python\Python39\lib\asyncio\base_events.py", line 1890, in _run_once
    handle._run()
  File "C:\Users\marko\AppData\Local\Programs\Python\Python39\lib\asyncio\events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
  File "G:\My Drive\MyBotFolder\Bybit\pybit_bot\pybit_bot\engine.py", line 368, in _main_loop
    await self.check_pending_tpsl_orders()
  File "G:\My Drive\MyBotFolder\Bybit\pybit_bot\pybit_bot\engine.py", line 434, in check_pending_tpsl_orders
    await self._set_tpsl_for_filled_order(
  File "G:\My Drive\MyBotFolder\Bybit\pybit_bot\pybit_bot\engine.py", line 537, in _set_tpsl_for_filled_order
    tpsl_result = await self.order_manager.set_position_tpsl(
  File "G:\My Drive\MyBotFolder\Bybit\pybit_bot\pybit_bot\managers\order_manager.py", line 305, in set_position_tpsl
    result = self.order_client.set_trading_stop(
  File "G:\My Drive\MyBotFolder\Bybit\pybit_bot\pybit_bot\core\order_manager_client.py", line 704, in set_trading_stop
    self.logger.error(f"Exception setting trading stop (attempt {attempt+1}/{max_retries}): {str(e)}")
  File "G:\My Drive\MyBotFolder\Bybit\pybit_bot\pybit_bot\utils\logger.py", line 158, in error
    self._log(logging.ERROR, message, *args, **kwargs)
  File "G:\My Drive\MyBotFolder\Bybit\pybit_bot\pybit_bot\utils\logger.py", line 119, in _log
    self.logger.log(level, formatted_message, **kwargs)
Message: 'Exception setting trading stop (attempt 3/3): not modified (ErrCode: 34040) (ErrTime: 01:08:15).\nRequest → POST https://api-testnet.bybit.com/v5/position/trading-stop: {"category": "linear", "symbol": "BTCUSDT", "positionIdx": 0, "takeProfit": "85943.10", "stopLoss": "88273.54", "tpTriggerBy": "MarkPrice", "slTriggerBy": "MarkPrice"}.'
Arguments: ()
2025-06-21 11:08:15,306 [ERROR] Exception setting trading stop (attempt 3/3): not modified (ErrCode: 34040) (ErrTime: 01:08:15).
Request → POST https://api-testnet.bybit.com/v5/position/trading-stop: {"category": "linear", "symbol": "BTCUSDT", "positionIdx": 0, "takeProfit": "85943.10", "stopLoss": "88273.54", "tpTriggerBy": "MarkPrice", "slTriggerBy": "MarkPrice"}.
2025-06-21 11:08:15 [TradingEngine] ERROR: Failed to set trading stop after 3 attempts
2025-06-21 11:08:15,322 [ERROR] Failed to set trading stop after 3 attempts
2025-06-21 11:08:15 [TradingEngine] INFO: Set TP/SL result: {'error': 'Failed after 3 attempts'}
2025-06-21 11:08:15,337 [INFO] Set TP/SL result: {'error': 'Failed after 3 attempts'}
2025-06-21 11:08:15 [TradingEngine] ERROR: Error setting TP/SL: Failed after 3 attempts
2025-06-21 11:08:15,337 [ERROR] Error setting TP/SL: Failed after 3 attempts
ERROR setting TP/SL: Failed after 3 attempts
Waiting 46 seconds until next minute close
2025-06-21 11:08:15 [TradingEngine] INFO: Waiting 46 seconds until next minute close
2025-06-21 11:08:15,468 [INFO] Waiting 46 seconds until next minute close
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Processing symbol: BTCUSDT at minute close
Processing BTCUSDT on 1m timeframe
Fetching data for BTCUSDT 1m
No new data for BTCUSDT 1m
No new data for BTCUSDT 1m
Processing BTCUSDT on 5m timeframe
Fetching data for BTCUSDT 5m
No new data for BTCUSDT 5m
No new data for BTCUSDT 5m
Processing BTCUSDT on 1h timeframe
Fetching data for BTCUSDT 1h
No new data for BTCUSDT 1h
No new data for BTCUSDT 1h
Checking TP/SL conditions
Updating position cache
Updating position cache...
Updated position for BTCUSDT: {'symbol': 'BTCUSDT', 'leverage': '1', 'autoAddMargin': 0, 'avgPrice': '87437.9', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '85943.1', 'positionValue': '87.4379', 'isReduceOnly': False, 'tpslMode': 'Full', 'riskId': 1, 'trailingStop': '0', 'unrealisedPnl': '-0.1631', 'markPrice': '87601', 'adlRankIndicator': 2, 'cumRealisedPnl': '-744.28234912', 'positionMM': '0.53337119', 'createdTime': '1746973619032', 'positionIdx': 0, 'positionIM': '87.53408169', 'seq': 9481248303, 'updatedTime': '1750468091766', 'side': 'Sell', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '-0.04809084', 'size': '0.001', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '88273.5', 'tradeMode': 0, 'sessionAvgPrice': ''}
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Waiting 60 seconds until next minute close
2025-06-21 11:09:01 [TradingEngine] INFO: Waiting 60 seconds until next minute close
2025-06-21 11:09:01,706 [INFO] Waiting 60 seconds until next minute close
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Processing symbol: BTCUSDT at minute close
Processing BTCUSDT on 1m timeframe
Fetching data for BTCUSDT 1m
2025-06-21 11:10:01 [TradingEngine] INFO: Fetching kline data for BTCUSDT 1, limit=100
2025-06-21 11:10:01,719 [INFO] Fetching kline data for BTCUSDT 1, limit=100
2025-06-21 11:10:01 [TradingEngine] INFO: Retrieved 100 klines for BTCUSDT
2025-06-21 11:10:01,862 [INFO] Retrieved 100 klines for BTCUSDT
2025-06-21 11:10:01 [TradingEngine] INFO: Klines response type: <class 'list'>, data: [['1750468200000', '87298.3', '87298.3', '87298.3', '87298.3', '0', '0'], ['1750468140000', '87474.6', '87474.6', '87298.3', '87298.3', '0.03', '2620.6096']]
2025-06-21 11:10:01,862 [INFO] Klines response type: <class 'list'>, data: [['1750468200000', '87298.3', '87298.3', '87298.3', '87298.3', '0', '0'], ['1750468140000', '87474.6', '87474.6', '87298.3', '87298.3', '0.03', '2620.6096']]
Updated data cache for BTCUSDT 1m
New data received for BTCUSDT 1m
Running strategies for BTCUSDT 1m
2025-06-21 11:10:01 [StrategyB] INFO: Processing data for BTCUSDT with timeframes: ['1m']
2025-06-21 11:10:01,870 [INFO] Processing data for BTCUSDT with timeframes: ['1m']
2025-06-21 11:10:01 [StrategyB] INFO: Latest candle for BTCUSDT 1m:
2025-06-21 11:10:01,874 [INFO] Latest candle for BTCUSDT 1m:
2025-06-21 11:10:01 [StrategyB] INFO: - Time: 2025-06-21 09:31:00 (Minute: 31)
2025-06-21 11:10:01,874 [INFO] - Time: 2025-06-21 09:31:00 (Minute: 31)
2025-06-21 11:10:01 [StrategyB] INFO: - Price: 83500.00
2025-06-21 11:10:01,874 [INFO] - Price: 83500.00
2025-06-21 11:10:01 [StrategyB] INFO: - Even minute: False
2025-06-21 11:10:01,874 [INFO] - Even minute: False
2025-06-21 11:10:01 [StrategyB] INFO: FORCING BUY signal (alternating from previous SELL)
2025-06-21 11:10:01,874 [INFO] FORCING BUY signal (alternating from previous SELL)
2025-06-21 11:10:01 [StrategyB] INFO: Minute 31 is even, generating LONG signal
2025-06-21 11:10:01,877 [INFO] Minute 31 is even, generating LONG signal
2025-06-21 11:10:01 [StrategyB] INFO: Generated 1 signals for BTCUSDT
2025-06-21 11:10:01,877 [INFO] Generated 1 signals for BTCUSDT
2025-06-21 11:10:01 [StrategyB] INFO: Signal: SignalType.BUY at price 83500.0 with SL=82435.8, TP=85628.4
2025-06-21 11:10:01,877 [INFO] Signal: SignalType.BUY at price 83500.0 with SL=82435.8, TP=85628.4
2025-06-21 11:10:01 [TradingEngine] INFO: ======= BTCUSDT 1m CLOSE at 2025-06-20 23:31:00 =======
2025-06-21 11:10:01,878 [INFO] ======= BTCUSDT 1m CLOSE at 2025-06-20 23:31:00 =======
2025-06-21 11:10:01 [TradingEngine] INFO: OHLCV: Open=83287.70, High=83500.00, Low=82910.00, Close=83500.00, Volume=0.06
2025-06-21 11:10:01,878 [INFO] OHLCV: Open=83287.70, High=83500.00, Low=82910.00, Close=83500.00, Volume=0.06
Processed BTCUSDT 1m candle close at 2025-06-20 23:31:00
Received 1 signals for BTCUSDT
2025-06-21 11:10:01 [TradingEngine] INFO: Signal generated for BTCUSDT: SignalType.BUY LONG
2025-06-21 11:10:01,878 [INFO] Signal generated for BTCUSDT: SignalType.BUY LONG
SIGNAL: BTCUSDT SignalType.BUY LONG
Validating trade for BTCUSDT...
TEST MODE: All trades allowed for testing
Executing signal for BTCUSDT...
Executing signal for BTCUSDT...
Current price for BTCUSDT: 87298.3
Using fixed position size: 0.01
Order side: Buy, direction: LONG
Placing Buy market order for BTCUSDT without TP/SL
2025-06-21 11:10:02 [TradingEngine] INFO: Entering LONG position for BTCUSDT, qty=0.01 (without TP/SL)
2025-06-21 11:10:02,197 [INFO] Entering LONG position for BTCUSDT, qty=0.01 (without TP/SL)
Engine status: Running=True, Active positions=0
2025-06-21 11:10:02 [TradingEngine] ERROR: Failed to place order: Unknown error
2025-06-21 11:10:02,512 [ERROR] Failed to place order: Unknown error
2025-06-21 11:10:02 [TradingEngine] INFO: LONG order result: {'orderId': '3dfcdd65-ecac-499b-9d56-4eaf6b880436', 'orderLinkId': ''}
2025-06-21 11:10:02,512 [INFO] LONG order result: {'orderId': '3dfcdd65-ecac-499b-9d56-4eaf6b880436', 'orderLinkId': ''}
Order not filled immediately, will set TP/SL after fill confirmation
2025-06-21 11:10:02 [TradingEngine] INFO: Order executed for BTCUSDT Buy: 3dfcdd65-ecac-499b-9d56-4eaf6b880436
2025-06-21 11:10:02,512 [INFO] Order executed for BTCUSDT Buy: 3dfcdd65-ecac-499b-9d56-4eaf6b880436
SUCCESS: Order executed for BTCUSDT Buy: 3dfcdd65-ecac-499b-9d56-4eaf6b880436
Processing BTCUSDT on 5m timeframe
Fetching data for BTCUSDT 5m
2025-06-21 11:10:02 [TradingEngine] INFO: Fetching kline data for BTCUSDT 5, limit=100
2025-06-21 11:10:02,518 [INFO] Fetching kline data for BTCUSDT 5, limit=100
2025-06-21 11:10:02 [TradingEngine] INFO: Retrieved 100 klines for BTCUSDT
2025-06-21 11:10:02,830 [INFO] Retrieved 100 klines for BTCUSDT
2025-06-21 11:10:02 [TradingEngine] INFO: Klines response type: <class 'list'>, data: [['1750468200000', '87298.3', '87298.3', '87298.3', '87298.3', '0', '0'], ['1750467900000', '87743.6', '88024.6', '87298.3', '87298.3', '0.288', '25180.7831']]
2025-06-21 11:10:02,830 [INFO] Klines response type: <class 'list'>, data: [['1750468200000', '87298.3', '87298.3', '87298.3', '87298.3', '0', '0'], ['1750467900000', '87743.6', '88024.6', '87298.3', '87298.3', '0.288','25180.7831']]
Updated data cache for BTCUSDT 5m
New data received for BTCUSDT 5m
Running strategies for BTCUSDT 5m
2025-06-21 11:10:02 [StrategyB] INFO: Processing data for BTCUSDT with timeframes: ['5m']
2025-06-21 11:10:02,836 [INFO] Processing data for BTCUSDT with timeframes: ['5m']
2025-06-21 11:10:02 [StrategyB] WARNING: Not enough data for BTCUSDT 1m
2025-06-21 11:10:02,836 [WARNING] Not enough data for BTCUSDT 1m
Processing BTCUSDT on 1h timeframe
Fetching data for BTCUSDT 1h
2025-06-21 11:10:02 [TradingEngine] INFO: Fetching kline data for BTCUSDT 60, limit=100
2025-06-21 11:10:02,836 [INFO] Fetching kline data for BTCUSDT 60, limit=100
2025-06-21 11:10:02 [TradingEngine] INFO: Retrieved 100 klines for BTCUSDT
2025-06-21 11:10:02,947 [INFO] Retrieved 100 klines for BTCUSDT
2025-06-21 11:10:02 [TradingEngine] INFO: Klines response type: <class 'list'>, data: [['1750467600000', '87298.3', '88024.6', '87298.3', '87298.3', '0.61', '53331.892'], ['1750464000000', '83707.9', '88096.2', '83707.9', '87298.3', '6.67', '576283.1679']]
2025-06-21 11:10:02,947 [INFO] Klines response type: <class 'list'>, data: [['1750467600000', '87298.3', '88024.6', '87298.3', '87298.3', '0.61', '53331.892'], ['1750464000000', '83707.9', '88096.2', '83707.9', '87298.3', '6.67', '576283.1679']]
No new data for BTCUSDT 1h
No new data for BTCUSDT 1h
Checking TP/SL conditions
2025-06-21 11:10:02 [TradingEngine] INFO: Checking 1 pending TP/SL orders
2025-06-21 11:10:02,963 [INFO] Checking 1 pending TP/SL orders
2025-06-21 11:10:02 [TradingEngine] INFO: Getting order info for 3dfcdd65-ecac-499b-9d56-4eaf6b880436 on BTCUSDT
2025-06-21 11:10:02,963 [INFO] Getting order info for 3dfcdd65-ecac-499b-9d56-4eaf6b880436 on BTCUSDT
2025-06-21 11:10:03 [TradingEngine] INFO: Order 3dfcdd65-ecac-499b-9d56-4eaf6b880436 filled, setting TP/SL
2025-06-21 11:10:03,172 [INFO] Order 3dfcdd65-ecac-499b-9d56-4eaf6b880436 filled, setting TP/SL
2025-06-21 11:10:03 [TradingEngine] INFO: Fetching kline data for BTCUSDT 1, limit=20
2025-06-21 11:10:03,379 [INFO] Fetching kline data for BTCUSDT 1, limit=20
Engine status: Running=True, Active positions=0
2025-06-21 11:10:03 [TradingEngine] INFO: Retrieved 20 klines for BTCUSDT
2025-06-21 11:10:03,687 [INFO] Retrieved 20 klines for BTCUSDT
2025-06-21 11:10:03 [TradingEngine] INFO: Klines response type: <class 'list'>, data: [['1750468200000', '87298.3', '87751.9', '87298.3', '87751.9', '0.01', '876.9745'], ['1750468140000', '87474.6', '87474.6', '87298.3', '87298.3', '0.03', '2620.6096']]
2025-06-21 11:10:03,687 [INFO] Klines response type: <class 'list'>, data: [['1750468200000', '87298.3', '87751.9', '87298.3', '87751.9', '0.01', '876.9745'], ['1750468140000', '87474.6', '87474.6', '87298.3', '87298.3', '0.03', '2620.6096']]
2025-06-21 11:10:03 [TradingEngine] INFO: Calculated ATR from historical data: 686.0999999999985
2025-06-21 11:10:03,687 [INFO] Calculated ATR from historical data: 686.0999999999985
2025-06-21 11:10:03 [TradingEngine] INFO: Setting TP/SL for filled order 3dfcdd65-ecac-499b-9d56-4eaf6b880436
2025-06-21 11:10:03,701 [INFO] Setting TP/SL for filled order 3dfcdd65-ecac-499b-9d56-4eaf6b880436
2025-06-21 11:10:03 [TradingEngine] INFO: Getting order info for 3dfcdd65-ecac-499b-9d56-4eaf6b880436 on BTCUSDT
2025-06-21 11:10:03,701 [INFO] Getting order info for 3dfcdd65-ecac-499b-9d56-4eaf6b880436 on BTCUSDT
2025-06-21 11:10:03 [TradingEngine] INFO: Fill info for 3dfcdd65-ecac-499b-9d56-4eaf6b880436: {'filled': True, 'fill_price': 87697.45, 'side': 'Buy', 'position_idx': 0}
2025-06-21 11:10:03,829 [INFO] Fill info for 3dfcdd65-ecac-499b-9d56-4eaf6b880436: {'filled': True, 'fill_price': 87697.45, 'side': 'Buy', 'position_idx': 0}
2025-06-21 11:10:04 [TradingEngine] INFO: Final TP/SL for BTCUSDT LONG: TP=90441.85, SL=86325.25, Mark Price=87751.9
2025-06-21 11:10:04,301 [INFO] Final TP/SL for BTCUSDT LONG: TP=90441.85, SL=86325.25, Mark Price=87751.9
Engine status: Running=True, Active positions=0
2025-06-21 11:10:05 [TradingEngine] WARNING: Error setting trading stop (attempt 1/3): No response
2025-06-21 11:10:05,927 [WARNING] Error setting trading stop (attempt 1/3): No response
Engine status: Running=True, Active positions=0
2025-06-21 11:10:07 [TradingEngine] ERROR: Exception setting trading stop (attempt 2/3): not modified (ErrCode: 34040) (ErrTime: 01:10:07).
Request → POST https://api-testnet.bybit.com/v5/position/trading-stop: {"category": "linear", "symbol": "BTCUSDT", "positionIdx": 0, "takeProfit": "90441.85", "stopLoss": "86325.25", "tpTriggerBy": "MarkPrice", "slTriggerBy": "MarkPrice"}.
--- Logging error ---
Traceback (most recent call last):
  File "G:\My Drive\MyBotFolder\Bybit\pybit_bot\pybit_bot\core\order_manager_client.py", line 682, in set_trading_stop
    response = self.client._make_request("POST", "/v5/position/trading-stop", params)
  File "G:\My Drive\MyBotFolder\Bybit\pybit_bot\pybit_bot\core\client.py", line 156, in _make_request
    response = self.http_client.set_trading_stop(**params)
  File "C:\Users\marko\AppData\Local\Programs\Python\Python39\lib\site-packages\pybit\_v5_position.py", line 176, in set_trading_stop
    return self._submit_request(
  File "C:\Users\marko\AppData\Local\Programs\Python\Python39\lib\site-packages\pybit\_http_manager.py", line377, in _submit_request
    raise InvalidRequestError(
pybit.exceptions.InvalidRequestError: not modified (ErrCode: 34040) (ErrTime: 01:10:07).
Request → POST https://api-testnet.bybit.com/v5/position/trading-stop: {"category": "linear", "symbol": "BTCUSDT", "positionIdx": 0, "takeProfit": "90441.85", "stopLoss": "86325.25", "tpTriggerBy": "MarkPrice", "slTriggerBy": "MarkPrice"}.

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\marko\AppData\Local\Programs\Python\Python39\lib\logging\__init__.py", line 1082, in emit
    stream.write(msg + self.terminator)
  File "C:\Users\marko\AppData\Local\Programs\Python\Python39\lib\encodings\cp1252.py", line 19, in encode
    return codecs.charmap_encode(input,self.errors,encoding_table)[0]
UnicodeEncodeError: 'charmap' codec can't encode character '\u2192' in position 138: character maps to <undefined>
Call stack:
  File "C:\Users\marko\AppData\Local\Programs\Python\Python39\lib\threading.py", line 912, in _bootstrap
    self._bootstrap_inner()
  File "C:\Users\marko\AppData\Local\Programs\Python\Python39\lib\threading.py", line 954, in _bootstrap_inner
    self.run()
  File "C:\Users\marko\AppData\Local\Programs\Python\Python39\lib\threading.py", line 892, in run
    self._target(*self._args, **self._kwargs)
  File "G:\My Drive\MyBotFolder\Bybit\pybit_bot\pybit_bot\engine.py", line 341, in _main_loop_wrapper
    self._event_loop.run_until_complete(self._main_loop())
  File "C:\Users\marko\AppData\Local\Programs\Python\Python39\lib\asyncio\base_events.py", line 629, in run_until_complete
    self.run_forever()
  File "C:\Users\marko\AppData\Local\Programs\Python\Python39\lib\asyncio\windows_events.py", line 316, in run_forever
    super().run_forever()
  File "C:\Users\marko\AppData\Local\Programs\Python\Python39\lib\asyncio\base_events.py", line 596, in run_forever
    self._run_once()
  File "C:\Users\marko\AppData\Local\Programs\Python\Python39\lib\asyncio\base_events.py", line 1890, in _run_once
    handle._run()
  File "C:\Users\marko\AppData\Local\Programs\Python\Python39\lib\asyncio\events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
  File "G:\My Drive\MyBotFolder\Bybit\pybit_bot\pybit_bot\engine.py", line 394, in _main_loop
    await self.tpsl_manager.check_positions()
  File "G:\My Drive\MyBotFolder\Bybit\pybit_bot\pybit_bot\managers\tpsl_manager.py", line 77, in check_positions
    await self.check_pending_tpsl_orders()
  File "G:\My Drive\MyBotFolder\Bybit\pybit_bot\pybit_bot\managers\tpsl_manager.py", line 151, in check_pending_tpsl_orders
    await self.order_manager.check_pending_tpsl_orders()
  File "G:\My Drive\MyBotFolder\Bybit\pybit_bot\pybit_bot\managers\order_manager.py", line 794, in check_pending_tpsl_orders
    await self.set_tpsl_for_filled_order(symbol, order_id, atr)
  File "G:\My Drive\MyBotFolder\Bybit\pybit_bot\pybit_bot\managers\order_manager.py", line 894, in set_tpsl_for_filled_order
    result = self.order_client.set_trading_stop(
  File "G:\My Drive\MyBotFolder\Bybit\pybit_bot\pybit_bot\core\order_manager_client.py", line 704, in set_trading_stop
    self.logger.error(f"Exception setting trading stop (attempt {attempt+1}/{max_retries}): {str(e)}")
  File "G:\My Drive\MyBotFolder\Bybit\pybit_bot\pybit_bot\utils\logger.py", line 158, in error
    self._log(logging.ERROR, message, *args, **kwargs)
  File "G:\My Drive\MyBotFolder\Bybit\pybit_bot\pybit_bot\utils\logger.py", line 119, in _log
    self.logger.log(level, formatted_message, **kwargs)
Message: 'Exception setting trading stop (attempt 2/3): not modified (ErrCode: 34040) (ErrTime: 01:10:07).\nRequest → POST https://api-testnet.bybit.com/v5/position/trading-stop: {"category": "linear", "symbol": "BTCUSDT", "positionIdx": 0, "takeProfit": "90441.85", "stopLoss": "86325.25", "tpTriggerBy": "MarkPrice", "slTriggerBy": "MarkPrice"}.'
Arguments: ()
2025-06-21 11:10:07,086 [ERROR] Exception setting trading stop (attempt 2/3): not modified (ErrCode: 34040) (ErrTime: 01:10:07).
Request → POST https://api-testnet.bybit.com/v5/position/trading-stop: {"category": "linear", "symbol": "BTCUSDT", "positionIdx": 0, "takeProfit": "90441.85", "stopLoss": "86325.25", "tpTriggerBy": "MarkPrice", "slTriggerBy": "MarkPrice"}.
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
2025-06-21 11:10:09 [TradingEngine] ERROR: Exception setting trading stop (attempt 3/3): not modified (ErrCode: 34040) (ErrTime: 01:10:09).
Request → POST https://api-testnet.bybit.com/v5/position/trading-stop: {"category": "linear", "symbol": "BTCUSDT", "positionIdx": 0, "takeProfit": "90441.85", "stopLoss": "86325.25", "tpTriggerBy": "MarkPrice", "slTriggerBy": "MarkPrice"}.
--- Logging error ---
Traceback (most recent call last):
  File "G:\My Drive\MyBotFolder\Bybit\pybit_bot\pybit_bot\core\order_manager_client.py", line 682, in set_trading_stop
    response = self.client._make_request("POST", "/v5/position/trading-stop", params)
  File "G:\My Drive\MyBotFolder\Bybit\pybit_bot\pybit_bot\core\client.py", line 156, in _make_request
    response = self.http_client.set_trading_stop(**params)
  File "C:\Users\marko\AppData\Local\Programs\Python\Python39\lib\site-packages\pybit\_v5_position.py", line 176, in set_trading_stop
    return self._submit_request(
  File "C:\Users\marko\AppData\Local\Programs\Python\Python39\lib\site-packages\pybit\_http_manager.py", line377, in _submit_request
    raise InvalidRequestError(
pybit.exceptions.InvalidRequestError: not modified (ErrCode: 34040) (ErrTime: 01:10:09).
Request → POST https://api-testnet.bybit.com/v5/position/trading-stop: {"category": "linear", "symbol": "BTCUSDT", "positionIdx": 0, "takeProfit": "90441.85", "stopLoss": "86325.25", "tpTriggerBy": "MarkPrice", "slTriggerBy": "MarkPrice"}.

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\marko\AppData\Local\Programs\Python\Python39\lib\logging\__init__.py", line 1082, in emit
    stream.write(msg + self.terminator)
  File "C:\Users\marko\AppData\Local\Programs\Python\Python39\lib\encodings\cp1252.py", line 19, in encode
    return codecs.charmap_encode(input,self.errors,encoding_table)[0]
UnicodeEncodeError: 'charmap' codec can't encode character '\u2192' in position 138: character maps to <undefined>
Call stack:
  File "C:\Users\marko\AppData\Local\Programs\Python\Python39\lib\threading.py", line 912, in _bootstrap
    self._bootstrap_inner()
  File "C:\Users\marko\AppData\Local\Programs\Python\Python39\lib\threading.py", line 954, in _bootstrap_inner
    self.run()
  File "C:\Users\marko\AppData\Local\Programs\Python\Python39\lib\threading.py", line 892, in run
    self._target(*self._args, **self._kwargs)
  File "G:\My Drive\MyBotFolder\Bybit\pybit_bot\pybit_bot\engine.py", line 341, in _main_loop_wrapper
    self._event_loop.run_until_complete(self._main_loop())
  File "C:\Users\marko\AppData\Local\Programs\Python\Python39\lib\asyncio\base_events.py", line 629, in run_until_complete
    self.run_forever()
  File "C:\Users\marko\AppData\Local\Programs\Python\Python39\lib\asyncio\windows_events.py", line 316, in run_forever
    super().run_forever()
  File "C:\Users\marko\AppData\Local\Programs\Python\Python39\lib\asyncio\base_events.py", line 596, in run_forever
    self._run_once()
  File "C:\Users\marko\AppData\Local\Programs\Python\Python39\lib\asyncio\base_events.py", line 1890, in _run_once
    handle._run()
  File "C:\Users\marko\AppData\Local\Programs\Python\Python39\lib\asyncio\events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
  File "G:\My Drive\MyBotFolder\Bybit\pybit_bot\pybit_bot\engine.py", line 394, in _main_loop
    await self.tpsl_manager.check_positions()
  File "G:\My Drive\MyBotFolder\Bybit\pybit_bot\pybit_bot\managers\tpsl_manager.py", line 77, in check_positions
    await self.check_pending_tpsl_orders()
  File "G:\My Drive\MyBotFolder\Bybit\pybit_bot\pybit_bot\managers\tpsl_manager.py", line 151, in check_pending_tpsl_orders
    await self.order_manager.check_pending_tpsl_orders()
  File "G:\My Drive\MyBotFolder\Bybit\pybit_bot\pybit_bot\managers\order_manager.py", line 794, in check_pending_tpsl_orders
    await self.set_tpsl_for_filled_order(symbol, order_id, atr)
  File "G:\My Drive\MyBotFolder\Bybit\pybit_bot\pybit_bot\managers\order_manager.py", line 894, in set_tpsl_for_filled_order
    result = self.order_client.set_trading_stop(
  File "G:\My Drive\MyBotFolder\Bybit\pybit_bot\pybit_bot\core\order_manager_client.py", line 704, in set_trading_stop
    self.logger.error(f"Exception setting trading stop (attempt {attempt+1}/{max_retries}): {str(e)}")
  File "G:\My Drive\MyBotFolder\Bybit\pybit_bot\pybit_bot\utils\logger.py", line 158, in error
    self._log(logging.ERROR, message, *args, **kwargs)
  File "G:\My Drive\MyBotFolder\Bybit\pybit_bot\pybit_bot\utils\logger.py", line 119, in _log
    self.logger.log(level, formatted_message, **kwargs)
Message: 'Exception setting trading stop (attempt 3/3): not modified (ErrCode: 34040) (ErrTime: 01:10:09).\nRequest → POST https://api-testnet.bybit.com/v5/position/trading-stop: {"category": "linear", "symbol": "BTCUSDT", "positionIdx": 0, "takeProfit": "90441.85", "stopLoss": "86325.25", "tpTriggerBy": "MarkPrice", "slTriggerBy": "MarkPrice"}.'
Arguments: ()
2025-06-21 11:10:09,432 [ERROR] Exception setting trading stop (attempt 3/3): not modified (ErrCode: 34040) (ErrTime: 01:10:09).
Request → POST https://api-testnet.bybit.com/v5/position/trading-stop: {"category": "linear", "symbol": "BTCUSDT", "positionIdx": 0, "takeProfit": "90441.85", "stopLoss": "86325.25", "tpTriggerBy": "MarkPrice", "slTriggerBy": "MarkPrice"}.
2025-06-21 11:10:09 [TradingEngine] ERROR: Failed to set trading stop after 3 attempts
2025-06-21 11:10:09,432 [ERROR] Failed to set trading stop after 3 attempts
Updating position cache
Updating position cache...
Updated position for BTCUSDT: {'symbol': 'BTCUSDT', 'leverage': '1', 'autoAddMargin': 0, 'avgPrice': '87701.13333333', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '90441.8', 'positionValue': '789.3102', 'isReduceOnly': False, 'tpslMode': 'Full', 'riskId': 1, 'trailingStop': '0', 'unrealisedPnl': '0.4569', 'markPrice': '87751.9', 'adlRankIndicator': 2, 'cumRealisedPnl': '-744.9910851', 'positionMM': '3.946551', 'createdTime': '1746973619032', 'positionIdx': 0, 'positionIM': '789.3102', 'seq': 9481248597, 'updatedTime': '1750468205884', 'side': 'Buy', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl':'-0.43412061', 'size': '0.009', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '86325.2', 'tradeMode': 0, 'sessionAvgPrice': ''}
Engine status: Running=True, Active positions=0
2025-06-21 11:10:09 [TradingEngine] INFO: Getting order info for 3dfcdd65-ecac-499b-9d56-4eaf6b880436 on BTCUSDT
2025-06-21 11:10:09,751 [INFO] Getting order info for 3dfcdd65-ecac-499b-9d56-4eaf6b880436 on BTCUSDT
2025-06-21 11:10:10 [TradingEngine] INFO: Fill info for 3dfcdd65-ecac-499b-9d56-4eaf6b880436: {'filled': True, 'fill_price': 87697.45, 'side': 'Buy', 'position_idx': 0}
2025-06-21 11:10:10,133 [INFO] Fill info for 3dfcdd65-ecac-499b-9d56-4eaf6b880436: {'filled': True, 'fill_price': 87697.45, 'side': 'Buy', 'position_idx': 0}
Pending order 3dfcdd65-ecac-499b-9d56-4eaf6b880436 filled at 87697.45, setting TP/SL
Setting TP/SL for filled order 3dfcdd65-ecac-499b-9d56-4eaf6b880436 at price 87697.45
ATR not found in data cache, calculating approximation
Calculated average range as ATR approximation: 415.4571428571414
Using ATR value: 415.4571428571414 for TP/SL calculation
Calculated TP/SL for BTCUSDT LONG: TP=89359.28, SL=86866.54
2025-06-21 11:10:10 [TradingEngine] INFO: Setting TP/SL for BTCUSDT position: TP=89359.28, SL=86866.54
2025-06-21 11:10:10,470 [INFO] Setting TP/SL for BTCUSDT position: TP=89359.28, SL=86866.54
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
2025-06-21 11:10:12 [TradingEngine] WARNING: Error setting trading stop (attempt 1/3): No response
2025-06-21 11:10:12,407 [WARNING] Error setting trading stop (attempt 1/3): No response
Engine status: Running=True, Active positions=0
2025-06-21 11:10:13 [TradingEngine] ERROR: Exception setting trading stop (attempt 2/3): not modified (ErrCode: 34040) (ErrTime: 01:10:13).
Request → POST https://api-testnet.bybit.com/v5/position/trading-stop: {"category": "linear", "symbol": "BTCUSDT", "positionIdx": 0, "takeProfit": "89359.28", "stopLoss": "86866.54", "tpTriggerBy": "MarkPrice", "slTriggerBy": "MarkPrice"}.
--- Logging error ---
Traceback (most recent call last):
  File "G:\My Drive\MyBotFolder\Bybit\pybit_bot\pybit_bot\core\order_manager_client.py", line 682, in set_trading_stop
    response = self.client._make_request("POST", "/v5/position/trading-stop", params)
  File "G:\My Drive\MyBotFolder\Bybit\pybit_bot\pybit_bot\core\client.py", line 156, in _make_request
    response = self.http_client.set_trading_stop(**params)
  File "C:\Users\marko\AppData\Local\Programs\Python\Python39\lib\site-packages\pybit\_v5_position.py", line 176, in set_trading_stop
    return self._submit_request(
  File "C:\Users\marko\AppData\Local\Programs\Python\Python39\lib\site-packages\pybit\_http_manager.py", line377, in _submit_request
    raise InvalidRequestError(
pybit.exceptions.InvalidRequestError: not modified (ErrCode: 34040) (ErrTime: 01:10:13).
Request → POST https://api-testnet.bybit.com/v5/position/trading-stop: {"category": "linear", "symbol": "BTCUSDT", "positionIdx": 0, "takeProfit": "89359.28", "stopLoss": "86866.54", "tpTriggerBy": "MarkPrice", "slTriggerBy": "MarkPrice"}.

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\marko\AppData\Local\Programs\Python\Python39\lib\logging\__init__.py", line 1082, in emit
    stream.write(msg + self.terminator)
  File "C:\Users\marko\AppData\Local\Programs\Python\Python39\lib\encodings\cp1252.py", line 19, in encode
    return codecs.charmap_encode(input,self.errors,encoding_table)[0]
UnicodeEncodeError: 'charmap' codec can't encode character '\u2192' in position 138: character maps to <undefined>
Call stack:
  File "C:\Users\marko\AppData\Local\Programs\Python\Python39\lib\threading.py", line 912, in _bootstrap
    self._bootstrap_inner()
  File "C:\Users\marko\AppData\Local\Programs\Python\Python39\lib\threading.py", line 954, in _bootstrap_inner
    self.run()
  File "C:\Users\marko\AppData\Local\Programs\Python\Python39\lib\threading.py", line 892, in run
    self._target(*self._args, **self._kwargs)
  File "G:\My Drive\MyBotFolder\Bybit\pybit_bot\pybit_bot\engine.py", line 341, in _main_loop_wrapper
    self._event_loop.run_until_complete(self._main_loop())
  File "C:\Users\marko\AppData\Local\Programs\Python\Python39\lib\asyncio\base_events.py", line 629, in run_until_complete
    self.run_forever()
  File "C:\Users\marko\AppData\Local\Programs\Python\Python39\lib\asyncio\windows_events.py", line 316, in run_forever
    super().run_forever()
  File "C:\Users\marko\AppData\Local\Programs\Python\Python39\lib\asyncio\base_events.py", line 596, in run_forever
    self._run_once()
  File "C:\Users\marko\AppData\Local\Programs\Python\Python39\lib\asyncio\base_events.py", line 1890, in _run_once
    handle._run()
  File "C:\Users\marko\AppData\Local\Programs\Python\Python39\lib\asyncio\events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
  File "G:\My Drive\MyBotFolder\Bybit\pybit_bot\pybit_bot\engine.py", line 368, in _main_loop
    await self.check_pending_tpsl_orders()
  File "G:\My Drive\MyBotFolder\Bybit\pybit_bot\pybit_bot\engine.py", line 434, in check_pending_tpsl_orders
    await self._set_tpsl_for_filled_order(
  File "G:\My Drive\MyBotFolder\Bybit\pybit_bot\pybit_bot\engine.py", line 537, in _set_tpsl_for_filled_order
    tpsl_result = await self.order_manager.set_position_tpsl(
  File "G:\My Drive\MyBotFolder\Bybit\pybit_bot\pybit_bot\managers\order_manager.py", line 305, in set_position_tpsl
    result = self.order_client.set_trading_stop(
  File "G:\My Drive\MyBotFolder\Bybit\pybit_bot\pybit_bot\core\order_manager_client.py", line 704, in set_trading_stop
    self.logger.error(f"Exception setting trading stop (attempt {attempt+1}/{max_retries}): {str(e)}")
  File "G:\My Drive\MyBotFolder\Bybit\pybit_bot\pybit_bot\utils\logger.py", line 158, in error
    self._log(logging.ERROR, message, *args, **kwargs)
  File "G:\My Drive\MyBotFolder\Bybit\pybit_bot\pybit_bot\utils\logger.py", line 119, in _log
    self.logger.log(level, formatted_message, **kwargs)
Message: 'Exception setting trading stop (attempt 2/3): not modified (ErrCode: 34040) (ErrTime: 01:10:13).\nRequest → POST https://api-testnet.bybit.com/v5/position/trading-stop: {"category": "linear", "symbol": "BTCUSDT", "positionIdx": 0, "takeProfit": "89359.28", "stopLoss": "86866.54", "tpTriggerBy": "MarkPrice", "slTriggerBy": "MarkPrice"}.'
Arguments: ()
2025-06-21 11:10:13,745 [ERROR] Exception setting trading stop (attempt 2/3): not modified (ErrCode: 34040) (ErrTime: 01:10:13).
Request → POST https://api-testnet.bybit.com/v5/position/trading-stop: {"category": "linear", "symbol": "BTCUSDT", "positionIdx": 0, "takeProfit": "89359.28", "stopLoss": "86866.54", "tpTriggerBy": "MarkPrice", "slTriggerBy": "MarkPrice"}.
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
2025-06-21 11:10:16 [TradingEngine] ERROR: Exception setting trading stop (attempt 3/3): not modified (ErrCode: 34040) (ErrTime: 01:10:16).
Request → POST https://api-testnet.bybit.com/v5/position/trading-stop: {"category": "linear", "symbol": "BTCUSDT", "positionIdx": 0, "takeProfit": "89359.28", "stopLoss": "86866.54", "tpTriggerBy": "MarkPrice", "slTriggerBy": "MarkPrice"}.
--- Logging error ---
Traceback (most recent call last):
  File "G:\My Drive\MyBotFolder\Bybit\pybit_bot\pybit_bot\core\order_manager_client.py", line 682, in set_trading_stop
    response = self.client._make_request("POST", "/v5/position/trading-stop", params)
  File "G:\My Drive\MyBotFolder\Bybit\pybit_bot\pybit_bot\core\client.py", line 156, in _make_request
    response = self.http_client.set_trading_stop(**params)
  File "C:\Users\marko\AppData\Local\Programs\Python\Python39\lib\site-packages\pybit\_v5_position.py", line 176, in set_trading_stop
    return self._submit_request(
  File "C:\Users\marko\AppData\Local\Programs\Python\Python39\lib\site-packages\pybit\_http_manager.py", line377, in _submit_request
    raise InvalidRequestError(
pybit.exceptions.InvalidRequestError: not modified (ErrCode: 34040) (ErrTime: 01:10:16).
Request → POST https://api-testnet.bybit.com/v5/position/trading-stop: {"category": "linear", "symbol": "BTCUSDT", "positionIdx": 0, "takeProfit": "89359.28", "stopLoss": "86866.54", "tpTriggerBy": "MarkPrice", "slTriggerBy": "MarkPrice"}.

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\marko\AppData\Local\Programs\Python\Python39\lib\logging\__init__.py", line 1082, in emit
    stream.write(msg + self.terminator)
  File "C:\Users\marko\AppData\Local\Programs\Python\Python39\lib\encodings\cp1252.py", line 19, in encode
    return codecs.charmap_encode(input,self.errors,encoding_table)[0]
UnicodeEncodeError: 'charmap' codec can't encode character '\u2192' in position 138: character maps to <undefined>
Call stack:
  File "C:\Users\marko\AppData\Local\Programs\Python\Python39\lib\threading.py", line 912, in _bootstrap
    self._bootstrap_inner()
  File "C:\Users\marko\AppData\Local\Programs\Python\Python39\lib\threading.py", line 954, in _bootstrap_inner
    self.run()
  File "C:\Users\marko\AppData\Local\Programs\Python\Python39\lib\threading.py", line 892, in run
    self._target(*self._args, **self._kwargs)
  File "G:\My Drive\MyBotFolder\Bybit\pybit_bot\pybit_bot\engine.py", line 341, in _main_loop_wrapper
    self._event_loop.run_until_complete(self._main_loop())
  File "C:\Users\marko\AppData\Local\Programs\Python\Python39\lib\asyncio\base_events.py", line 629, in run_until_complete
    self.run_forever()
  File "C:\Users\marko\AppData\Local\Programs\Python\Python39\lib\asyncio\windows_events.py", line 316, in run_forever
    super().run_forever()
  File "C:\Users\marko\AppData\Local\Programs\Python\Python39\lib\asyncio\base_events.py", line 596, in run_forever
    self._run_once()
  File "C:\Users\marko\AppData\Local\Programs\Python\Python39\lib\asyncio\base_events.py", line 1890, in _run_once
    handle._run()
  File "C:\Users\marko\AppData\Local\Programs\Python\Python39\lib\asyncio\events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
  File "G:\My Drive\MyBotFolder\Bybit\pybit_bot\pybit_bot\engine.py", line 368, in _main_loop
    await self.check_pending_tpsl_orders()
  File "G:\My Drive\MyBotFolder\Bybit\pybit_bot\pybit_bot\engine.py", line 434, in check_pending_tpsl_orders
    await self._set_tpsl_for_filled_order(
  File "G:\My Drive\MyBotFolder\Bybit\pybit_bot\pybit_bot\engine.py", line 537, in _set_tpsl_for_filled_order
    tpsl_result = await self.order_manager.set_position_tpsl(
  File "G:\My Drive\MyBotFolder\Bybit\pybit_bot\pybit_bot\managers\order_manager.py", line 305, in set_position_tpsl
    result = self.order_client.set_trading_stop(
  File "G:\My Drive\MyBotFolder\Bybit\pybit_bot\pybit_bot\core\order_manager_client.py", line 704, in set_trading_stop
    self.logger.error(f"Exception setting trading stop (attempt {attempt+1}/{max_retries}): {str(e)}")
  File "G:\My Drive\MyBotFolder\Bybit\pybit_bot\pybit_bot\utils\logger.py", line 158, in error
    self._log(logging.ERROR, message, *args, **kwargs)
  File "G:\My Drive\MyBotFolder\Bybit\pybit_bot\pybit_bot\utils\logger.py", line 119, in _log
    self.logger.log(level, formatted_message, **kwargs)
Message: 'Exception setting trading stop (attempt 3/3): not modified (ErrCode: 34040) (ErrTime: 01:10:16).\nRequest → POST https://api-testnet.bybit.com/v5/position/trading-stop: {"category": "linear", "symbol": "BTCUSDT", "positionIdx": 0, "takeProfit": "89359.28", "stopLoss": "86866.54", "tpTriggerBy": "MarkPrice", "slTriggerBy": "MarkPrice"}.'
Arguments: ()
2025-06-21 11:10:16,079 [ERROR] Exception setting trading stop (attempt 3/3): not modified (ErrCode: 34040) (ErrTime: 01:10:16).
Request → POST https://api-testnet.bybit.com/v5/position/trading-stop: {"category": "linear", "symbol": "BTCUSDT", "positionIdx": 0, "takeProfit": "89359.28", "stopLoss": "86866.54", "tpTriggerBy": "MarkPrice", "slTriggerBy": "MarkPrice"}.
2025-06-21 11:10:16 [TradingEngine] ERROR: Failed to set trading stop after 3 attempts
2025-06-21 11:10:16,095 [ERROR] Failed to set trading stop after 3 attempts
2025-06-21 11:10:16 [TradingEngine] INFO: Set TP/SL result: {'error': 'Failed after 3 attempts'}
2025-06-21 11:10:16,095 [INFO] Set TP/SL result: {'error': 'Failed after 3 attempts'}
2025-06-21 11:10:16 [TradingEngine] ERROR: Error setting TP/SL: Failed after 3 attempts
2025-06-21 11:10:16,110 [ERROR] Error setting TP/SL: Failed after 3 attempts
ERROR setting TP/SL: Failed after 3 attempts
Waiting 45 seconds until next minute close
2025-06-21 11:10:16 [TradingEngine] INFO: Waiting 45 seconds until next minute close
2025-06-21 11:10:16,237 [INFO] Waiting 45 seconds until next minute close
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Processing symbol: BTCUSDT at minute close
Processing BTCUSDT on 1m timeframe
Fetching data for BTCUSDT 1m
No new data for BTCUSDT 1m
No new data for BTCUSDT 1m
Processing BTCUSDT on 5m timeframe
Fetching data for BTCUSDT 5m
No new data for BTCUSDT 5m
No new data for BTCUSDT 5m
Processing BTCUSDT on 1h timeframe
Fetching data for BTCUSDT 1h
No new data for BTCUSDT 1h
No new data for BTCUSDT 1h
Checking TP/SL conditions
Updating position cache
Updating position cache...
Updated position for BTCUSDT: {'symbol': 'BTCUSDT', 'leverage': '1', 'autoAddMargin': 0, 'avgPrice': '87701.13333333', 'liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '89359.2', 'positionValue': '789.3102', 'isReduceOnly': False, 'tpslMode': 'Full', 'riskId': 1, 'trailingStop': '0', 'unrealisedPnl': '-0.5844', 'markPrice': '87636.2', 'adlRankIndicator': 2, 'cumRealisedPnl': '-744.9910851', 'positionMM': '3.946551', 'createdTime': '1746973619032', 'positionIdx': 0, 'positionIM': '789.3102', 'seq': 9481248597, 'updatedTime': '1750468212356', 'side': 'Buy', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '-0.43412061', 'size': '0.009', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '86866.5', 'tradeMode': 0, 'sessionAvgPrice': ''}
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Waiting 60 seconds until next minute close
2025-06-21 11:11:01 [TradingEngine] INFO: Waiting 60 seconds until next minute close
2025-06-21 11:11:01,712 [INFO] Waiting 60 seconds until next minute close
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Processing symbol: BTCUSDT at minute close
Processing BTCUSDT on 1m timeframe
Fetching data for BTCUSDT 1m
2025-06-21 11:12:01 [TradingEngine] INFO: Fetching kline data for BTCUSDT 1, limit=100
2025-06-21 11:12:01,716 [INFO] Fetching kline data for BTCUSDT 1, limit=100
2025-06-21 11:12:01 [TradingEngine] INFO: Retrieved 100 klines for BTCUSDT
2025-06-21 11:12:01,824 [INFO] Retrieved 100 klines for BTCUSDT
2025-06-21 11:12:01 [TradingEngine] INFO: Klines response type: <class 'list'>, data: [['1750468320000', '87477', '87477', '87477', '87477', '0', '0'], ['1750468260000', '87636.2', '87636.2', '87250', '87477', '0.036', '3143.5451']]
2025-06-21 11:12:01,824 [INFO] Klines response type: <class 'list'>, data: [['1750468320000', '87477', '87477', '87477', '87477', '0', '0'], ['1750468260000', '87636.2', '87636.2', '87250', '87477', '0.036', '3143.5451']]
Updated data cache for BTCUSDT 1m
New data received for BTCUSDT 1m
Running strategies for BTCUSDT 1m
2025-06-21 11:12:01 [StrategyB] INFO: Processing data for BTCUSDT with timeframes: ['1m']
2025-06-21 11:12:01,840 [INFO] Processing data for BTCUSDT with timeframes: ['1m']
2025-06-21 11:12:01 [StrategyB] INFO: Latest candle for BTCUSDT 1m:
2025-06-21 11:12:01,842 [INFO] Latest candle for BTCUSDT 1m:
2025-06-21 11:12:01 [StrategyB] INFO: - Time: 2025-06-21 09:33:00 (Minute: 33)
2025-06-21 11:12:01,842 [INFO] - Time: 2025-06-21 09:33:00 (Minute: 33)
2025-06-21 11:12:01 [StrategyB] INFO: - Price: 82910.00
2025-06-21 11:12:01,842 [INFO] - Price: 82910.00
2025-06-21 11:12:01 [StrategyB] INFO: - Even minute: False
2025-06-21 11:12:01,842 [INFO] - Even minute: False
2025-06-21 11:12:01 [StrategyB] INFO: FORCING SELL signal (alternating from previous BUY)
2025-06-21 11:12:01,842 [INFO] FORCING SELL signal (alternating from previous BUY)
2025-06-21 11:12:01 [StrategyB] INFO: Minute 33 is odd, generating SHORT signal
2025-06-21 11:12:01,842 [INFO] Minute 33 is odd, generating SHORT signal
2025-06-21 11:12:01 [StrategyB] INFO: Generated 1 signals for BTCUSDT
2025-06-21 11:12:01,842 [INFO] Generated 1 signals for BTCUSDT
2025-06-21 11:12:01 [StrategyB] INFO: Signal: SignalType.SELL at price 82910.0 with SL=83868.31, TP=80993.37
2025-06-21 11:12:01,842 [INFO] Signal: SignalType.SELL at price 82910.0 with SL=83868.31, TP=80993.37
2025-06-21 11:12:01 [TradingEngine] INFO: ======= BTCUSDT 1m CLOSE at 2025-06-20 23:33:00 =======
2025-06-21 11:12:01,842 [INFO] ======= BTCUSDT 1m CLOSE at 2025-06-20 23:33:00 =======
2025-06-21 11:12:01 [TradingEngine] INFO: OHLCV: Open=83500.00, High=83500.00, Low=82910.00, Close=82910.00, Volume=0.04
2025-06-21 11:12:01,842 [INFO] OHLCV: Open=83500.00, High=83500.00, Low=82910.00, Close=82910.00, Volume=0.04
Processed BTCUSDT 1m candle close at 2025-06-20 23:33:00
Received 1 signals for BTCUSDT
2025-06-21 11:12:01 [TradingEngine] INFO: Signal generated for BTCUSDT: SignalType.SELL SHORT
2025-06-21 11:12:01,842 [INFO] Signal generated for BTCUSDT: SignalType.SELL SHORT
SIGNAL: BTCUSDT SignalType.SELL SHORT
Validating trade for BTCUSDT...
TEST MODE: All trades allowed for testing
Executing signal for BTCUSDT...
Executing signal for BTCUSDT...
Current price for BTCUSDT: 87477.0
Using fixed position size: 0.01
Order side: Sell, direction: SHORT
Placing Sell market order for BTCUSDT without TP/SL
2025-06-21 11:12:01 [TradingEngine] INFO: Entering SHORT position for BTCUSDT, qty=0.01 (without TP/SL)
2025-06-21 11:12:01,967 [INFO] Entering SHORT position for BTCUSDT, qty=0.01 (without TP/SL)
2025-06-21 11:12:02 [TradingEngine] ERROR: Failed to place order: Unknown error
2025-06-21 11:12:02,367 [ERROR] Failed to place order: Unknown error
2025-06-21 11:12:02 [TradingEngine] INFO: SHORT order result: {'orderId': 'cdb1d1f4-3ef8-470f-9f90-4a7d5742ac81', 'orderLinkId': ''}
2025-06-21 11:12:02,367 [INFO] SHORT order result: {'orderId': 'cdb1d1f4-3ef8-470f-9f90-4a7d5742ac81', 'orderLinkId': ''}
Order not filled immediately, will set TP/SL after fill confirmation
2025-06-21 11:12:02 [TradingEngine] INFO: Order executed for BTCUSDT Sell: cdb1d1f4-3ef8-470f-9f90-4a7d5742ac81
2025-06-21 11:12:02,367 [INFO] Order executed for BTCUSDT Sell: cdb1d1f4-3ef8-470f-9f90-4a7d5742ac81
SUCCESS: Order executed for BTCUSDT Sell: cdb1d1f4-3ef8-470f-9f90-4a7d5742ac81
Processing BTCUSDT on 5m timeframe
Fetching data for BTCUSDT 5m
2025-06-21 11:12:02 [TradingEngine] INFO: Fetching kline data for BTCUSDT 5, limit=100
2025-06-21 11:12:02,367 [INFO] Fetching kline data for BTCUSDT 5, limit=100
2025-06-21 11:12:02 [TradingEngine] INFO: Retrieved 100 klines for BTCUSDT
2025-06-21 11:12:02,494 [INFO] Retrieved 100 klines for BTCUSDT
2025-06-21 11:12:02 [TradingEngine] INFO: Klines response type: <class 'list'>, data: [['1750468200000', '87298.3', '87751.9', '87250', '87250', '0.062', '5418.8368'], ['1750467900000', '87743.6', '88024.6', '87298.3', '87298.3', '0.288', '25180.7831']]
2025-06-21 11:12:02,494 [INFO] Klines response type: <class 'list'>, data: [['1750468200000', '87298.3', '87751.9', '87250', '87250', '0.062', '5418.8368'], ['1750467900000', '87743.6', '88024.6', '87298.3', '87298.3', '0.288', '25180.7831']]
No new data for BTCUSDT 5m
No new data for BTCUSDT 5m
Processing BTCUSDT on 1h timeframe
Fetching data for BTCUSDT 1h
2025-06-21 11:12:02 [TradingEngine] INFO: Fetching kline data for BTCUSDT 60, limit=100
2025-06-21 11:12:02,510 [INFO] Fetching kline data for BTCUSDT 60, limit=100
2025-06-21 11:12:02 [TradingEngine] INFO: Retrieved 100 klines for BTCUSDT
2025-06-21 11:12:02,649 [INFO] Retrieved 100 klines for BTCUSDT
2025-06-21 11:12:02 [TradingEngine] INFO: Klines response type: <class 'list'>, data: [['1750467600000', '87298.3', '88024.6', '87250', '87250', '0.672', '58750.7288'], ['1750464000000', '83707.9', '88096.2', '83707.9','87298.3', '6.67', '576283.1679']]
2025-06-21 11:12:02,649 [INFO] Klines response type: <class 'list'>, data: [['1750467600000', '87298.3', '88024.6', '87250', '87250', '0.672', '58750.7288'], ['1750464000000', '83707.9', '88096.2', '83707.9', '87298.3','6.67', '576283.1679']]
No new data for BTCUSDT 1h
No new data for BTCUSDT 1h
Checking TP/SL conditions
2025-06-21 11:12:02 [TradingEngine] INFO: Checking 1 pending TP/SL orders
2025-06-21 11:12:02,653 [INFO] Checking 1 pending TP/SL orders
2025-06-21 11:12:02 [TradingEngine] INFO: Getting order info for cdb1d1f4-3ef8-470f-9f90-4a7d5742ac81 on BTCUSDT
2025-06-21 11:12:02,653 [INFO] Getting order info for cdb1d1f4-3ef8-470f-9f90-4a7d5742ac81 on BTCUSDT
Engine status: Running=True, Active positions=0
2025-06-21 11:12:02 [TradingEngine] INFO: Order cdb1d1f4-3ef8-470f-9f90-4a7d5742ac81 filled, setting TP/SL
2025-06-21 11:12:02,980 [INFO] Order cdb1d1f4-3ef8-470f-9f90-4a7d5742ac81 filled, setting TP/SL
2025-06-21 11:12:03 [TradingEngine] INFO: Fetching kline data for BTCUSDT 1, limit=20
2025-06-21 11:12:03,100 [INFO] Fetching kline data for BTCUSDT 1, limit=20
2025-06-21 11:12:03 [TradingEngine] INFO: Retrieved 20 klines for BTCUSDT
2025-06-21 11:12:03,283 [INFO] Retrieved 20 klines for BTCUSDT
2025-06-21 11:12:03 [TradingEngine] INFO: Klines response type: <class 'list'>, data: [['1750468320000', '87477', '87477', '87250', '87250', '0.01', '872.5'], ['1750468260000', '87636.2', '87636.2', '87250', '87477', '0.036', '3143.5451']]
2025-06-21 11:12:03,283 [INFO] Klines response type: <class 'list'>, data: [['1750468320000', '87477', '87477', '87250', '87250', '0.01', '872.5'], ['1750468260000', '87636.2', '87636.2', '87250', '87477', '0.036', '3143.5451']]
2025-06-21 11:12:03 [TradingEngine] INFO: Calculated ATR from historical data: 581.6357142857129
2025-06-21 11:12:03,287 [INFO] Calculated ATR from historical data: 581.6357142857129
2025-06-21 11:12:03 [TradingEngine] INFO: Setting TP/SL for filled order cdb1d1f4-3ef8-470f-9f90-4a7d5742ac81
2025-06-21 11:12:03,287 [INFO] Setting TP/SL for filled order cdb1d1f4-3ef8-470f-9f90-4a7d5742ac81
2025-06-21 11:12:03 [TradingEngine] INFO: Getting order info for cdb1d1f4-3ef8-470f-9f90-4a7d5742ac81 on BTCUSDT
2025-06-21 11:12:03,289 [INFO] Getting order info for cdb1d1f4-3ef8-470f-9f90-4a7d5742ac81 on BTCUSDT
2025-06-21 11:12:03 [TradingEngine] INFO: Fill info for cdb1d1f4-3ef8-470f-9f90-4a7d5742ac81: {'filled': True, 'fill_price': 87250.0, 'side': 'Sell', 'position_idx': 0}
2025-06-21 11:12:03,604 [INFO] Fill info for cdb1d1f4-3ef8-470f-9f90-4a7d5742ac81: {'filled': True, 'fill_price': 87250.0, 'side': 'Sell', 'position_idx': 0}
2025-06-21 11:12:03 [TradingEngine] INFO: Final TP/SL for BTCUSDT SHORT: TP=84923.46, SL=88413.27, Mark Price=87486.74
2025-06-21 11:12:03,733 [INFO] Final TP/SL for BTCUSDT SHORT: TP=84923.46, SL=88413.27, Mark Price=87486.74
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
2025-06-21 11:12:05 [TradingEngine] WARNING: Error setting trading stop (attempt 1/3): No response
2025-06-21 11:12:05,543 [WARNING] Error setting trading stop (attempt 1/3): No response
Engine status: Running=True, Active positions=0
2025-06-21 11:12:06 [TradingEngine] ERROR: Exception setting trading stop (attempt 2/3): not modified (ErrCode: 34040) (ErrTime: 01:12:06).
Request → POST https://api-testnet.bybit.com/v5/position/trading-stop: {"category": "linear", "symbol": "BTCUSDT", "positionIdx": 0, "takeProfit": "84923.46", "stopLoss": "88413.27", "tpTriggerBy": "MarkPrice", "slTriggerBy": "MarkPrice"}.
--- Logging error ---
Traceback (most recent call last):
  File "G:\My Drive\MyBotFolder\Bybit\pybit_bot\pybit_bot\core\order_manager_client.py", line 682, in set_trading_stop
    response = self.client._make_request("POST", "/v5/position/trading-stop", params)
  File "G:\My Drive\MyBotFolder\Bybit\pybit_bot\pybit_bot\core\client.py", line 156, in _make_request
    response = self.http_client.set_trading_stop(**params)
  File "C:\Users\marko\AppData\Local\Programs\Python\Python39\lib\site-packages\pybit\_v5_position.py", line 176, in set_trading_stop
    return self._submit_request(
  File "C:\Users\marko\AppData\Local\Programs\Python\Python39\lib\site-packages\pybit\_http_manager.py", line377, in _submit_request
    raise InvalidRequestError(
pybit.exceptions.InvalidRequestError: not modified (ErrCode: 34040) (ErrTime: 01:12:06).
Request → POST https://api-testnet.bybit.com/v5/position/trading-stop: {"category": "linear", "symbol": "BTCUSDT", "positionIdx": 0, "takeProfit": "84923.46", "stopLoss": "88413.27", "tpTriggerBy": "MarkPrice", "slTriggerBy": "MarkPrice"}.

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\marko\AppData\Local\Programs\Python\Python39\lib\logging\__init__.py", line 1082, in emit
    stream.write(msg + self.terminator)
  File "C:\Users\marko\AppData\Local\Programs\Python\Python39\lib\encodings\cp1252.py", line 19, in encode
    return codecs.charmap_encode(input,self.errors,encoding_table)[0]
UnicodeEncodeError: 'charmap' codec can't encode character '\u2192' in position 138: character maps to <undefined>
Call stack:
  File "C:\Users\marko\AppData\Local\Programs\Python\Python39\lib\threading.py", line 912, in _bootstrap
    self._bootstrap_inner()
  File "C:\Users\marko\AppData\Local\Programs\Python\Python39\lib\threading.py", line 954, in _bootstrap_inner
    self.run()
  File "C:\Users\marko\AppData\Local\Programs\Python\Python39\lib\threading.py", line 892, in run
    self._target(*self._args, **self._kwargs)
  File "G:\My Drive\MyBotFolder\Bybit\pybit_bot\pybit_bot\engine.py", line 341, in _main_loop_wrapper
    self._event_loop.run_until_complete(self._main_loop())
  File "C:\Users\marko\AppData\Local\Programs\Python\Python39\lib\asyncio\base_events.py", line 629, in run_until_complete
    self.run_forever()
  File "C:\Users\marko\AppData\Local\Programs\Python\Python39\lib\asyncio\windows_events.py", line 316, in run_forever
    super().run_forever()
  File "C:\Users\marko\AppData\Local\Programs\Python\Python39\lib\asyncio\base_events.py", line 596, in run_forever
    self._run_once()
  File "C:\Users\marko\AppData\Local\Programs\Python\Python39\lib\asyncio\base_events.py", line 1890, in _run_once
    handle._run()
  File "C:\Users\marko\AppData\Local\Programs\Python\Python39\lib\asyncio\events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
  File "G:\My Drive\MyBotFolder\Bybit\pybit_bot\pybit_bot\engine.py", line 394, in _main_loop
    await self.tpsl_manager.check_positions()
  File "G:\My Drive\MyBotFolder\Bybit\pybit_bot\pybit_bot\managers\tpsl_manager.py", line 77, in check_positions
    await self.check_pending_tpsl_orders()
  File "G:\My Drive\MyBotFolder\Bybit\pybit_bot\pybit_bot\managers\tpsl_manager.py", line 151, in check_pending_tpsl_orders
    await self.order_manager.check_pending_tpsl_orders()
  File "G:\My Drive\MyBotFolder\Bybit\pybit_bot\pybit_bot\managers\order_manager.py", line 794, in check_pending_tpsl_orders
    await self.set_tpsl_for_filled_order(symbol, order_id, atr)
  File "G:\My Drive\MyBotFolder\Bybit\pybit_bot\pybit_bot\managers\order_manager.py", line 894, in set_tpsl_for_filled_order
    result = self.order_client.set_trading_stop(
  File "G:\My Drive\MyBotFolder\Bybit\pybit_bot\pybit_bot\core\order_manager_client.py", line 704, in set_trading_stop
    self.logger.error(f"Exception setting trading stop (attempt {attempt+1}/{max_retries}): {str(e)}")
  File "G:\My Drive\MyBotFolder\Bybit\pybit_bot\pybit_bot\utils\logger.py", line 158, in error
    self._log(logging.ERROR, message, *args, **kwargs)
  File "G:\My Drive\MyBotFolder\Bybit\pybit_bot\pybit_bot\utils\logger.py", line 119, in _log
    self.logger.log(level, formatted_message, **kwargs)
Message: 'Exception setting trading stop (attempt 2/3): not modified (ErrCode: 34040) (ErrTime: 01:12:06).\nRequest → POST https://api-testnet.bybit.com/v5/position/trading-stop: {"category": "linear", "symbol": "BTCUSDT", "positionIdx": 0, "takeProfit": "84923.46", "stopLoss": "88413.27", "tpTriggerBy": "MarkPrice", "slTriggerBy": "MarkPrice"}.'
Arguments: ()
2025-06-21 11:12:06,679 [ERROR] Exception setting trading stop (attempt 2/3): not modified (ErrCode: 34040) (ErrTime: 01:12:06).
Request → POST https://api-testnet.bybit.com/v5/position/trading-stop: {"category": "linear", "symbol": "BTCUSDT", "positionIdx": 0, "takeProfit": "84923.46", "stopLoss": "88413.27", "tpTriggerBy": "MarkPrice", "slTriggerBy": "MarkPrice"}.
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
2025-06-21 11:12:09 [TradingEngine] ERROR: Exception setting trading stop (attempt 3/3): not modified (ErrCode: 34040) (ErrTime: 01:12:09).
Request → POST https://api-testnet.bybit.com/v5/position/trading-stop: {"category": "linear", "symbol": "BTCUSDT", "positionIdx": 0, "takeProfit": "84923.46", "stopLoss": "88413.27", "tpTriggerBy": "MarkPrice", "slTriggerBy": "MarkPrice"}.
--- Logging error ---
Traceback (most recent call last):
  File "G:\My Drive\MyBotFolder\Bybit\pybit_bot\pybit_bot\core\order_manager_client.py", line 682, in set_trading_stop
    response = self.client._make_request("POST", "/v5/position/trading-stop", params)
  File "G:\My Drive\MyBotFolder\Bybit\pybit_bot\pybit_bot\core\client.py", line 156, in _make_request
    response = self.http_client.set_trading_stop(**params)
  File "C:\Users\marko\AppData\Local\Programs\Python\Python39\lib\site-packages\pybit\_v5_position.py", line 176, in set_trading_stop
    return self._submit_request(
  File "C:\Users\marko\AppData\Local\Programs\Python\Python39\lib\site-packages\pybit\_http_manager.py", line377, in _submit_request
    raise InvalidRequestError(
pybit.exceptions.InvalidRequestError: not modified (ErrCode: 34040) (ErrTime: 01:12:09).
Request → POST https://api-testnet.bybit.com/v5/position/trading-stop: {"category": "linear", "symbol": "BTCUSDT", "positionIdx": 0, "takeProfit": "84923.46", "stopLoss": "88413.27", "tpTriggerBy": "MarkPrice", "slTriggerBy": "MarkPrice"}.

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\marko\AppData\Local\Programs\Python\Python39\lib\logging\__init__.py", line 1082, in emit
    stream.write(msg + self.terminator)
  File "C:\Users\marko\AppData\Local\Programs\Python\Python39\lib\encodings\cp1252.py", line 19, in encode
    return codecs.charmap_encode(input,self.errors,encoding_table)[0]
UnicodeEncodeError: 'charmap' codec can't encode character '\u2192' in position 138: character maps to <undefined>
Call stack:
  File "C:\Users\marko\AppData\Local\Programs\Python\Python39\lib\threading.py", line 912, in _bootstrap
    self._bootstrap_inner()
  File "C:\Users\marko\AppData\Local\Programs\Python\Python39\lib\threading.py", line 954, in _bootstrap_inner
    self.run()
  File "C:\Users\marko\AppData\Local\Programs\Python\Python39\lib\threading.py", line 892, in run
    self._target(*self._args, **self._kwargs)
  File "G:\My Drive\MyBotFolder\Bybit\pybit_bot\pybit_bot\engine.py", line 341, in _main_loop_wrapper
    self._event_loop.run_until_complete(self._main_loop())
  File "C:\Users\marko\AppData\Local\Programs\Python\Python39\lib\asyncio\base_events.py", line 629, in run_until_complete
    self.run_forever()
  File "C:\Users\marko\AppData\Local\Programs\Python\Python39\lib\asyncio\windows_events.py", line 316, in run_forever
    super().run_forever()
  File "C:\Users\marko\AppData\Local\Programs\Python\Python39\lib\asyncio\base_events.py", line 596, in run_forever
    self._run_once()
  File "C:\Users\marko\AppData\Local\Programs\Python\Python39\lib\asyncio\base_events.py", line 1890, in _run_once
    handle._run()
  File "C:\Users\marko\AppData\Local\Programs\Python\Python39\lib\asyncio\events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
  File "G:\My Drive\MyBotFolder\Bybit\pybit_bot\pybit_bot\engine.py", line 394, in _main_loop
    await self.tpsl_manager.check_positions()
  File "G:\My Drive\MyBotFolder\Bybit\pybit_bot\pybit_bot\managers\tpsl_manager.py", line 77, in check_positions
    await self.check_pending_tpsl_orders()
  File "G:\My Drive\MyBotFolder\Bybit\pybit_bot\pybit_bot\managers\tpsl_manager.py", line 151, in check_pending_tpsl_orders
    await self.order_manager.check_pending_tpsl_orders()
  File "G:\My Drive\MyBotFolder\Bybit\pybit_bot\pybit_bot\managers\order_manager.py", line 794, in check_pending_tpsl_orders
    await self.set_tpsl_for_filled_order(symbol, order_id, atr)
  File "G:\My Drive\MyBotFolder\Bybit\pybit_bot\pybit_bot\managers\order_manager.py", line 894, in set_tpsl_for_filled_order
    result = self.order_client.set_trading_stop(
  File "G:\My Drive\MyBotFolder\Bybit\pybit_bot\pybit_bot\core\order_manager_client.py", line 704, in set_trading_stop
    self.logger.error(f"Exception setting trading stop (attempt {attempt+1}/{max_retries}): {str(e)}")
  File "G:\My Drive\MyBotFolder\Bybit\pybit_bot\pybit_bot\utils\logger.py", line 158, in error
    self._log(logging.ERROR, message, *args, **kwargs)
  File "G:\My Drive\MyBotFolder\Bybit\pybit_bot\pybit_bot\utils\logger.py", line 119, in _log
    self.logger.log(level, formatted_message, **kwargs)
Message: 'Exception setting trading stop (attempt 3/3): not modified (ErrCode: 34040) (ErrTime: 01:12:09).\nRequest → POST https://api-testnet.bybit.com/v5/position/trading-stop: {"category": "linear", "symbol": "BTCUSDT", "positionIdx": 0, "takeProfit": "84923.46", "stopLoss": "88413.27", "tpTriggerBy": "MarkPrice", "slTriggerBy": "MarkPrice"}.'
Arguments: ()
2025-06-21 11:12:09,003 [ERROR] Exception setting trading stop (attempt 3/3): not modified (ErrCode: 34040) (ErrTime: 01:12:09).
Request → POST https://api-testnet.bybit.com/v5/position/trading-stop: {"category": "linear", "symbol": "BTCUSDT", "positionIdx": 0, "takeProfit": "84923.46", "stopLoss": "88413.27", "tpTriggerBy": "MarkPrice", "slTriggerBy": "MarkPrice"}.
2025-06-21 11:12:09 [TradingEngine] ERROR: Failed to set trading stop after 3 attempts
2025-06-21 11:12:09,014 [ERROR] Failed to set trading stop after 3 attempts
Updating position cache
Updating position cache...
Updated position for BTCUSDT: {'symbol': 'BTCUSDT', 'leverage': '1', 'autoAddMargin': 0, 'avgPrice': '87250','liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '84923.4', 'positionValue': '87.25', 'isReduceOnly': False, 'tpslMode': 'Full', 'riskId': 1, 'trailingStop': '0', 'unrealisedPnl': '-0.22903', 'markPrice': '87479.03', 'adlRankIndicator': 2, 'cumRealisedPnl': '-749.5311601', 'positionMM': '0.532225', 'createdTime': '1746973619032', 'positionIdx': 0, 'positionIM': '87.345975', 'seq': 9481248912, 'updatedTime': '1750468325491', 'side': 'Sell', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '-0.0479875', 'size': '0.001', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '88413.2', 'tradeMode': 0, 'sessionAvgPrice': ''}
Engine status: Running=True, Active positions=0
2025-06-21 11:12:09 [TradingEngine] INFO: Getting order info for cdb1d1f4-3ef8-470f-9f90-4a7d5742ac81 on BTCUSDT
2025-06-21 11:12:09,141 [INFO] Getting order info for cdb1d1f4-3ef8-470f-9f90-4a7d5742ac81 on BTCUSDT
2025-06-21 11:12:09 [TradingEngine] INFO: Fill info for cdb1d1f4-3ef8-470f-9f90-4a7d5742ac81: {'filled': True, 'fill_price': 87250.0, 'side': 'Sell', 'position_idx': 0}
2025-06-21 11:12:09,286 [INFO] Fill info for cdb1d1f4-3ef8-470f-9f90-4a7d5742ac81: {'filled': True, 'fill_price': 87250.0, 'side': 'Sell', 'position_idx': 0}
Pending order cdb1d1f4-3ef8-470f-9f90-4a7d5742ac81 filled at 87250.0, setting TP/SL
Setting TP/SL for filled order cdb1d1f4-3ef8-470f-9f90-4a7d5742ac81 at price 87250.0
ATR not found in data cache, calculating approximation
Calculated average range as ATR approximation: 404.6571428571427
Using ATR value: 404.6571428571427 for TP/SL calculation
Calculated TP/SL for BTCUSDT SHORT: TP=85631.37, SL=88059.31
2025-06-21 11:12:09 [TradingEngine] INFO: Setting TP/SL for BTCUSDT position: TP=85631.37, SL=88059.31
2025-06-21 11:12:09,412 [INFO] Setting TP/SL for BTCUSDT position: TP=85631.37, SL=88059.31
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
2025-06-21 11:12:11 [TradingEngine] WARNING: Error setting trading stop (attempt 1/3): No response
2025-06-21 11:12:11,477 [WARNING] Error setting trading stop (attempt 1/3): No response
Engine status: Running=True, Active positions=0
2025-06-21 11:12:12 [TradingEngine] ERROR: Exception setting trading stop (attempt 2/3): not modified (ErrCode: 34040) (ErrTime: 01:12:12).
Request → POST https://api-testnet.bybit.com/v5/position/trading-stop: {"category": "linear", "symbol": "BTCUSDT", "positionIdx": 0, "takeProfit": "85631.37", "stopLoss": "88059.31", "tpTriggerBy": "MarkPrice", "slTriggerBy": "MarkPrice"}.
--- Logging error ---
Traceback (most recent call last):
  File "G:\My Drive\MyBotFolder\Bybit\pybit_bot\pybit_bot\core\order_manager_client.py", line 682, in set_trading_stop
    response = self.client._make_request("POST", "/v5/position/trading-stop", params)
  File "G:\My Drive\MyBotFolder\Bybit\pybit_bot\pybit_bot\core\client.py", line 156, in _make_request
    response = self.http_client.set_trading_stop(**params)
  File "C:\Users\marko\AppData\Local\Programs\Python\Python39\lib\site-packages\pybit\_v5_position.py", line 176, in set_trading_stop
    return self._submit_request(
  File "C:\Users\marko\AppData\Local\Programs\Python\Python39\lib\site-packages\pybit\_http_manager.py", line377, in _submit_request
    raise InvalidRequestError(
pybit.exceptions.InvalidRequestError: not modified (ErrCode: 34040) (ErrTime: 01:12:12).
Request → POST https://api-testnet.bybit.com/v5/position/trading-stop: {"category": "linear", "symbol": "BTCUSDT", "positionIdx": 0, "takeProfit": "85631.37", "stopLoss": "88059.31", "tpTriggerBy": "MarkPrice", "slTriggerBy": "MarkPrice"}.

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\marko\AppData\Local\Programs\Python\Python39\lib\logging\__init__.py", line 1082, in emit
    stream.write(msg + self.terminator)
  File "C:\Users\marko\AppData\Local\Programs\Python\Python39\lib\encodings\cp1252.py", line 19, in encode
    return codecs.charmap_encode(input,self.errors,encoding_table)[0]
UnicodeEncodeError: 'charmap' codec can't encode character '\u2192' in position 138: character maps to <undefined>
Call stack:
  File "C:\Users\marko\AppData\Local\Programs\Python\Python39\lib\threading.py", line 912, in _bootstrap
    self._bootstrap_inner()
  File "C:\Users\marko\AppData\Local\Programs\Python\Python39\lib\threading.py", line 954, in _bootstrap_inner
    self.run()
  File "C:\Users\marko\AppData\Local\Programs\Python\Python39\lib\threading.py", line 892, in run
    self._target(*self._args, **self._kwargs)
  File "G:\My Drive\MyBotFolder\Bybit\pybit_bot\pybit_bot\engine.py", line 341, in _main_loop_wrapper
    self._event_loop.run_until_complete(self._main_loop())
  File "C:\Users\marko\AppData\Local\Programs\Python\Python39\lib\asyncio\base_events.py", line 629, in run_until_complete
    self.run_forever()
  File "C:\Users\marko\AppData\Local\Programs\Python\Python39\lib\asyncio\windows_events.py", line 316, in run_forever
    super().run_forever()
  File "C:\Users\marko\AppData\Local\Programs\Python\Python39\lib\asyncio\base_events.py", line 596, in run_forever
    self._run_once()
  File "C:\Users\marko\AppData\Local\Programs\Python\Python39\lib\asyncio\base_events.py", line 1890, in _run_once
    handle._run()
  File "C:\Users\marko\AppData\Local\Programs\Python\Python39\lib\asyncio\events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
  File "G:\My Drive\MyBotFolder\Bybit\pybit_bot\pybit_bot\engine.py", line 368, in _main_loop
    await self.check_pending_tpsl_orders()
  File "G:\My Drive\MyBotFolder\Bybit\pybit_bot\pybit_bot\engine.py", line 434, in check_pending_tpsl_orders
    await self._set_tpsl_for_filled_order(
  File "G:\My Drive\MyBotFolder\Bybit\pybit_bot\pybit_bot\engine.py", line 537, in _set_tpsl_for_filled_order
    tpsl_result = await self.order_manager.set_position_tpsl(
  File "G:\My Drive\MyBotFolder\Bybit\pybit_bot\pybit_bot\managers\order_manager.py", line 305, in set_position_tpsl
    result = self.order_client.set_trading_stop(
  File "G:\My Drive\MyBotFolder\Bybit\pybit_bot\pybit_bot\core\order_manager_client.py", line 704, in set_trading_stop
    self.logger.error(f"Exception setting trading stop (attempt {attempt+1}/{max_retries}): {str(e)}")
  File "G:\My Drive\MyBotFolder\Bybit\pybit_bot\pybit_bot\utils\logger.py", line 158, in error
    self._log(logging.ERROR, message, *args, **kwargs)
  File "G:\My Drive\MyBotFolder\Bybit\pybit_bot\pybit_bot\utils\logger.py", line 119, in _log
    self.logger.log(level, formatted_message, **kwargs)
Message: 'Exception setting trading stop (attempt 2/3): not modified (ErrCode: 34040) (ErrTime: 01:12:12).\nRequest → POST https://api-testnet.bybit.com/v5/position/trading-stop: {"category": "linear", "symbol": "BTCUSDT", "positionIdx": 0, "takeProfit": "85631.37", "stopLoss": "88059.31", "tpTriggerBy": "MarkPrice", "slTriggerBy": "MarkPrice"}.'
Arguments: ()
2025-06-21 11:12:12,632 [ERROR] Exception setting trading stop (attempt 2/3): not modified (ErrCode: 34040) (ErrTime: 01:12:12).
Request → POST https://api-testnet.bybit.com/v5/position/trading-stop: {"category": "linear", "symbol": "BTCUSDT", "positionIdx": 0, "takeProfit": "85631.37", "stopLoss": "88059.31", "tpTriggerBy": "MarkPrice", "slTriggerBy": "MarkPrice"}.
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
2025-06-21 11:12:14 [TradingEngine] ERROR: Exception setting trading stop (attempt 3/3): not modified (ErrCode: 34040) (ErrTime: 01:12:14).
Request → POST https://api-testnet.bybit.com/v5/position/trading-stop: {"category": "linear", "symbol": "BTCUSDT", "positionIdx": 0, "takeProfit": "85631.37", "stopLoss": "88059.31", "tpTriggerBy": "MarkPrice", "slTriggerBy": "MarkPrice"}.
--- Logging error ---
Traceback (most recent call last):
  File "G:\My Drive\MyBotFolder\Bybit\pybit_bot\pybit_bot\core\order_manager_client.py", line 682, in set_trading_stop
    response = self.client._make_request("POST", "/v5/position/trading-stop", params)
  File "G:\My Drive\MyBotFolder\Bybit\pybit_bot\pybit_bot\core\client.py", line 156, in _make_request
    response = self.http_client.set_trading_stop(**params)
  File "C:\Users\marko\AppData\Local\Programs\Python\Python39\lib\site-packages\pybit\_v5_position.py", line 176, in set_trading_stop
    return self._submit_request(
  File "C:\Users\marko\AppData\Local\Programs\Python\Python39\lib\site-packages\pybit\_http_manager.py", line377, in _submit_request
    raise InvalidRequestError(
pybit.exceptions.InvalidRequestError: not modified (ErrCode: 34040) (ErrTime: 01:12:14).
Request → POST https://api-testnet.bybit.com/v5/position/trading-stop: {"category": "linear", "symbol": "BTCUSDT", "positionIdx": 0, "takeProfit": "85631.37", "stopLoss": "88059.31", "tpTriggerBy": "MarkPrice", "slTriggerBy": "MarkPrice"}.

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\marko\AppData\Local\Programs\Python\Python39\lib\logging\__init__.py", line 1082, in emit
    stream.write(msg + self.terminator)
  File "C:\Users\marko\AppData\Local\Programs\Python\Python39\lib\encodings\cp1252.py", line 19, in encode
    return codecs.charmap_encode(input,self.errors,encoding_table)[0]
UnicodeEncodeError: 'charmap' codec can't encode character '\u2192' in position 138: character maps to <undefined>
Call stack:
  File "C:\Users\marko\AppData\Local\Programs\Python\Python39\lib\threading.py", line 912, in _bootstrap
    self._bootstrap_inner()
  File "C:\Users\marko\AppData\Local\Programs\Python\Python39\lib\threading.py", line 954, in _bootstrap_inner
    self.run()
  File "C:\Users\marko\AppData\Local\Programs\Python\Python39\lib\threading.py", line 892, in run
    self._target(*self._args, **self._kwargs)
  File "G:\My Drive\MyBotFolder\Bybit\pybit_bot\pybit_bot\engine.py", line 341, in _main_loop_wrapper
    self._event_loop.run_until_complete(self._main_loop())
  File "C:\Users\marko\AppData\Local\Programs\Python\Python39\lib\asyncio\base_events.py", line 629, in run_until_complete
    self.run_forever()
  File "C:\Users\marko\AppData\Local\Programs\Python\Python39\lib\asyncio\windows_events.py", line 316, in run_forever
    super().run_forever()
  File "C:\Users\marko\AppData\Local\Programs\Python\Python39\lib\asyncio\base_events.py", line 596, in run_forever
    self._run_once()
  File "C:\Users\marko\AppData\Local\Programs\Python\Python39\lib\asyncio\base_events.py", line 1890, in _run_once
    handle._run()
  File "C:\Users\marko\AppData\Local\Programs\Python\Python39\lib\asyncio\events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
  File "G:\My Drive\MyBotFolder\Bybit\pybit_bot\pybit_bot\engine.py", line 368, in _main_loop
    await self.check_pending_tpsl_orders()
  File "G:\My Drive\MyBotFolder\Bybit\pybit_bot\pybit_bot\engine.py", line 434, in check_pending_tpsl_orders
    await self._set_tpsl_for_filled_order(
  File "G:\My Drive\MyBotFolder\Bybit\pybit_bot\pybit_bot\engine.py", line 537, in _set_tpsl_for_filled_order
    tpsl_result = await self.order_manager.set_position_tpsl(
  File "G:\My Drive\MyBotFolder\Bybit\pybit_bot\pybit_bot\managers\order_manager.py", line 305, in set_position_tpsl
    result = self.order_client.set_trading_stop(
  File "G:\My Drive\MyBotFolder\Bybit\pybit_bot\pybit_bot\core\order_manager_client.py", line 704, in set_trading_stop
    self.logger.error(f"Exception setting trading stop (attempt {attempt+1}/{max_retries}): {str(e)}")
  File "G:\My Drive\MyBotFolder\Bybit\pybit_bot\pybit_bot\utils\logger.py", line 158, in error
    self._log(logging.ERROR, message, *args, **kwargs)
  File "G:\My Drive\MyBotFolder\Bybit\pybit_bot\pybit_bot\utils\logger.py", line 119, in _log
    self.logger.log(level, formatted_message, **kwargs)
Message: 'Exception setting trading stop (attempt 3/3): not modified (ErrCode: 34040) (ErrTime: 01:12:14).\nRequest → POST https://api-testnet.bybit.com/v5/position/trading-stop: {"category": "linear", "symbol": "BTCUSDT", "positionIdx": 0, "takeProfit": "85631.37", "stopLoss": "88059.31", "tpTriggerBy": "MarkPrice", "slTriggerBy": "MarkPrice"}.'
Arguments: ()
2025-06-21 11:12:14,799 [ERROR] Exception setting trading stop (attempt 3/3): not modified (ErrCode: 34040) (ErrTime: 01:12:14).
Request → POST https://api-testnet.bybit.com/v5/position/trading-stop: {"category": "linear", "symbol": "BTCUSDT", "positionIdx": 0, "takeProfit": "85631.37", "stopLoss": "88059.31", "tpTriggerBy": "MarkPrice", "slTriggerBy": "MarkPrice"}.
2025-06-21 11:12:14 [TradingEngine] ERROR: Failed to set trading stop after 3 attempts
2025-06-21 11:12:14,815 [ERROR] Failed to set trading stop after 3 attempts
2025-06-21 11:12:14 [TradingEngine] INFO: Set TP/SL result: {'error': 'Failed after 3 attempts'}
2025-06-21 11:12:14,815 [INFO] Set TP/SL result: {'error': 'Failed after 3 attempts'}
2025-06-21 11:12:14 [TradingEngine] ERROR: Error setting TP/SL: Failed after 3 attempts
2025-06-21 11:12:14,815 [ERROR] Error setting TP/SL: Failed after 3 attempts
ERROR setting TP/SL: Failed after 3 attempts
Waiting 46 seconds until next minute close
2025-06-21 11:12:15 [TradingEngine] INFO: Waiting 46 seconds until next minute close
2025-06-21 11:12:15,157 [INFO] Waiting 46 seconds until next minute close
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Processing symbol: BTCUSDT at minute close
Processing BTCUSDT on 1m timeframe
Fetching data for BTCUSDT 1m
No new data for BTCUSDT 1m
No new data for BTCUSDT 1m
Processing BTCUSDT on 5m timeframe
Fetching data for BTCUSDT 5m
No new data for BTCUSDT 5m
No new data for BTCUSDT 5m
Processing BTCUSDT on 1h timeframe
Fetching data for BTCUSDT 1h
No new data for BTCUSDT 1h
No new data for BTCUSDT 1h
Checking TP/SL conditions
Updating position cache
Updating position cache...
Updated position for BTCUSDT: {'symbol': 'BTCUSDT', 'leverage': '1', 'autoAddMargin': 0, 'avgPrice': '87250','liqPrice': '', 'riskLimitValue': '2000000', 'takeProfit': '85631.3', 'positionValue': '87.25', 'isReduceOnly': False, 'tpslMode': 'Full', 'riskId': 1, 'trailingStop': '0', 'unrealisedPnl': '-0.17683', 'markPrice': '87426.83', 'adlRankIndicator': 2, 'cumRealisedPnl': '-749.5311601', 'positionMM': '0.532225', 'createdTime': '1746973619032', 'positionIdx': 0, 'positionIM': '87.345975', 'seq': 9481248912, 'updatedTime': '1750468331324', 'side': 'Sell', 'bustPrice': '', 'positionBalance': '0', 'leverageSysUpdatedTime': '', 'curRealisedPnl': '-0.0479875', 'size': '0.001', 'positionStatus': 'Normal', 'mmrSysUpdatedTime': '', 'stopLoss': '88059.3', 'tradeMode': 0, 'sessionAvgPrice': ''}
Engine status: Running=True, Active positions=0
Waiting 60 seconds until next minute close
2025-06-21 11:13:01 [TradingEngine] INFO: Waiting 60 seconds until next minute close
2025-06-21 11:13:01,413 [INFO] Waiting 60 seconds until next minute close
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
Engine status: Running=True, Active positions=0
