Windows PowerShell
Copyright (C) Microsoft Corporation. All rights reserved.

Install the latest PowerShell for new features and improvements! https://aka.ms/PSWindows

PS G:\My Drive\MyBotFolder\Bybit\pybit_bot> python tests/test_client.py
2025-06-23 23:17:56 [TestClient] INFO: ===== CLIENT TRANSPORT TESTS =====
2025-06-23 23:17:56 [TestClient] INFO: ===== Testing client initialization =====
2025-06-23 23:17:56 [Credentials] INFO: Loading credentials from .env
2025-06-23 23:17:56 [Credentials] INFO: Loaded credentials for testnet
2025-06-23 23:17:56 [TestClient] INFO: Loaded credentials (testnet: True)
2025-06-23 23:17:56 [BybitTransport] INFO: BybitClient initialized for testnet
2025-06-23 23:17:56 [TestClient] INFO: Created BybitClientTransport
2025-06-23 23:17:56 [TestClient] INFO: Client initialized with base URL: https://api-testnet.bybit.com
2025-06-23 23:17:56 [TestClient] INFO: Client initialization PASSED ✓
--- Logging error ---
Traceback (most recent call last):
  File "C:\Users\marko\AppData\Local\Programs\Python\Python39\lib\logging\__init__.py", line 1082, in emit
    stream.write(msg + self.terminator)
  File "C:\Users\marko\AppData\Local\Programs\Python\Python39\lib\encodings\cp1252.py", line 19, in encode
    return codecs.charmap_encode(input,self.errors,encoding_table)[0]
UnicodeEncodeError: 'charmap' codec can't encode character '\u2713' in position 68: character maps to <undefined>
Call stack:
  File "G:\My Drive\MyBotFolder\Bybit\pybit_bot\tests\test_client.py", line 347, in <module>
    asyncio.run(main())
  File "C:\Users\marko\AppData\Local\Programs\Python\Python39\lib\asyncio\runners.py", line 44, in run
    return loop.run_until_complete(main)
  File "C:\Users\marko\AppData\Local\Programs\Python\Python39\lib\asyncio\base_events.py", line 629, in run_until_complete
    self.run_forever()
  File "C:\Users\marko\AppData\Local\Programs\Python\Python39\lib\asyncio\windows_events.py", line 316, in run_forever
    super().run_forever()
  File "C:\Users\marko\AppData\Local\Programs\Python\Python39\lib\asyncio\base_events.py", line 596, in run_forever
    self._run_once()
  File "C:\Users\marko\AppData\Local\Programs\Python\Python39\lib\asyncio\base_events.py", line 1890, in _run_once
    handle._run()
  File "C:\Users\marko\AppData\Local\Programs\Python\Python39\lib\asyncio\events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
  File "G:\My Drive\MyBotFolder\Bybit\pybit_bot\tests\test_client.py", line 309, in main
    client = await test_client_initialization()
  File "G:\My Drive\MyBotFolder\Bybit\pybit_bot\tests\test_client.py", line 62, in test_client_initialization
    logger.info("Client initialization PASSED ✓")
  File "G:\My Drive\MyBotFolder\Bybit\pybit_bot\pybit_bot\utils\logger.py", line 86, in info
    self.logger.info(message)
Message: 'Client initialization PASSED ✓'
Arguments: ()
2025-06-23 23:17:56 [TestClient] INFO:
===== Testing server time endpoint =====
2025-06-23 23:17:56 [BybitTransport] DEBUG: Request: GET https://api-testnet.bybit.com/v5/server/time?
2025-06-23 23:17:57 [BybitTransport] ERROR: HTTP Error 404:
2025-06-23 23:17:57 [BybitTransport] WARNING: Request failed, retrying in 1.0s: HTTP Error 404:
2025-06-23 23:17:58 [BybitTransport] DEBUG: Request: GET https://api-testnet.bybit.com/v5/server/time?
2025-06-23 23:17:58 [BybitTransport] ERROR: HTTP Error 404:
2025-06-23 23:17:58 [BybitTransport] WARNING: Request failed, retrying in 2.0s: HTTP Error 404:
2025-06-23 23:18:00 [BybitTransport] DEBUG: Request: GET https://api-testnet.bybit.com/v5/server/time?
2025-06-23 23:18:00 [BybitTransport] ERROR: HTTP Error 404:
2025-06-23 23:18:00 [BybitTransport] ERROR: Request failed after 3 attempts: HTTP Error 404:
2025-06-23 23:18:00 [BybitTransport] ERROR: Error in raw_request: Failed to connect to Bybit API: HTTP Error 404:
2025-06-23 23:18:00 [TestClient] ERROR: Error in server time test: Failed to connect to Bybit API: HTTP Error 404:
2025-06-23 23:18:00 [TestClient] ERROR: Traceback (most recent call last):
  File "G:\My Drive\MyBotFolder\Bybit\pybit_bot\pybit_bot\core\client.py", line 444, in _sync_raw_request
    raise BybitAPIError(error_msg)
pybit_bot.exceptions.BybitAPIError: HTTP Error 404:

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "G:\My Drive\MyBotFolder\Bybit\pybit_bot\tests\test_client.py", line 74, in test_server_time
    response = await client.get_server_time()
  File "G:\My Drive\MyBotFolder\Bybit\pybit_bot\pybit_bot\core\client.py", line 98, in get_server_time
    return await self.raw_request("GET", "/v5/server/time", {}, auth_required=False)
  File "G:\My Drive\MyBotFolder\Bybit\pybit_bot\pybit_bot\core\client.py", line 373, in raw_request
    return await asyncio.to_thread(
  File "C:\Users\marko\AppData\Local\Programs\Python\Python39\lib\asyncio\threads.py", line 25, in to_thread
    return await loop.run_in_executor(None, func_call)
  File "C:\Users\marko\AppData\Local\Programs\Python\Python39\lib\concurrent\futures\thread.py", line 52, in run
    result = self.fn(*self.args, **self.kwargs)
  File "G:\My Drive\MyBotFolder\Bybit\pybit_bot\pybit_bot\core\client.py", line 479, in _sync_raw_request
    raise ConnectionError(f"Failed to connect to Bybit API: {str(e)}")
pybit_bot.exceptions.ConnectionError: Failed to connect to Bybit API: HTTP Error 404:

2025-06-23 23:18:00 [TestClient] INFO:
===== Testing klines endpoint =====
2025-06-23 23:18:00 [TestClient] INFO: Fetching 5 klines for BTCUSDT 1m
2025-06-23 23:18:00 [TestClient] INFO: Method call: client.get_klines(category='linear', symbol=symbol, interval=interval, limit=limit)
2025-06-23 23:18:00 [BybitTransport] DEBUG: Request: GET https://api-testnet.bybit.com/v5/market/klines?category=linear&symbol=BTCUSDT&interval=1m&limit=5
2025-06-23 23:18:00 [BybitTransport] ERROR: HTTP Error 404:
2025-06-23 23:18:00 [BybitTransport] WARNING: Request failed, retrying in 1.0s: HTTP Error 404:
2025-06-23 23:18:01 [BybitTransport] DEBUG: Request: GET https://api-testnet.bybit.com/v5/market/klines?category=linear&symbol=BTCUSDT&interval=1m&limit=5
2025-06-23 23:18:02 [BybitTransport] ERROR: HTTP Error 404:
2025-06-23 23:18:02 [BybitTransport] WARNING: Request failed, retrying in 2.0s: HTTP Error 404:
2025-06-23 23:18:04 [BybitTransport] DEBUG: Request: GET https://api-testnet.bybit.com/v5/market/klines?category=linear&symbol=BTCUSDT&interval=1m&limit=5
2025-06-23 23:18:04 [BybitTransport] ERROR: HTTP Error 404:
2025-06-23 23:18:04 [BybitTransport] ERROR: Request failed after 3 attempts: HTTP Error 404:
2025-06-23 23:18:04 [BybitTransport] ERROR: Error in raw_request: Failed to connect to Bybit API: HTTP Error 404:
2025-06-23 23:18:04 [TestClient] ERROR: Error in klines test: Failed to connect to Bybit API: HTTP Error 404:
2025-06-23 23:18:04 [TestClient] ERROR: Traceback (most recent call last):
  File "G:\My Drive\MyBotFolder\Bybit\pybit_bot\pybit_bot\core\client.py", line 444, in _sync_raw_request
    raise BybitAPIError(error_msg)
pybit_bot.exceptions.BybitAPIError: HTTP Error 404:

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "G:\My Drive\MyBotFolder\Bybit\pybit_bot\tests\test_client.py", line 109, in test_klines_endpoint
    response = await client.get_klines(
  File "G:\My Drive\MyBotFolder\Bybit\pybit_bot\pybit_bot\core\client.py", line 133, in get_klines
    return await self.raw_request("GET", "/v5/market/klines", params, auth_required=False)
  File "G:\My Drive\MyBotFolder\Bybit\pybit_bot\pybit_bot\core\client.py", line 373, in raw_request
    return await asyncio.to_thread(
  File "C:\Users\marko\AppData\Local\Programs\Python\Python39\lib\asyncio\threads.py", line 25, in to_thread
    return await loop.run_in_executor(None, func_call)
  File "C:\Users\marko\AppData\Local\Programs\Python\Python39\lib\concurrent\futures\thread.py", line 52, in run
    result = self.fn(*self.args, **self.kwargs)
  File "G:\My Drive\MyBotFolder\Bybit\pybit_bot\pybit_bot\core\client.py", line 479, in _sync_raw_request
    raise ConnectionError(f"Failed to connect to Bybit API: {str(e)}")
pybit_bot.exceptions.ConnectionError: Failed to connect to Bybit API: HTTP Error 404:

2025-06-23 23:18:04 [TestClient] INFO:
===== Testing market tickers endpoint =====
2025-06-23 23:18:04 [TestClient] INFO: Fetching ticker for BTCUSDT
2025-06-23 23:18:04 [BybitTransport] DEBUG: Request: GET https://api-testnet.bybit.com/v5/market/tickers?category=linear&symbol=BTCUSDT
2025-06-23 23:18:04 [TestClient] INFO: Received 0 tickers
2025-06-23 23:18:04 [TestClient] INFO: market tickers endpoint PASSED ✓
--- Logging error ---
Traceback (most recent call last):
  File "C:\Users\marko\AppData\Local\Programs\Python\Python39\lib\logging\__init__.py", line 1082, in emit
    stream.write(msg + self.terminator)
  File "C:\Users\marko\AppData\Local\Programs\Python\Python39\lib\encodings\cp1252.py", line 19, in encode
    return codecs.charmap_encode(input,self.errors,encoding_table)[0]
UnicodeEncodeError: 'charmap' codec can't encode character '\u2713' in position 70: character maps to <undefined>
Call stack:
  File "G:\My Drive\MyBotFolder\Bybit\pybit_bot\tests\test_client.py", line 347, in <module>
    asyncio.run(main())
  File "C:\Users\marko\AppData\Local\Programs\Python\Python39\lib\asyncio\runners.py", line 44, in run
    return loop.run_until_complete(main)
  File "C:\Users\marko\AppData\Local\Programs\Python\Python39\lib\asyncio\base_events.py", line 629, in run_until_complete
    self.run_forever()
  File "C:\Users\marko\AppData\Local\Programs\Python\Python39\lib\asyncio\windows_events.py", line 316, in run_forever
    super().run_forever()
  File "C:\Users\marko\AppData\Local\Programs\Python\Python39\lib\asyncio\base_events.py", line 596, in run_forever
    self._run_once()
  File "C:\Users\marko\AppData\Local\Programs\Python\Python39\lib\asyncio\base_events.py", line 1890, in _run_once
    handle._run()
  File "C:\Users\marko\AppData\Local\Programs\Python\Python39\lib\asyncio\events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
  File "G:\My Drive\MyBotFolder\Bybit\pybit_bot\tests\test_client.py", line 327, in main
    result = await test_func(client)
  File "G:\My Drive\MyBotFolder\Bybit\pybit_bot\tests\test_client.py", line 168, in test_market_tickers
    logger.info("market tickers endpoint PASSED ✓")
  File "G:\My Drive\MyBotFolder\Bybit\pybit_bot\pybit_bot\utils\logger.py", line 86, in info
    self.logger.info(message)
Message: 'market tickers endpoint PASSED ✓'
Arguments: ()
2025-06-23 23:18:04 [TestClient] INFO:
===== Testing instruments info endpoint =====
2025-06-23 23:18:04 [TestClient] INFO: Fetching instruments info for 'linear' category
2025-06-23 23:18:04 [BybitTransport] DEBUG: Request: GET https://api-testnet.bybit.com/v5/market/instruments-info?category=linear
2025-06-23 23:18:05 [TestClient] INFO: Received 0 instruments
2025-06-23 23:18:05 [TestClient] INFO: instruments info endpoint PASSED ✓
--- Logging error ---
Traceback (most recent call last):
  File "C:\Users\marko\AppData\Local\Programs\Python\Python39\lib\logging\__init__.py", line 1082, in emit
    stream.write(msg + self.terminator)
  File "C:\Users\marko\AppData\Local\Programs\Python\Python39\lib\encodings\cp1252.py", line 19, in encode
    return codecs.charmap_encode(input,self.errors,encoding_table)[0]
UnicodeEncodeError: 'charmap' codec can't encode character '\u2713' in position 72: character maps to <undefined>
Call stack:
  File "G:\My Drive\MyBotFolder\Bybit\pybit_bot\tests\test_client.py", line 347, in <module>
    asyncio.run(main())
  File "C:\Users\marko\AppData\Local\Programs\Python\Python39\lib\asyncio\runners.py", line 44, in run
    return loop.run_until_complete(main)
  File "C:\Users\marko\AppData\Local\Programs\Python\Python39\lib\asyncio\base_events.py", line 629, in run_until_complete
    self.run_forever()
  File "C:\Users\marko\AppData\Local\Programs\Python\Python39\lib\asyncio\windows_events.py", line 316, in run_forever
    super().run_forever()
  File "C:\Users\marko\AppData\Local\Programs\Python\Python39\lib\asyncio\base_events.py", line 596, in run_forever
    self._run_once()
  File "C:\Users\marko\AppData\Local\Programs\Python\Python39\lib\asyncio\base_events.py", line 1890, in _run_once
    handle._run()
  File "C:\Users\marko\AppData\Local\Programs\Python\Python39\lib\asyncio\events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
  File "G:\My Drive\MyBotFolder\Bybit\pybit_bot\tests\test_client.py", line 327, in main
    result = await test_func(client)
  File "G:\My Drive\MyBotFolder\Bybit\pybit_bot\tests\test_client.py", line 205, in test_instruments_info
    logger.info("instruments info endpoint PASSED ✓")
  File "G:\My Drive\MyBotFolder\Bybit\pybit_bot\pybit_bot\utils\logger.py", line 86, in info
    self.logger.info(message)
Message: 'instruments info endpoint PASSED ✓'
Arguments: ()
2025-06-23 23:18:05 [TestClient] INFO:
===== Testing authentication with private endpoint =====
2025-06-23 23:18:05 [TestClient] INFO: Fetching wallet balance (authenticated endpoint)
2025-06-23 23:18:05 [BybitTransport] DEBUG: Request: GET https://api-testnet.bybit.com/v5/account/wallet-balance?accountType=UNIFIED&api_key=pfL5acAEZazHG49rIy&timestamp=1750684685455&sign=14d050631a20ec0b62a973a4270dfa3d6890b51b9a83397b8aebf37aac9ab795
2025-06-23 23:18:05 [BybitTransport] WARNING: API Error 10001: empty value: apiTimestamp[] apiKey[pfL5acAEZazHG49rIy]: Request parameter error.
2025-06-23 23:18:05 [TestClient] ERROR: Authentication failed: empty value: apiTimestamp[] apiKey[pfL5acAEZazHG49rIy]: Request parameter error.
2025-06-23 23:18:05 [TestClient] INFO:
===== Testing client error handling =====
2025-06-23 23:18:05 [TestClient] INFO: Testing with invalid endpoint
2025-06-23 23:18:05 [BybitTransport] DEBUG: Request: GET https://api-testnet.bybit.com/v5/invalid-endpoint?
2025-06-23 23:18:06 [BybitTransport] ERROR: HTTP Error 404:
2025-06-23 23:18:06 [BybitTransport] WARNING: Request failed, retrying in 1.0s: HTTP Error 404:
2025-06-23 23:18:07 [BybitTransport] DEBUG: Request: GET https://api-testnet.bybit.com/v5/invalid-endpoint?
2025-06-23 23:18:07 [BybitTransport] ERROR: HTTP Error 404:
2025-06-23 23:18:07 [BybitTransport] WARNING: Request failed, retrying in 2.0s: HTTP Error 404:
2025-06-23 23:18:09 [BybitTransport] DEBUG: Request: GET https://api-testnet.bybit.com/v5/invalid-endpoint?
2025-06-23 23:18:09 [BybitTransport] ERROR: HTTP Error 404:
2025-06-23 23:18:09 [BybitTransport] ERROR: Request failed after 3 attempts: HTTP Error 404:
2025-06-23 23:18:09 [BybitTransport] ERROR: Error in raw_request: Failed to connect to Bybit API: HTTP Error 404:
2025-06-23 23:18:09 [TestClient] ERROR: Error in error handling test: Failed to connect to Bybit API: HTTP Error 404:
2025-06-23 23:18:09 [TestClient] ERROR: Traceback (most recent call last):
  File "G:\My Drive\MyBotFolder\Bybit\pybit_bot\pybit_bot\core\client.py", line 444, in _sync_raw_request
    raise BybitAPIError(error_msg)
pybit_bot.exceptions.BybitAPIError: HTTP Error 404:

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "G:\My Drive\MyBotFolder\Bybit\pybit_bot\tests\test_client.py", line 267, in test_client_error_handling
    response = await client.raw_request("GET", "/v5/invalid-endpoint", {}, auth_required=False)
  File "G:\My Drive\MyBotFolder\Bybit\pybit_bot\pybit_bot\core\client.py", line 373, in raw_request
    return await asyncio.to_thread(
  File "C:\Users\marko\AppData\Local\Programs\Python\Python39\lib\asyncio\threads.py", line 25, in to_thread
    return await loop.run_in_executor(None, func_call)
  File "C:\Users\marko\AppData\Local\Programs\Python\Python39\lib\concurrent\futures\thread.py", line 52, in run
    result = self.fn(*self.args, **self.kwargs)
  File "G:\My Drive\MyBotFolder\Bybit\pybit_bot\pybit_bot\core\client.py", line 479, in _sync_raw_request
    raise ConnectionError(f"Failed to connect to Bybit API: {str(e)}")
pybit_bot.exceptions.ConnectionError: Failed to connect to Bybit API: HTTP Error 404:

2025-06-23 23:18:09 [TestClient] INFO:
===== TEST RESULTS SUMMARY =====
2025-06-23 23:18:09 [TestClient] INFO: test_server_time: FAILED ✗
--- Logging error ---
Traceback (most recent call last):
  File "C:\Users\marko\AppData\Local\Programs\Python\Python39\lib\logging\__init__.py", line 1082, in emit
    stream.write(msg + self.terminator)
  File "C:\Users\marko\AppData\Local\Programs\Python\Python39\lib\encodings\cp1252.py", line 19, in encode
    return codecs.charmap_encode(input,self.errors,encoding_table)[0]
UnicodeEncodeError: 'charmap' codec can't encode character '\u2717' in position 64: character maps to <undefined>
Call stack:
  File "G:\My Drive\MyBotFolder\Bybit\pybit_bot\tests\test_client.py", line 347, in <module>
    asyncio.run(main())
  File "C:\Users\marko\AppData\Local\Programs\Python\Python39\lib\asyncio\runners.py", line 44, in run
    return loop.run_until_complete(main)
  File "C:\Users\marko\AppData\Local\Programs\Python\Python39\lib\asyncio\base_events.py", line 629, in run_until_complete
    self.run_forever()
  File "C:\Users\marko\AppData\Local\Programs\Python\Python39\lib\asyncio\windows_events.py", line 316, in run_forever
    super().run_forever()
  File "C:\Users\marko\AppData\Local\Programs\Python\Python39\lib\asyncio\base_events.py", line 596, in run_forever
    self._run_once()
  File "C:\Users\marko\AppData\Local\Programs\Python\Python39\lib\asyncio\base_events.py", line 1890, in _run_once
    handle._run()
  File "C:\Users\marko\AppData\Local\Programs\Python\Python39\lib\asyncio\events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
  File "G:\My Drive\MyBotFolder\Bybit\pybit_bot\tests\test_client.py", line 341, in main
    logger.info(f"{name}: {status}")
  File "G:\My Drive\MyBotFolder\Bybit\pybit_bot\pybit_bot\utils\logger.py", line 86, in info
    self.logger.info(message)
Message: 'test_server_time: FAILED ✗'
Arguments: ()
2025-06-23 23:18:09 [TestClient] INFO: test_klines_endpoint: FAILED ✗
--- Logging error ---
Traceback (most recent call last):
  File "C:\Users\marko\AppData\Local\Programs\Python\Python39\lib\logging\__init__.py", line 1082, in emit
    stream.write(msg + self.terminator)
  File "C:\Users\marko\AppData\Local\Programs\Python\Python39\lib\encodings\cp1252.py", line 19, in encode
    return codecs.charmap_encode(input,self.errors,encoding_table)[0]
UnicodeEncodeError: 'charmap' codec can't encode character '\u2717' in position 68: character maps to <undefined>
Call stack:
  File "G:\My Drive\MyBotFolder\Bybit\pybit_bot\tests\test_client.py", line 347, in <module>
    asyncio.run(main())
  File "C:\Users\marko\AppData\Local\Programs\Python\Python39\lib\asyncio\runners.py", line 44, in run
    return loop.run_until_complete(main)
  File "C:\Users\marko\AppData\Local\Programs\Python\Python39\lib\asyncio\base_events.py", line 629, in run_until_complete
    self.run_forever()
  File "C:\Users\marko\AppData\Local\Programs\Python\Python39\lib\asyncio\windows_events.py", line 316, in run_forever
    super().run_forever()
  File "C:\Users\marko\AppData\Local\Programs\Python\Python39\lib\asyncio\base_events.py", line 596, in run_forever
    self._run_once()
  File "C:\Users\marko\AppData\Local\Programs\Python\Python39\lib\asyncio\base_events.py", line 1890, in _run_once
    handle._run()
  File "C:\Users\marko\AppData\Local\Programs\Python\Python39\lib\asyncio\events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
  File "G:\My Drive\MyBotFolder\Bybit\pybit_bot\tests\test_client.py", line 341, in main
    logger.info(f"{name}: {status}")
  File "G:\My Drive\MyBotFolder\Bybit\pybit_bot\pybit_bot\utils\logger.py", line 86, in info
    self.logger.info(message)
Message: 'test_klines_endpoint: FAILED ✗'
Arguments: ()
2025-06-23 23:18:09 [TestClient] INFO: test_market_tickers: PASSED ✓
--- Logging error ---
Traceback (most recent call last):
  File "C:\Users\marko\AppData\Local\Programs\Python\Python39\lib\logging\__init__.py", line 1082, in emit
    stream.write(msg + self.terminator)
  File "C:\Users\marko\AppData\Local\Programs\Python\Python39\lib\encodings\cp1252.py", line 19, in encode
    return codecs.charmap_encode(input,self.errors,encoding_table)[0]
UnicodeEncodeError: 'charmap' codec can't encode character '\u2713' in position 67: character maps to <undefined>
Call stack:
  File "G:\My Drive\MyBotFolder\Bybit\pybit_bot\tests\test_client.py", line 347, in <module>
    asyncio.run(main())
  File "C:\Users\marko\AppData\Local\Programs\Python\Python39\lib\asyncio\runners.py", line 44, in run
    return loop.run_until_complete(main)
  File "C:\Users\marko\AppData\Local\Programs\Python\Python39\lib\asyncio\base_events.py", line 629, in run_until_complete
    self.run_forever()
  File "C:\Users\marko\AppData\Local\Programs\Python\Python39\lib\asyncio\windows_events.py", line 316, in run_forever
    super().run_forever()
  File "C:\Users\marko\AppData\Local\Programs\Python\Python39\lib\asyncio\base_events.py", line 596, in run_forever
    self._run_once()
  File "C:\Users\marko\AppData\Local\Programs\Python\Python39\lib\asyncio\base_events.py", line 1890, in _run_once
    handle._run()
  File "C:\Users\marko\AppData\Local\Programs\Python\Python39\lib\asyncio\events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
  File "G:\My Drive\MyBotFolder\Bybit\pybit_bot\tests\test_client.py", line 341, in main
    logger.info(f"{name}: {status}")
  File "G:\My Drive\MyBotFolder\Bybit\pybit_bot\pybit_bot\utils\logger.py", line 86, in info
    self.logger.info(message)
Message: 'test_market_tickers: PASSED ✓'
Arguments: ()
2025-06-23 23:18:09 [TestClient] INFO: test_instruments_info: PASSED ✓
--- Logging error ---
Traceback (most recent call last):
  File "C:\Users\marko\AppData\Local\Programs\Python\Python39\lib\logging\__init__.py", line 1082, in emit
    stream.write(msg + self.terminator)
  File "C:\Users\marko\AppData\Local\Programs\Python\Python39\lib\encodings\cp1252.py", line 19, in encode
    return codecs.charmap_encode(input,self.errors,encoding_table)[0]
UnicodeEncodeError: 'charmap' codec can't encode character '\u2713' in position 69: character maps to <undefined>
Call stack:
  File "G:\My Drive\MyBotFolder\Bybit\pybit_bot\tests\test_client.py", line 347, in <module>
    asyncio.run(main())
  File "C:\Users\marko\AppData\Local\Programs\Python\Python39\lib\asyncio\runners.py", line 44, in run
    return loop.run_until_complete(main)
  File "C:\Users\marko\AppData\Local\Programs\Python\Python39\lib\asyncio\base_events.py", line 629, in run_until_complete
    self.run_forever()
  File "C:\Users\marko\AppData\Local\Programs\Python\Python39\lib\asyncio\windows_events.py", line 316, in run_forever
    super().run_forever()
  File "C:\Users\marko\AppData\Local\Programs\Python\Python39\lib\asyncio\base_events.py", line 596, in run_forever
    self._run_once()
  File "C:\Users\marko\AppData\Local\Programs\Python\Python39\lib\asyncio\base_events.py", line 1890, in _run_once
    handle._run()
  File "C:\Users\marko\AppData\Local\Programs\Python\Python39\lib\asyncio\events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
  File "G:\My Drive\MyBotFolder\Bybit\pybit_bot\tests\test_client.py", line 341, in main
    logger.info(f"{name}: {status}")
  File "G:\My Drive\MyBotFolder\Bybit\pybit_bot\pybit_bot\utils\logger.py", line 86, in info
    self.logger.info(message)
Message: 'test_instruments_info: PASSED ✓'
Arguments: ()
2025-06-23 23:18:09 [TestClient] INFO: test_authentication: FAILED ✗
--- Logging error ---
Traceback (most recent call last):
  File "C:\Users\marko\AppData\Local\Programs\Python\Python39\lib\logging\__init__.py", line 1082, in emit
    stream.write(msg + self.terminator)
  File "C:\Users\marko\AppData\Local\Programs\Python\Python39\lib\encodings\cp1252.py", line 19, in encode
    return codecs.charmap_encode(input,self.errors,encoding_table)[0]
UnicodeEncodeError: 'charmap' codec can't encode character '\u2717' in position 67: character maps to <undefined>
Call stack:
  File "G:\My Drive\MyBotFolder\Bybit\pybit_bot\tests\test_client.py", line 347, in <module>
    asyncio.run(main())
  File "C:\Users\marko\AppData\Local\Programs\Python\Python39\lib\asyncio\runners.py", line 44, in run
    return loop.run_until_complete(main)
  File "C:\Users\marko\AppData\Local\Programs\Python\Python39\lib\asyncio\base_events.py", line 629, in run_until_complete
    self.run_forever()
  File "C:\Users\marko\AppData\Local\Programs\Python\Python39\lib\asyncio\windows_events.py", line 316, in run_forever
    super().run_forever()
  File "C:\Users\marko\AppData\Local\Programs\Python\Python39\lib\asyncio\base_events.py", line 596, in run_forever
    self._run_once()
  File "C:\Users\marko\AppData\Local\Programs\Python\Python39\lib\asyncio\base_events.py", line 1890, in _run_once
    handle._run()
  File "C:\Users\marko\AppData\Local\Programs\Python\Python39\lib\asyncio\events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
  File "G:\My Drive\MyBotFolder\Bybit\pybit_bot\tests\test_client.py", line 341, in main
    logger.info(f"{name}: {status}")
  File "G:\My Drive\MyBotFolder\Bybit\pybit_bot\pybit_bot\utils\logger.py", line 86, in info
    self.logger.info(message)
Message: 'test_authentication: FAILED ✗'
Arguments: ()
2025-06-23 23:18:09 [TestClient] INFO: test_client_error_handling: FAILED ✗
--- Logging error ---
Traceback (most recent call last):
  File "C:\Users\marko\AppData\Local\Programs\Python\Python39\lib\logging\__init__.py", line 1082, in emit
    stream.write(msg + self.terminator)
  File "C:\Users\marko\AppData\Local\Programs\Python\Python39\lib\encodings\cp1252.py", line 19, in encode
    return codecs.charmap_encode(input,self.errors,encoding_table)[0]
UnicodeEncodeError: 'charmap' codec can't encode character '\u2717' in position 74: character maps to <undefined>
Call stack:
  File "G:\My Drive\MyBotFolder\Bybit\pybit_bot\tests\test_client.py", line 347, in <module>
    asyncio.run(main())
  File "C:\Users\marko\AppData\Local\Programs\Python\Python39\lib\asyncio\runners.py", line 44, in run
    return loop.run_until_complete(main)
  File "C:\Users\marko\AppData\Local\Programs\Python\Python39\lib\asyncio\base_events.py", line 629, in run_until_complete
    self.run_forever()
  File "C:\Users\marko\AppData\Local\Programs\Python\Python39\lib\asyncio\windows_events.py", line 316, in run_forever
    super().run_forever()
  File "C:\Users\marko\AppData\Local\Programs\Python\Python39\lib\asyncio\base_events.py", line 596, in run_forever
    self._run_once()
  File "C:\Users\marko\AppData\Local\Programs\Python\Python39\lib\asyncio\base_events.py", line 1890, in _run_once
    handle._run()
  File "C:\Users\marko\AppData\Local\Programs\Python\Python39\lib\asyncio\events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
  File "G:\My Drive\MyBotFolder\Bybit\pybit_bot\tests\test_client.py", line 341, in main
    logger.info(f"{name}: {status}")
  File "G:\My Drive\MyBotFolder\Bybit\pybit_bot\pybit_bot\utils\logger.py", line 86, in info
    self.logger.info(message)
Message: 'test_client_error_handling: FAILED ✗'
Arguments: ()
2025-06-23 23:18:09 [TestClient] INFO:
Total: 6, Passed: 2, Failed: 4
2025-06-23 23:18:09 [TestClient] INFO: ===== ALL TESTS COMPLETED =====
PS G:\My Drive\MyBotFolder\Bybit\pybit_bot>




******CURRENT TEST SCRIPT for test_client.py. use this one when making changes****
"""
Test script for BybitClientTransport from client.py

This script tests basic client functionality including:
- Connection to Bybit API
- Authentication
- Basic API endpoints
- Error handling
- Rate limiting behavior
"""

import os
import sys
import asyncio
import time
from dotenv import load_dotenv

# Add project root to path
sys.path.append(os.path.dirname(os.path.dirname(os.path.abspath(__file__))))

from pybit_bot.core.client import BybitClientTransport, APICredentials
from pybit_bot.utils.credentials import load_credentials
from pybit_bot.utils.logger import Logger

logger = Logger("TestClient")

async def test_client_initialization():
    """Test client initialization"""
    logger.info("===== Testing client initialization =====")
    
    # Load credentials
    try:
        credentials = load_credentials()
        logger.info(f"Loaded credentials (testnet: {credentials.testnet})")
        
        # Verify credential attributes
        required_attrs = ["api_key", "api_secret", "testnet"]
        missing_attrs = [attr for attr in required_attrs if not hasattr(credentials, attr)]
        
        if missing_attrs:
            logger.error(f"Credentials missing required attributes: {missing_attrs}")
            return None
    except Exception as e:
        logger.error(f"Failed to load credentials: {str(e)}")
        return None
    
    # Create client
    try:
        client = BybitClientTransport(credentials)
        logger.info("Created BybitClientTransport")
        
        # Test if client is properly initialized
        if not hasattr(client, "api_key") or not client.api_key:
            logger.error("Client API key not properly initialized")
            return None
        
        if not hasattr(client, "base_url") or not client.base_url:
            logger.error("Client base URL not properly initialized")
            return None
        
        logger.info(f"Client initialized with base URL: {client.base_url}")
        logger.info("Client initialization PASSED ✓")
        return client
    except Exception as e:
        logger.error(f"Failed to initialize client: {str(e)}")
        return None

async def test_server_time(client):
    """Test getting server time (public endpoint)"""
    logger.info("\n===== Testing server time endpoint =====")
    
    try:
        # Server time is a simple endpoint that doesn't require auth
        response = await client.get_server_time()
        
        if response and response.get("retCode") == 0:
            time_sec = response.get("result", {}).get("timeSecond", 0)
            time_msec = response.get("result", {}).get("timeNano", 0) // 1000000
            
            logger.info(f"Server time: {time_sec} seconds ({time_msec} ms)")
            logger.info("get_server_time PASSED ✓")
            return True
        else:
            error = response.get("retMsg", "Unknown error") if response else "No response"
            logger.error(f"Failed to get server time: {error}")
            return False
    except Exception as e:
        logger.error(f"Error in server time test: {str(e)}")
        import traceback
        logger.error(traceback.format_exc())
        return False

async def test_klines_endpoint(client):
    """Test klines endpoint (public data)"""
    logger.info("\n===== Testing klines endpoint =====")
    
    symbol = "BTCUSDT"
    interval = "1m"
    limit = 5
    
    try:
        # Test the get_klines method
        logger.info(f"Fetching {limit} klines for {symbol} {interval}")
        
        # Verify method signature and parameters
        logger.info("Method call: client.get_klines(category='linear', symbol=symbol, interval=interval, limit=limit)")
        
        # Execute the API call
        response = await client.get_klines(
            category="linear", 
            symbol=symbol,
            interval=interval,
            limit=limit
        )
        
        if response and response.get("retCode") == 0:
            klines = response.get("result", {}).get("list", [])
            logger.info(f"Received {len(klines)} klines")
            
            # Print first kline
            if klines:
                logger.info(f"First kline data: {klines[0]}")
                
            logger.info("get_klines PASSED ✓")
            return True
        else:
            error = response.get("retMsg", "Unknown error") if response else "No response"
            logger.error(f"Failed to get klines: {error}")
            return False
    except Exception as e:
        logger.error(f"Error in klines test: {str(e)}")
        import traceback
        logger.error(traceback.format_exc())
        return False

async def test_market_tickers(client):
    """Test market tickers endpoint"""
    logger.info("\n===== Testing market tickers endpoint =====")
    
    symbol = "BTCUSDT"
    
    try:
        # Test with specific symbol
        logger.info(f"Fetching ticker for {symbol}")
        
        # Prepare parameters
        params = {
            "category": "linear",
            "symbol": symbol
        }
        
        # Execute the API call
        response = await client.raw_request("GET", "/v5/market/tickers", params, auth_required=False)
        
        if response and "retCode" in response and response["retCode"] == 0:
            tickers = response.get("list", [])
            logger.info(f"Received {len(tickers)} tickers")
            
            if tickers:
                ticker = tickers[0]
                price = ticker.get("lastPrice", "N/A")
                volume = ticker.get("volume24h", "N/A")
                
                logger.info(f"Ticker for {symbol}:")
                logger.info(f"  Price: {price}")
                logger.info(f"  24h Volume: {volume}")
                
            logger.info("market tickers endpoint PASSED ✓")
            return True
        else:
            error = response.get("retMsg", "Unknown error") if response else "No response"
            logger.error(f"Failed to get tickers: {error}")
            return False
    except Exception as e:
        logger.error(f"Error in market tickers test: {str(e)}")
        import traceback
        logger.error(traceback.format_exc())
        return False

async def test_instruments_info(client):
    """Test instruments info endpoint"""
    logger.info("\n===== Testing instruments info endpoint =====")
    
    try:
        # Test the instruments info endpoint
        logger.info("Fetching instruments info for 'linear' category")
        
        # Prepare parameters
        params = {
            "category": "linear"
        }
        
        # Execute the API call
        response = await client.raw_request("GET", "/v5/market/instruments-info", params, auth_required=False)
        
        if response and "retCode" in response and response["retCode"] == 0:
            instruments = response.get("list", [])
            logger.info(f"Received {len(instruments)} instruments")
            
            # Print a few instrument symbols
            if instruments:
                sample = [i.get("symbol") for i in instruments[:3]]
                logger.info(f"Sample instruments: {sample}")
                
            logger.info("instruments info endpoint PASSED ✓")
            return True
        else:
            error = response.get("retMsg", "Unknown error") if response else "No response"
            logger.error(f"Failed to get instruments info: {error}")
            return False
    except Exception as e:
        logger.error(f"Error in instruments info test: {str(e)}")
        import traceback
        logger.error(traceback.format_exc())
        return False

async def test_authentication(client):
    """Test authentication with a private endpoint"""
    logger.info("\n===== Testing authentication with private endpoint =====")
    
    try:
        # Test wallet balance endpoint (requires auth)
        logger.info("Fetching wallet balance (authenticated endpoint)")
        
        # Prepare parameters
        params = {
            "accountType": "UNIFIED"
        }
        
        # Execute the API call
        response = await client.raw_request("GET", "/v5/account/wallet-balance", params, auth_required=True)
        
        if response and (isinstance(response, list) or "retCode" in response and response["retCode"] == 0):
            logger.info("Authentication successful")
            
            # Extract wallet info if available
            if isinstance(response, list) and response:
                coins = response[0].get("coin", [])
                for coin in coins:
                    if coin.get("coin") == "USDT":
                        balance = coin.get("walletBalance", "N/A")
                        available = coin.get("availableToWithdraw", "N/A")
                        logger.info(f"USDT Balance: {balance}, Available: {available}")
                        break
            
            logger.info("authentication test PASSED ✓")
            return True
        else:
            error = response.get("retMsg", "Unknown error") if response and not isinstance(response, list) else "No response"
            logger.error(f"Authentication failed: {error}")
            return False
    except Exception as e:
        logger.error(f"Error in authentication test: {str(e)}")
        import traceback
        logger.error(traceback.format_exc())
        return False

async def test_client_error_handling(client):
    """Test client error handling"""
    logger.info("\n===== Testing client error handling =====")
    
    try:
        # Test with invalid endpoint
        logger.info("Testing with invalid endpoint")
        
        # Execute the API call with a non-existent endpoint
        response = await client.raw_request("GET", "/v5/invalid-endpoint", {}, auth_required=False)
        
        # Should return an error response not raise an exception
        if response and "retCode" in response and response["retCode"] != 0:
            logger.info(f"Properly handled invalid endpoint: {response.get('retMsg', 'Unknown error')}")
            
            # Test with invalid parameters
            logger.info("Testing with invalid parameters")
            
            # Prepare invalid parameters
            params = {
                "category": "linear",
                "invalidParam": "value"
            }
            
            # Execute the API call with invalid parameters
            response = await client.raw_request("GET", "/v5/market/tickers", params, auth_required=False)
            
            if response:
                logger.info(f"Response with invalid params: {response.get('retMsg', 'Unknown error')}")
                logger.info("error handling test PASSED ✓")
                return True
            else:
                logger.error("No response for invalid parameters test")
                return False
        else:
            logger.error("Failed to properly handle invalid endpoint")
            return False
    except Exception as e:
        logger.error(f"Error in error handling test: {str(e)}")
        import traceback
        logger.error(traceback.format_exc())
        return False

async def main():
    """Run all tests"""
    logger.info("===== CLIENT TRANSPORT TESTS =====")
    
    # Load environment variables
    load_dotenv()
    
    # Test client initialization
    client = await test_client_initialization()
    
    if not client:
        logger.error("Client initialization failed, stopping tests")
        return
    
    # Run tests
    tests = [
        test_server_time,
        test_klines_endpoint,
        test_market_tickers,
        test_instruments_info,
        test_authentication,
        test_client_error_handling
    ]
    
    results = []
    for test_func in tests:
        result = await test_func(client)
        results.append((test_func.__name__, result))
    
    # Print summary
    logger.info("\n===== TEST RESULTS SUMMARY =====")
    passed = 0
    failed = 0
    
    for name, result in results:
        status = "PASSED ✓" if result else "FAILED ✗"
        if result:
            passed += 1
        else:
            failed += 1
        logger.info(f"{name}: {status}")
    
    logger.info(f"\nTotal: {len(results)}, Passed: {passed}, Failed: {failed}")
    logger.info("===== ALL TESTS COMPLETED =====")

if __name__ == "__main__":
    asyncio.run(main())
